import{r as o,j as t,d as _,L as J}from"./index-Dh8Pkb-q.js";import{a as Q}from"./useWatchLater-BiQ9AbZF.js";import{a as V,R as X}from"./ResumeFromModal-91QD90FT.js";import{M as Y}from"./MovieGridSkeleton-B5NCI3A8.js";import{M as ee}from"./MovieGrid-CLmviSHu.js";import{S as te}from"./SeriesGrid-BKLg3Ej2.js";import{P as se}from"./Pagination-o_qdMaqX.js";import"./MovieCardSkeleton-mlncPtAb.js";import"./SpinnerIcon-DP-3q0I9.js";const E=28,he=()=>{const[f,R]=o.useState([]),[b,F]=o.useState([]),[H,N]=o.useState(!0),{watchLater:P}=Q(),{watchLaterSeries:d,addWatchLaterSeries:U,removeWatchLaterSeries:Z,isWatchLaterSeries:A,loading:D}=V(),[i,G]=o.useState("movies"),[p,k]=o.useState(1),[g,v]=o.useState(null);o.useEffect(()=>{(async()=>{N(!0);const n=d.map(s=>s.seriesId).filter(s=>typeof s=="string"&&s.trim()!==""),m=async()=>{const s=P.filter(c=>typeof c=="string"&&c.trim()!=="");if(s.length===0)return[];try{const x=[];for(let a=0;a<s.length;a+=30)x.push(s.slice(a,a+30));const K=x.map(a=>_.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",a).get()),r=(await Promise.all(K)).flatMap(a=>a.docs.map(l=>({id:l.id,...l.data()})));return r.sort((a,l)=>{var h,u;return(((h=l.createdAt)==null?void 0:h.toMillis())||0)-(((u=a.createdAt)==null?void 0:u.toMillis())||0)}),r}catch(c){return console.error("Error fetching watch later movies: ",c),[]}},w=async()=>{if(n.length===0)return[];try{const c=[];for(let r=0;r<n.length;r+=30)c.push(n.slice(r,r+30));const x=c.map(r=>_.collection("series").where(window.firebase.firestore.FieldPath.documentId(),"in",r).get()),y=(await Promise.all(x)).flatMap(r=>r.docs.map(a=>({id:a.id,...a.data()})));return y.sort((r,a)=>{var u,T;const l=d.find(L=>L.seriesId===r.id),h=d.find(L=>L.seriesId===a.id);return(((u=h==null?void 0:h.addedAt)==null?void 0:u.toMillis())||0)-(((T=l==null?void 0:l.addedAt)==null?void 0:T.toMillis())||0)}),y}catch(s){return console.error("Error fetching watch later series: ",s),[]}};try{const[s,c]=await Promise.all([m(),w()]);R(s),F(c)}catch(s){console.error("Error fetching all watch later content:",s)}finally{N(!1)}})()},[P,d]),o.useEffect(()=>{k(1)},[i]);const $=e=>{A(e.id)?Z(e.id):v(e)},O=(e,n)=>{g&&U(g.id,e,n),v(null)},S=o.useMemo(()=>f.filter(e=>!e.isKurdish),[f]),M=o.useMemo(()=>f.filter(e=>e.isKurdish),[f]),{paginatedItems:C,totalPages:W,totalItems:q}=o.useMemo(()=>{let e=[];i==="movies"&&(e=S),i==="kurdish"&&(e=M),i==="series"&&(e=b);const n=Math.ceil(e.length/E);return{paginatedItems:e.slice((p-1)*E,p*E),totalPages:n,totalItems:e.length}},[i,p,S,M,b]),z=o.useMemo(()=>new Map(d.map(e=>[e.seriesId,{season:e.season,episode:e.episode}])),[d]),j=({tab:e,label:n,count:m})=>t.jsxs("button",{onClick:()=>G(e),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${i===e?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":i===e,children:[n,t.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${i===e?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:m})]}),I=({message:e,subMessage:n,buttonText:m,link:w})=>t.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[t.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:e}),t.jsx("p",{className:"text-slate-400 mb-6",children:n}),t.jsx(J,{to:w,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:m})]}),B=()=>{if(q>0)return t.jsxs(t.Fragment,{children:[i==="series"?t.jsx(te,{series:C,onToggleWatchLater:$,watchLaterInfoMap:z}):t.jsx(ee,{movies:C}),W>1&&t.jsx(se,{currentPage:p,totalPages:W,onPageChange:k})]});switch(i){case"movies":return t.jsx(I,{message:"قائمة أفلامك فارغة.",subMessage:"أضف أفلامًا لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return t.jsx(I,{message:"قائمة الأفلام الكردية فارغة.",subMessage:"أضف أفلامًا كردية لمشاهدتها لاحقًا.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return t.jsx(I,{message:"قائمة مسلسلاتك فارغة.",subMessage:"أضف مسلسلات لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(X,{isOpen:!!g,onClose:()=>v(null),series:g,onSave:O,isSaving:D}),t.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),t.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[t.jsx(j,{tab:"movies",label:"أفلام",count:S.length}),t.jsx(j,{tab:"kurdish",label:"كردي",count:M.length}),t.jsx(j,{tab:"series",label:"مسلسلات",count:b.length})]}),H?t.jsx(Y,{count:12}):t.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:B()})]})};export{he as default};
