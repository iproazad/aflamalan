import{R as y,u as g,r as o,j as t,L as N,s as c}from"./index-DLOQmAiS.js";import{a as _}from"./MovieCardSkeleton-B2tHPRXo.js";const k=({isFavorite:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${e?"text-red-500":"text-white"}`,fill:e?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 016.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"})}),C=({isWatchLater:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${e?"text-cyan-400":"text-white"}`,fill:e?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),L=()=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM5.404 4.343a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm9.192 0a.75.75 0 011.06 0l1.06 1.06a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zM2.75 10a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5A.75.75 0 012.75 10zm12.5 0a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zM5.404 15.657a.75.75 0 011.06 0l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06zm9.192 0a.75.75 0 010 1.06l1.06 1.06a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 011.06 0zM10 14.25a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5a.75.75 0 01.75-.75z",clipRule:"evenodd"})}),z=()=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.675-.865 1.228-1.462 1.756C9.07 5.25 8.247 5.5 7.5 5.5c-1.25 0-2.312-.746-2.813-1.846a1 1 0 00-1.748.817c.22.48.51.92.85 1.307.34.386.72.724 1.14 1.003C6.152 7.64 7.042 8 8 8c.675 0 1.32-.206 1.84-.572A4.413 4.413 0 0011.03 6.16c.41-.37.77-.79.99-1.272a1 1 0 00-.01-1.107l-.02-.02zM15 12a1 1 0 100 2h.01a1 1 0 100-2H15zM3 12a1 1 0 100 2h.01a1 1 0 100-2H3zM9 12a1 1 0 100 2h.01a1 1 0 100-2H9z",clipRule:"evenodd"})}),M=()=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{d:"M7 4a1 1 0 012 0v12a1 1 0 11-2 0V4zM3 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm8 0a1 1 0 012 0v4a1 1 0 11-2 0V8zm4-2a1 1 0 012 0v8a1 1 0 11-2 0V6z"})}),I=({movie:e,isFavorite:s,isWatchLater:n,onToggleFavorite:u,onToggleWatchLater:h})=>{const{currentUser:l}=g(),{imageRef:d,imageSrc:a,isLoaded:r,handleImageLoad:i}=_(e.poster_url),[m,f]=o.useState(!1),w=e.imdb_rating&&e.imdb_rating>=7.5,p=e.created_at?new Date().getTime()-new Date(e.created_at).getTime()<10080*60*1e3:!1,v=e.movie_type==="kurdish"||e.is_kurdish===!0,b=x=>{x.preventDefault(),x.stopPropagation(),u(e.id)},j=x=>{x.preventDefault(),x.stopPropagation(),h(e.id)};return t.jsx("div",{className:"relative group",children:t.jsxs(N,{to:`/movie/${e.id}`,className:"relative block z-10 rounded-lg overflow-hidden shadow-lg hover:shadow-xl hover:shadow-cyan-500/20 transform transition-all duration-300 ease-in-out group-hover:scale-105 bg-slate-800",children:[l&&t.jsxs("div",{className:"absolute top-1.5 right-1.5 z-20 flex flex-col gap-1.5 opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0 transition-all duration-300",children:[t.jsx("button",{onClick:b,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":s?"إزالة من المفضلة":"إضافة إلى المفضلة",children:t.jsx(k,{isFavorite:s})}),t.jsx("button",{onClick:j,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":n?"إزالة من قائمة المشاهدة لاحقاً":"إضافة إلى قائمة المشاهدة لاحقاً",children:t.jsx(C,{isWatchLater:n})})]}),t.jsx("div",{className:"relative w-full aspect-[2/3] bg-slate-800 overflow-hidden",children:t.jsx("img",{ref:d,src:a,onLoad:i,alt:e.title,className:`
              w-full h-full object-cover
              transition-all duration-500 ease-in-out group-hover:opacity-75
              ${r?"scale-100 blur-0 grayscale-0":"scale-110 blur-md grayscale"}
            `})}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/70 to-transparent"}),t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4 transition-all duration-300 group-hover:-translate-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-white text-sm sm:text-base font-bold truncate flex-shrink min-w-0",children:e.title}),t.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[p&&t.jsx("div",{title:"إضافة جديدة",className:"flex items-center justify-center h-5 w-5 bg-yellow-400/10 text-yellow-300 rounded-full",children:t.jsx(L,{})}),w&&t.jsx("div",{title:"شائع حالياً",className:"flex items-center justify-center h-5 w-5 bg-orange-400/10 text-orange-400 rounded-full",children:t.jsx(z,{})}),v&&t.jsx("div",{title:"مدبلج للكردية",className:"flex items-center justify-center h-5 w-5 bg-cyan-400/10 text-cyan-300 rounded-full",children:t.jsx(M,{})})]})]}),t.jsxs("div",{className:"mt-1 space-y-0.5",children:[e.genres&&e.genres.length>0&&t.jsxs("div",{className:"relative",onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[t.jsx("p",{className:"text-slate-400 text-xs truncate",children:e.genres.join(" / ")}),m&&t.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-max max-w-xs bg-slate-900 text-white text-xs rounded py-1.5 px-3 z-10 shadow-lg border border-slate-700 pointer-events-none animate-fade-in-up-fast",children:e.genres.join(", ")})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("p",{className:"text-slate-300 text-xs sm:text-sm",children:e.year}),e.imdb_rating&&e.imdb_rating>0?t.jsxs("div",{className:"flex items-center gap-1.5",title:`IMDb Rating: ${e.imdb_rating}/10`,children:[t.jsx("span",{className:"bg-yellow-500 text-black text-xs sm:text-sm font-bold px-2 py-0.5 rounded-sm",children:"IMDb"}),t.jsx("span",{className:"font-bold text-white text-sm",children:e.imdb_rating.toFixed(1)})]}):t.jsx("div",{className:"h-5"})]})]})]})]})})},$=y.memo(I),E=()=>{const{currentUser:e}=g(),[s,n]=o.useState([]);o.useEffect(()=>{if(!e){n([]);return}(async()=>{const{data:a,error:r}=await c.from("user_lists").select("favorites").eq("user_id",e.uid).single();a&&a.favorites?n(a.favorites):r&&r.code!=="PGRST116"&&console.error("Error fetching initial favorites:",r)})();const d=c.channel(`user-favorites-${e.uid}`).on("postgres_changes",{event:"*",schema:"public",table:"user_lists",filter:`user_id=eq.${e.uid}`},a=>{var i;const r=((i=a.new)==null?void 0:i.favorites)||[];n(r)}).subscribe();return()=>{c.removeChannel(d)}},[e]);const u=o.useCallback(async l=>{if(!e){console.warn("User must be logged in to manage favorites.");return}const a=s.includes(l)?s.filter(i=>i!==l):[...s,l];n(a);const{error:r}=await c.from("user_lists").upsert({user_id:e.uid,favorites:a});r&&(console.error("Error toggling favorite in Supabase:",r),n(s))},[e,s]),h=o.useCallback(l=>s.includes(l),[s]);return{favorites:s,toggleFavorite:u,isFavorite:h}},S=()=>{const{currentUser:e}=g(),[s,n]=o.useState([]);o.useEffect(()=>{if(!e){n([]);return}(async()=>{const{data:a,error:r}=await c.from("user_lists").select("watch_later").eq("user_id",e.uid).single();a&&a.watch_later?n(a.watch_later):r&&r.code!=="PGRST116"&&console.error("Error fetching initial watch later list:",r)})();const d=c.channel(`user-watch-later-${e.uid}`).on("postgres_changes",{event:"*",schema:"public",table:"user_lists",filter:`user_id=eq.${e.uid}`},a=>{var i;const r=((i=a.new)==null?void 0:i.watch_later)||[];n(r)}).subscribe();return()=>{c.removeChannel(d)}},[e]);const u=o.useCallback(async l=>{if(!e){console.warn("User must be logged in to manage watch later list.");return}const a=s.includes(l)?s.filter(i=>i!==l):[...s,l];n(a);const{error:r}=await c.from("user_lists").upsert({user_id:e.uid,watch_later:a});r&&(console.error("Error toggling watch later in Supabase:",r),n(s))},[e,s]),h=o.useCallback(l=>s.includes(l),[s]);return{watchLater:s,toggleWatchLater:u,isWatchLater:h}};export{$ as M,S as a,E as u};
