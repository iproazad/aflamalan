import{r as a,d as E,j as e,f as xe,F as Z,T as me,u as he}from"./index-BiMpKAyZ.js";import{P as ce}from"./Pagination-DrWNvenw.js";const ge=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),pe=({onSubmit:c,initialData:s,onCancel:n,isKurdishByDefault:l=!1,isLoading:d=!1,allGenres:u=[]})=>{const[i,h]=a.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1}),[w,y]=a.useState(""),[S,z]=a.useState(!1),[G,P]=a.useState(""),[T,I]=a.useState(""),[F,L]=a.useState(!1),f=a.useRef(null),[v,O]=a.useState(!1),[B,N]=a.useState(""),k=a.useRef(null);a.useEffect(()=>{s?(h({...s,genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:s.backupServers||[],trailerUrl:s.trailerUrl||"",isKurdish:s.isKurdish||!1}),y((s.tags||[]).join(", "))):(h({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:l}),y(""))},[s,l]),a.useEffect(()=>{const t=o=>{f.current&&!f.current.contains(o.target)&&z(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),a.useEffect(()=>{k.current&&clearTimeout(k.current);const t=i.title.trim();if(!t||s&&t===s.title.trim()){N(""),O(!1);return}return O(!0),N(""),k.current=window.setTimeout(async()=>{try{const o=await E.collection("movies").where("title","==",t).get();let m=!1;o.empty||(s?o.forEach(C=>{C.id!==s.id&&(m=!0)}):m=!0),N(m?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(o){console.error("Error checking for duplicate title:",o)}finally{O(!1)}},500),()=>{k.current&&clearTimeout(k.current)}},[i.title,s]);const j=t=>{const{name:o,value:m,type:C}=t.target;if(C==="checkbox"){const{checked:U}=t.target;h(le=>({...le,[o]:U}))}else h(U=>({...U,[o]:o==="year"?parseInt(m):m}))},A=t=>{y(t.target.value)},_=t=>{h(o=>{const m=o.genres||[],C=m.includes(t)?m.filter(U=>U!==t):[...m,t];return{...o,genres:C}})},R=async()=>{const t=T.trim();if(t){if(u.some(o=>o.toLowerCase()===t.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}L(!0);try{await E.collection("categories").add({name:t}),h(o=>({...o,genres:[...o.genres||[],t]})),I("")}catch(o){console.error("Error adding new genre:",o),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{L(!1)}}},x=(t,o,m)=>{const C=[...i.servers];C[t]={...C[t],[o]:m},h(U=>({...U,servers:C}))},$=()=>{h(t=>{const o={name:`Server ${t.servers.length+1}`,url:"",quality:"720p"};return{...t,servers:[...t.servers,o]}})},p=t=>{h(o=>({...o,servers:o.servers.filter((m,C)=>C!==t)}))},M=(t,o,m)=>{const C=[...i.backupServers||[]];C[t]={...C[t],[o]:m},h(U=>({...U,backupServers:C}))},Q=()=>{h(t=>{var o;return{...t,backupServers:[...t.backupServers||[],{name:`Backup Server ${(((o=t.backupServers)==null?void 0:o.length)||0)+1}`,url:"",quality:"720p"}]}})},H=t=>{h(o=>({...o,backupServers:(o.backupServers||[]).filter((m,C)=>C!==t)}))},ae=t=>{if(t.preventDefault(),i.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const o=w.split(",").map(m=>m.trim()).filter(m=>m!=="");c({...i,tags:o})},D=u.filter(t=>t.toLowerCase().includes(G.toLowerCase())),q="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",W="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:i.title,onChange:j,placeholder:"عنوان الفيلم",required:!0,className:q}),v&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),B&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),B]})]}),e.jsx("input",{type:"number",name:"year",value:i.year,onChange:j,placeholder:"سنة الإنتاج",required:!0,className:q})]}),e.jsx("textarea",{name:"description",value:i.description,onChange:j,placeholder:"وصف الفيلم",required:!0,className:`${q} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:i.posterUrl,onChange:j,placeholder:"رابط صورة البوستر",required:!0,className:q}),e.jsx("input",{type:"url",name:"backdropUrl",value:i.backdropUrl,onChange:j,placeholder:"رابط صورة الخلفية",required:!0,className:q})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:w,onChange:A,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:q})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!i.isKurdish,onChange:j,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:f,children:[e.jsxs("button",{type:"button",onClick:()=>z(t=>!t),className:`${q} text-right flex justify-between items-center min-h-[52px]`,"aria-haspopup":"true","aria-expanded":S,children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:i.genres.length>0?i.genres.map(t=>e.jsxs("span",{className:"bg-cyan-500 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1",children:[t,e.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),_(t)},className:"text-cyan-100 hover:text-white leading-none text-lg","aria-label":`إزالة ${t}`,children:"×"})]},t)):e.jsx("span",{className:"text-slate-400 px-1",children:"اختر الفئات..."})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-slate-400 transition-transform ${S?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),S&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg animate-fade-in-up-fast",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",placeholder:"ابحث عن فئة...",value:G,onChange:t=>P(t.target.value),className:"w-full bg-slate-800 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none",autoFocus:!0})}),e.jsx("ul",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:D.length>0?D.map(t=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-700 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:i.genres.includes(t),onChange:()=>_(t),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("span",{className:"text-white select-none",children:t})]})},t)):e.jsx("li",{className:"text-slate-400 text-center p-4",children:"لا توجد نتائج"})}),e.jsx("div",{className:"border-t border-slate-700 p-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"أو أضف فئة جديدة...",value:T,onChange:t=>I(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),R())},className:"flex-grow bg-slate-800 text-white p-2 text-sm rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:R,disabled:F||!T.trim(),className:"flex-shrink-0 bg-cyan-600 text-white px-3 py-1.5 text-sm font-bold rounded-md hover:bg-cyan-700 transition-colors disabled:bg-slate-500 disabled:cursor-not-allowed",children:F?"...":"إضافة"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"downloadUrl",value:i.downloadUrl??"",onChange:j,placeholder:"رابط التحميل (اختياري)",className:q}),e.jsx("input",{type:"url",name:"trailerUrl",value:i.trailerUrl??"",onChange:j,placeholder:"رابط المقطع الدعائي (اختياري)",className:q})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات المشاهدة"}),i.servers.map((t,o)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:t.name,onChange:m=>x(o,"name",m.target.value),placeholder:"اسم السيرفر",className:`${W} flex-1`}),e.jsx("input",{type:"url",value:t.url,onChange:m=>x(o,"url",m.target.value),placeholder:"رابط السيرفر",required:!0,className:`${W} flex-grow-[2]`}),e.jsxs("select",{value:t.quality,onChange:m=>x(o,"quality",m.target.value),className:`${W} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>p(o),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},o)),e.jsx("button",{type:"button",onClick:$,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات احتياطية (اختياري)"}),(i.backupServers||[]).map((t,o)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:t.name,onChange:m=>M(o,"name",m.target.value),placeholder:"اسم السيرفر الاحتياطي",className:`${W} flex-1`}),e.jsx("input",{type:"url",value:t.url,onChange:m=>M(o,"url",m.target.value),placeholder:"رابط السيرفر الاحتياطي",className:`${W} flex-grow-[2]`}),e.jsxs("select",{value:t.quality,onChange:m=>M(o,"quality",m.target.value),className:`${W} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>H(o),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},o)),e.jsx("button",{type:"button",onClick:Q,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:n,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:d,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:d||!!B,children:[d&&e.jsx(ge,{}),d?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},be=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Y=({isOpen:c,onClose:s,onConfirm:n,title:l,message:d,isLoading:u=!1})=>c?e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md animate-zoom-in border border-slate-700",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:l}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:d})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:n,disabled:u,children:[u&&e.jsx(be,{}),u?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:u,children:"إلغاء"})]})]})}):null,fe=10,ye=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((c,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(fe)].map((c,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((n,l)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},l))]},s))})]})})]}),je=({message:c,type:s,onClose:n})=>(a.useEffect(()=>{const u=setTimeout(n,5e3);return()=>clearTimeout(u)},[n]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:n,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),re=({children:c,onClose:s,title:n})=>(a.useEffect(()=>{const l=d=>{d.key==="Escape"&&s()};return window.addEventListener("keydown",l),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",l),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,children:e.jsx("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] animate-zoom-in border border-slate-700",onClick:l=>l.stopPropagation(),children:e.jsxs("div",{className:"p-6 md:p-8 overflow-y-auto max-h-[90vh] scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:n}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),c]})})})),ie=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),we=({genres:c,onSubmit:s,onClose:n,isLoading:l})=>{const[d,u]=a.useState(c[0]||""),[i,h]=a.useState("add"),w=y=>{y.preventDefault(),d&&s(d,i)};return e.jsx(re,{title:"تغيير الفئة بشكل جماعي",onClose:n,children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:d,onChange:y=>u(y.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:c.map(y=>e.jsx("option",{value:y,children:y},y))}),e.jsxs("select",{value:i,onChange:y=>h(y.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:n,disabled:l,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:l||!d,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[l&&e.jsx(ie,{}),l?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ve=({onSubmit:c,onClose:s,isLoading:n})=>{const[l,d]=a.useState(new Date().getFullYear()),u=i=>{i.preventDefault(),c(l)};return e.jsx(re,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:l,onChange:i=>d(parseInt(i.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:n,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:n,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[n&&e.jsx(ie,{}),n?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ne=({onSubmit:c,onClose:s,isLoading:n})=>{const[l,d]=a.useState(""),[u,i]=a.useState("add"),h=w=>{w.preventDefault(),l.trim()&&c(l.trim(),u)};return e.jsx(re,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:l,onChange:w=>d(w.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:u,onChange:w=>i(w.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:n,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:n||!l.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[n&&e.jsx(ie,{}),n?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ee=10,ke=()=>{const[c,s]=a.useState([]),[n,l]=a.useState(null),[d,u]=a.useState(!1),[i,h]=a.useState(1),[w,y]=a.useState("all"),[S,z]=a.useState(""),[G,P]=a.useState(!1),[T,I]=a.useState(null),[F,L]=a.useState(!0),[f,v]=a.useState(!1),[O,B]=a.useState(null),[N,k]=a.useState([]),[j,A]=a.useState(null),[_,R]=a.useState([]);a.useEffect(()=>{L(!0);const r=E.collection("movies").orderBy("createdAt","desc").onSnapshot(b=>{const V=b.docs.map(K=>({id:K.id,...K.data()}));s(V),L(!1)},b=>{console.error("Error fetching movies: ",b),B({message:"فشل في تحميل الأفلام.",type:"error"}),L(!1)}),g=E.collection("categories").orderBy("name").onSnapshot(b=>{const V=b.docs.map(K=>K.data().name);R(V)},b=>{console.error("Error fetching categories from ManageMovies: ",b)});return()=>{r(),g()}},[]),a.useEffect(()=>{h(1),k([])},[w,S]);const x=(r,g)=>{B({message:r,type:g})},$=async r=>{v(!0);try{await E.collection("movies").add({...r,createdAt:me.now()}),u(!1),h(1),x("تمت إضافة الفيلم بنجاح.","success")}catch(g){console.error("Error adding movie: ",g),x("حدث خطأ أثناء إضافة الفيلم.","error")}finally{v(!1)}},p=async(r,g)=>{v(!0);try{await E.collection("movies").doc(r).update(g),l(null),u(!1),x("تم تحديث الفيلم بنجاح.","success")}catch(b){console.error("Error updating movie: ",b),x("حدث خطأ أثناء تحديث الفيلم.","error")}finally{v(!1)}},M=r=>{I(r),P(!0)},Q=async()=>{if(T){v(!0);try{await E.collection("movies").doc(T.id).delete(),x("تم حذف الفيلم بنجاح.","success")}catch(r){console.error("Error deleting movie: ",r),x("حدث خطأ أثناء حذف الفيلم.","error")}finally{P(!1),I(null),v(!1)}}},H=r=>{l(r),u(!0)},ae=()=>{l(null),u(!0)},D=()=>{l(null),u(!1),A(null)},q=r=>{k(g=>g.includes(r)?g.filter(b=>b!==r):[...g,r])},W=r=>{r.target.checked?k(J.map(g=>g.id)):k([])},t=async(r,g)=>{v(!0);try{const b=E.batch();N.forEach(V=>{const K=E.collection("movies").doc(V);b.update(K,r)}),await b.commit(),x(g,"success"),k([])}catch(b){console.error("Bulk update failed:",b),x("فشل التحديث الجماعي.","error")}finally{v(!1),A(null)}},o=async()=>{v(!0);try{const r=E.batch();N.forEach(g=>{const b=E.collection("movies").doc(g);r.delete(b)}),await r.commit(),x(`تم حذف ${N.length} فيلم بنجاح.`,"success"),k([])}catch(r){console.error("Bulk delete failed:",r),x("فشل الحذف الجماعي.","error")}finally{v(!1),A(null)}},m=async(r,g)=>{const b={genres:g==="add"?Z.arrayUnion(r):Z.arrayRemove(r)};await t(b,`تم ${g==="add"?"إضافة":"إزالة"} فئة "${r}" بنجاح.`)},C=async(r,g)=>{const b={tags:g==="add"?Z.arrayUnion(r):Z.arrayRemove(r)};await t(b,`تم ${g==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${r}" بنجاح.`)},U=c.filter(r=>w==="kurdish"?r.isKurdish===!0:w==="non-kurdish"?!r.isKurdish:!0).filter(r=>xe(S,r.title)),le=Math.ceil(U.length/ee),J=U.slice((i-1)*ee,i*ee),ne=r=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${w===r?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,ue=J.length>0&&N.length===J.length;return F?e.jsx(ye,{}):e.jsxs("div",{className:"relative",children:[O&&e.jsx(je,{...O,onClose:()=>B(null)}),e.jsx(Y,{isOpen:G,onClose:()=>P(!1),onConfirm:Q,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',T==null?void 0:T.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:f}),j==="delete"&&e.jsx(Y,{isOpen:!0,onClose:()=>A(null),onConfirm:o,title:`تأكيد حذف ${N.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:f}),j==="genre"&&e.jsx(we,{genres:_,onClose:D,onSubmit:m,isLoading:f}),j==="tags"&&e.jsx(Ne,{onClose:D,onSubmit:C,isLoading:f}),j==="year"&&e.jsx(ve,{onClose:D,onSubmit:r=>t({year:r},"تم تحديث السنة بنجاح."),isLoading:f}),j==="markKurdish"&&e.jsx(Y,{isOpen:!0,onClose:D,onConfirm:()=>t({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:f}),j==="unmarkKurdish"&&e.jsx(Y,{isOpen:!0,onClose:D,onConfirm:()=>t({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:f}),d&&e.jsx(re,{title:n?"تعديل الفيلم":"إضافة فيلم جديد",onClose:D,children:e.jsx(pe,{onSubmit:n?r=>p(n.id,r):$,initialData:n,onCancel:D,isKurdishByDefault:w==="kurdish"&&!n,isLoading:f,allGenres:_})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ae,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:S,onChange:r=>z(r.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>y("all"),className:ne("all"),children:"الكل"}),e.jsx("button",{onClick:()=>y("kurdish"),className:ne("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>y("non-kurdish"),className:ne("non-kurdish"),children:"غير كردي"})]})]}),N.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[N.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>k([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>A("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>A("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>A("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>A("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>A("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>A("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:W,checked:ue,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الكلمات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:J.map(r=>{var g,b,V,K,de;return e.jsxs("tr",{className:`${N.includes(r.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:N.includes(r.id),onChange:()=>q(r.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:r.posterUrl,alt:r.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:r.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:r.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(g=r.genres)==null?void 0:g.slice(0,3).map(X=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:X},X)),((b=r.genres)==null?void 0:b.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(V=r.tags)==null?void 0:V.slice(0,3).map(X=>e.jsx("span",{className:"bg-slate-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:X},X)),((K=r.tags)==null?void 0:K.length)>3&&e.jsx("span",{className:"bg-slate-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:r.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(de=r.createdAt)!=null&&de.toDate?r.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>H(r),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>M(r),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},r.id)})})]})}),U.length>ee&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:i,totalPages:le,onPageChange:h})})]})]})},Ce=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((c,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},s))})]}),Se="yO8pzykKincc5zgbdJGdN6xISr03",se=10,Ee=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ae=({message:c,type:s,onClose:n})=>(a.useEffect(()=>{const u=setTimeout(n,5e3);return()=>clearTimeout(u)},[n]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:n,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Me=({children:c,onClose:s,title:n})=>(a.useEffect(()=>{const l=d=>{d.key==="Escape"&&s()};return window.addEventListener("keydown",l),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",l),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,children:e.jsxs("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 animate-zoom-in",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:n}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),c]})})),$e=()=>{const{currentUser:c}=he(),[s,n]=a.useState([]),[l,d]=a.useState(""),[u,i]=a.useState(""),[h,w]=a.useState(""),[y,S]=a.useState(!0),[z,G]=a.useState(!1),[P,T]=a.useState(1),[I,F]=a.useState(!1),[L,f]=a.useState(!1),[v,O]=a.useState(null),[B,N]=a.useState(null),k=(c==null?void 0:c.uid)===Se;a.useEffect(()=>{if(!k){S(!1);return}S(!0);const p=E.collection("admins").onSnapshot(M=>{const Q=M.docs.map(H=>({id:H.id,uid:H.data().uid,email:H.data().email}));n(Q),S(!1)},M=>{console.error(M),j("فشل في تحميل قائمة المشرفين.","error"),S(!1)});return()=>p()},[k]);const j=(p,M)=>{N({message:p,type:M})},A=async p=>{if(p.preventDefault(),w(""),!l.trim()||!u.trim()){w("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}G(!0);try{await E.collection("admins").doc(l).set({uid:l,email:u}),j(`تمت إضافة المشرف ${u} بنجاح.`,"success"),F(!1),d(""),i("")}catch(M){console.error("Error adding admin:",M),j("فشل في إضافة المشرف.","error")}finally{G(!1)}},_=p=>{O(p),f(!0)},R=async()=>{if(v){G(!0);try{await E.collection("admins").doc(v.id).delete(),j(`تم حذف المشرف ${v.email} بنجاح.`,"success")}catch(p){console.error(p),j("حدث خطأ أثناء حذف المشرف.","error")}finally{f(!1),O(null),G(!1)}}};if(!k)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const x=Math.ceil(s.length/se),$=s.slice((P-1)*se,P*se);return e.jsxs(e.Fragment,{children:[B&&e.jsx(Ae,{...B,onClose:()=>N(null)}),e.jsx(Y,{isOpen:L,onClose:()=>f(!1),onConfirm:R,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',v==null?void 0:v.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:z}),I&&e.jsx(Me,{title:"إضافة مشرف جديد",onClose:()=>F(!1),children:e.jsxs("form",{onSubmit:A,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:l,onChange:p=>d(p.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:u,onChange:p=>i(p.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),h&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:h}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>F(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:z,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:z,children:[z&&e.jsx(Ee,{}),z?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>F(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),y?e.jsx(Ce,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[c.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:$.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:p.email}),e.jsx("button",{onClick:()=>_(p),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},p.id))}),s.length>se&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:P,totalPages:x,onPageChange:T})})]})]})]})},Te=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ie=({onSubmit:c,initialData:s,onCancel:n,isLoading:l=!1})=>{const[d,u]=a.useState("");a.useEffect(()=>{u(s?s.name:"")},[s]);const i=h=>{h.preventDefault(),d.trim()&&c({name:d})};return e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:d,onChange:h=>u(h.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:n,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:l,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:l,children:[l&&e.jsx(Te,{}),l?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},ze=10,Pe=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(ze)].map((c,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),te=10,Ue=({message:c,type:s,onClose:n})=>(a.useEffect(()=>{const u=setTimeout(n,5e3);return()=>clearTimeout(u)},[n]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:n,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Fe=({children:c,onClose:s,title:n})=>(a.useEffect(()=>{const l=d=>{d.key==="Escape"&&s()};return window.addEventListener("keydown",l),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",l),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:n}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),c]})})),Be=()=>{const[c,s]=a.useState([]),[n,l]=a.useState(null),[d,u]=a.useState(!1),[i,h]=a.useState(1),[w,y]=a.useState(!1),[S,z]=a.useState(null),[G,P]=a.useState(!0),[T,I]=a.useState(!1),[F,L]=a.useState(null);a.useEffect(()=>{P(!0);const x=E.collection("categories").orderBy("name").onSnapshot($=>{const p=$.docs.map(M=>({id:M.id,...M.data()}));s(p),P(!1)},$=>{console.error("Error fetching categories: ",$),f("فشل في تحميل الفئات.","error"),P(!1)});return()=>x()},[]);const f=(x,$)=>{L({message:x,type:$})},v=async x=>{I(!0);try{await E.collection("categories").add(x),f("تمت إضافة الفئة بنجاح!","success"),u(!1),h(1)}catch($){console.error("Error adding category: ",$),f("حدث خطأ أثناء إضافة الفئة.","error")}finally{I(!1)}},O=async(x,$)=>{I(!0);try{await E.collection("categories").doc(x).update($),f("تم تحديث الفئة بنجاح!","success"),l(null),u(!1)}catch(p){console.error("Error updating category: ",p),f("حدث خطأ أثناء تحديث الفئة.","error")}finally{I(!1)}},B=x=>{z(x),y(!0)},N=async()=>{if(S){I(!0);try{await E.collection("categories").doc(S.id).delete(),f("تم حذف الفئة بنجاح!","success")}catch(x){console.error("Error deleting category: ",x),f("حدث خطأ أثناء حذف الفئة.","error")}finally{y(!1),z(null),I(!1)}}},k=x=>{l(x),u(!0)},j=()=>{l(null),u(!0)},A=()=>{l(null),u(!1)},_=Math.ceil(c.length/te),R=c.slice((i-1)*te,i*te);return G?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Pe,{})]}):e.jsxs("div",{children:[F&&e.jsx(Ue,{...F,onClose:()=>L(null)}),e.jsx(Y,{isOpen:w,onClose:()=>y(!1),onConfirm:N,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',S==null?void 0:S.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:T}),d&&e.jsx(Fe,{title:n?"تعديل الفئة":"إضافة فئة جديدة",onClose:A,children:e.jsx(Ie,{onSubmit:n?x=>O(n.id,x):v,initialData:n,onCancel:A,isLoading:T})}),e.jsx("button",{onClick:j,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:c.length>0?R.map(x=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:x.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>k(x),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>B(x),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},x.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),c.length>te&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ce,{currentPage:i,totalPages:_,onPageChange:h})})]})]})},oe=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(ke,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Be,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx($e,{})}],Ge=({label:c,tabKey:s,activeTab:n,onClick:l})=>e.jsx("button",{onClick:()=>l(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${n===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":n===s,children:c}),qe=()=>{var l;const[c,s]=a.useState(oe[0].key),n=(l=oe.find(d=>d.key===c))==null?void 0:l.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:oe.map(d=>e.jsx(Ge,{label:d.label,tabKey:d.key,activeTab:c,onClick:s},d.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:n})]})};export{qe as default};
