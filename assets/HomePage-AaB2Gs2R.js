import{r as a,u as Z,a as ee,d as B,f as te,j as t}from"./index-Dz2DXnM8.js";import{H as se,a as re}from"./HeroSliderSkeleton-Cr2yYshP.js";import{M as N}from"./MoviesCarousel-CalkGOeA.js";import{S as ae,G as le,T as ne,Y as oe}from"./TagFilter-DYyTPdAf.js";import{u as ie}from"./useWatchLater-Bzggdk29.js";import{M as ce}from"./MovieGrid-XnU7ad2l.js";import{M as de}from"./MovieGridSkeleton-eo5LrZbc.js";import{M as C}from"./MoviesCarouselSkeleton-DTY6SbTp.js";import{P as me}from"./Pagination-C-vk0JvX.js";import"./MovieCardSkeleton-D_IMjcnN.js";const A=30,Se=()=>{const[n,Y]=a.useState([]),[H,U]=a.useState([]),[z,b]=a.useState(!0),[l,u]=a.useState("all"),[o,g]=a.useState([]),[i,f]=a.useState([]),[h,O]=a.useState("createdAt_desc"),[d,y]=a.useState(""),{currentUser:R}=Z(),{favorites:V}=ie(),[x,k]=ee(),j=a.useRef(null),P=a.useRef(!0),p=parseInt(x.get("page")||"1",10),E=a.useCallback(e=>{var r;const s=new URLSearchParams(x);e<=1?s.delete("page"):s.set("page",e.toString()),k(s,{replace:!0}),(r=document.getElementById("filters-section"))==null||r.scrollIntoView({behavior:"smooth",block:"start"})},[x,k]);a.useEffect(()=>{b(!0);const e=B.collection("movies").orderBy("createdAt","desc").onSnapshot(s=>{const m=s.docs.map(c=>({id:c.id,...c.data()})).filter(c=>c.isKurdish!==!0);Y(m),b(!1)},s=>{console.error("Error fetching movies with real-time listener: ",s),b(!1)});return()=>e()},[]),a.useEffect(()=>{const e=B.collection("categories").orderBy("name").onSnapshot(s=>{const r=s.docs.map(m=>m.data().name);U(r)},s=>{console.error("Error fetching categories: ",s)});return()=>e()},[]);const G=e=>{g(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},$=()=>{g([])},T=e=>{f(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},K=()=>{f([])},L=()=>{y(""),u("all"),g([]),f([]),j.current=null},F=n.filter(e=>V.includes(e.id)),Q=n.slice(0,15),q=[...n].sort((e,s)=>(s.imdbRating||0)-(e.imdbRating||0)).slice(0,15),D=[...new Set(n.map(e=>e.year))].sort((e,s)=>s-e),J=H,W=[...new Set(n.flatMap(e=>e.tags||[]))].sort(),v=a.useMemo(()=>n.filter(e=>l==="all"||e.year.toString()===l).filter(e=>o.length===0?!0:o.some(s=>{var r;return(r=e.genres)==null?void 0:r.includes(s)})).filter(e=>i.length===0?!0:i.some(s=>{var r;return(r=e.tags)==null?void 0:r.includes(s)})).filter(e=>te(d,e.title)).sort((e,s)=>{var r,m,c,I;switch(h){case"rating_desc":return(s.imdbRating||0)-(e.imdbRating||0);case"rating_asc":return(e.imdbRating||0)-(s.imdbRating||0);case"year_desc":return s.year-e.year;case"year_asc":return e.year-s.year;case"createdAt_asc":{const M=(r=e.createdAt)!=null&&r.toMillis?e.createdAt.toMillis():0,w=(m=s.createdAt)!=null&&m.toMillis?s.createdAt.toMillis():0;return M-w}case"createdAt_desc":default:{const M=(c=s.createdAt)!=null&&c.toMillis?s.createdAt.toMillis():0,w=(I=e.createdAt)!=null&&I.toMillis?e.createdAt.toMillis():0;return M-w}}}),[n,l,o,i,d,h]);a.useEffect(()=>{if(P.current){P.current=!1;return}p!==1&&E(1)},[l,o,i,d,h]),a.useEffect(()=>{var s;const e=x.get("genre");e&&e!==j.current&&(y(""),u("all"),f([]),g([e]),j.current=e,(s=document.getElementById("filters-section"))==null||s.scrollIntoView({behavior:"smooth",block:"start"}))},[x]);const _=Math.ceil(v.length/A),X=v.slice((p-1)*A,p*A),S=d!==""||l!=="all"||o.length>0||i.length>0;return z?t.jsxs("div",{children:[t.jsx(se,{}),t.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),R&&t.jsx(C,{title:"المفضلة"}),t.jsx(C,{title:"أحدث الإضافات"}),t.jsx(C,{title:"الأعلى تقييماً"}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"تصفح الكل"}),t.jsx(de,{count:18})]})]}):t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(re,{movies:n.slice(0,5)}),t.jsx("div",{id:"filters-section",className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl scroll-mt-20",children:t.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[t.jsx(ae,{sortOrder:h,onSortChange:O}),t.jsx(le,{genres:J,selectedGenres:o,onToggleGenre:G,onClearGenres:$}),t.jsx(ne,{tags:W,selectedTags:i,onToggleTag:T,onClearTags:K}),t.jsx(oe,{years:D,selectedYear:l,onYearChange:u})]})}),S&&t.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-gray-800/50 p-3 animate-fade-in-down",children:[t.jsx("span",{className:"font-bold text-gray-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[d&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-yellow-900/50 px-3 py-1 text-sm text-yellow-300",children:['بحث: "',d,'"',t.jsx("button",{onClick:()=>y(""),className:"text-yellow-400 hover:text-white text-lg leading-none font-bold","aria-label":"Clear search query",children:"×"})]}),l!=="all"&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",l,t.jsx("button",{onClick:()=>u("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${l}`,children:"×"})]}),o.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[e,t.jsx("button",{onClick:()=>G(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${e}`,children:"×"})]},e)),i.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",e,t.jsx("button",{onClick:()=>T(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${e}`,children:"×"})]},e))]}),t.jsx("button",{onClick:L,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),!S&&t.jsxs(t.Fragment,{children:[R&&F.length>0&&t.jsx(N,{title:"المفضلة",movies:F}),t.jsx(N,{title:"أحدث الإضافات",movies:Q}),t.jsx(N,{title:"الأعلى تقييماً",movies:q})]}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:S?"نتائج البحث":"تصفح الكل"}),v.length>0?t.jsxs(t.Fragment,{children:[t.jsx(ce,{movies:X}),_>1&&t.jsx(me,{currentPage:p,totalPages:_,onPageChange:E})]}):t.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:t.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام تطابق معايير البحث."})})]})]})};export{Se as default};
