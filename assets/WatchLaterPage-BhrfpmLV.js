import{r,a as H,j as t,s as R,L as J}from"./index-BwkEdhce.js";import{a as Q}from"./useWatchLater-BKOYFJ0O.js";import{a as V,R as X}from"./ResumeFromModal-CUttwy-D.js";import{M as Y}from"./MovieGridSkeleton-DtWdXLTa.js";import{M as Z}from"./MovieGrid-DSgj8jXA.js";import{S as ee}from"./SeriesGrid-CO7PynK6.js";import{P as te}from"./Pagination-CJ5RWIom.js";import"./MovieCardSkeleton-CP5jx96s.js";import"./SpinnerIcon-BVd-FKcS.js";const P=30,me=()=>{const[d,C]=r.useState([]),[u,_]=r.useState([]),[D,k]=r.useState(!0),{watchLater:h}=Q(),{watchLaterSeries:i,addWatchLaterSeries:F,removeWatchLaterSeries:G,isWatchLaterSeries:$,loading:A}=V(),[n,K]=r.useState("movies"),[m,g]=r.useState(null),[f,I]=H(),T=r.useRef(!0),l=parseInt(f.get("page")||"1",10),E=r.useCallback(e=>{const a=new URLSearchParams(f);e<=1?a.delete("page"):a.set("page",e.toString()),I(a,{replace:!0}),window.scrollTo(0,0)},[f,I]);r.useEffect(()=>{(async()=>{k(!0);const a=i.map(s=>s.seriesId).filter(s=>typeof s=="string"&&s.trim()!==""),c=async()=>{if(h.length===0)return[];try{const{data:s,error:o}=await R.from("movies").select("*").in("id",h);if(o)throw o;return s.sort((w,j)=>new Date(j.created_at).getTime()-new Date(w.created_at).getTime()),s}catch(s){return console.error("Error fetching watch later movies: ",s),[]}},S=async()=>{if(a.length===0)return[];try{const{data:s,error:o}=await R.from("series").select("*").in("id",a);if(o)throw o;return s.sort((w,j)=>{const M=i.find(L=>L.seriesId===w.id),y=i.find(L=>L.seriesId===j.id);return new Date((y==null?void 0:y.added_at)||0).getTime()-new Date((M==null?void 0:M.added_at)||0).getTime()}),s}catch(s){return console.error("Error fetching watch later series: ",s),[]}};try{const[s,o]=await Promise.all([c(),S()]);C(s),_(o)}catch(s){console.error("Error fetching all watch later content:",s)}finally{k(!1)}})()},[h,i]),r.useEffect(()=>{if(T.current){T.current=!1;return}l!==1&&E(1)},[n]);const O=e=>{$(e.id)?G(e.id):g(e)},U=(e,a)=>{m&&F(m.id,e,a),g(null)},x=r.useMemo(()=>d.filter(e=>!e.is_kurdish),[d]),p=r.useMemo(()=>d.filter(e=>e.is_kurdish),[d]),{paginatedItems:N,totalPages:W,totalItems:q}=r.useMemo(()=>{let e=[];n==="movies"&&(e=x),n==="kurdish"&&(e=p),n==="series"&&(e=u);const a=Math.ceil(e.length/P);return{paginatedItems:e.slice((l-1)*P,l*P),totalPages:a,totalItems:e.length}},[n,l,x,p,u]),z=r.useMemo(()=>new Map(i.map(e=>[e.seriesId,{season:e.season,episode:e.episode}])),[i]),b=({tab:e,label:a,count:c})=>t.jsxs("button",{onClick:()=>K(e),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${n===e?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":n===e,children:[a,t.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${n===e?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:c})]}),v=({message:e,subMessage:a,buttonText:c,link:S})=>t.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[t.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:e}),t.jsx("p",{className:"text-slate-400 mb-6",children:a}),t.jsx(J,{to:S,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:c})]}),B=()=>{if(q>0)return t.jsxs(t.Fragment,{children:[n==="series"?t.jsx(ee,{series:N,onToggleWatchLater:O,watchLaterInfoMap:z}):t.jsx(Z,{movies:N}),W>1&&t.jsx(te,{currentPage:l,totalPages:W,onPageChange:E})]});switch(n){case"movies":return t.jsx(v,{message:"قائمة أفلامك فارغة.",subMessage:"أضف أفلامًا لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return t.jsx(v,{message:"قائمة الأفلام الكردية فارغة.",subMessage:"أضف أفلامًا كردية لمشاهدتها لاحقًا.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return t.jsx(v,{message:"قائمة مسلسلاتك فارغة.",subMessage:"أضف مسلسلات لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(X,{isOpen:!!m,onClose:()=>g(null),series:m,onSave:U,isSaving:A}),t.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),t.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[t.jsx(b,{tab:"movies",label:"أفلام",count:x.length}),t.jsx(b,{tab:"kurdish",label:"كردي",count:p.length}),t.jsx(b,{tab:"series",label:"مسلسلات",count:u.length})]}),D?t.jsx(Y,{count:12}):t.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:B()})]})};export{me as default};
