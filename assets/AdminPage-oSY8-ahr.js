import{r as t,d as $,j as e,f as ue,F as J,T as me,u as be}from"./index-BkMB_xR0.js";import{P as ce}from"./Pagination-Coq4LuNE.js";const fe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ye=({onSubmit:h,initialData:s,onCancel:c,isKurdishByDefault:r=!1,isLoading:g=!1,allGenres:n=[]})=>{const[u,f]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1,imdbRating:0}),[S,E]=t.useState(""),[B,T]=t.useState(!1),[U,q]=t.useState(""),[I,D]=t.useState(""),[O,R]=t.useState(!1),N=t.useRef(null),[A,P]=t.useState(!1),[z,y]=t.useState(""),j=t.useRef(null);t.useEffect(()=>{s?(f({...s,genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:s.backupServers||[],trailerUrl:s.trailerUrl||"",isKurdish:s.isKurdish||!1,imdbRating:s.imdbRating||0}),E((s.tags||[]).join(", "))):(f({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:r,imdbRating:0}),E(""))},[s,r]),t.useEffect(()=>{const a=m=>{N.current&&!N.current.contains(m.target)&&T(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),t.useEffect(()=>{j.current&&clearTimeout(j.current);const a=u.title.trim();if(!a||s&&a===s.title.trim()){y(""),P(!1);return}return P(!0),y(""),j.current=window.setTimeout(async()=>{try{const m=await $.collection("movies").where("title","==",a).get();let b=!1;m.empty||(s?m.forEach(L=>{L.id!==s.id&&(b=!0)}):b=!0),y(b?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(m){console.error("Error checking for duplicate title:",m)}finally{P(!1)}},500),()=>{j.current&&clearTimeout(j.current)}},[u.title,s]);const o=a=>{const{name:m,value:b,type:L}=a.target;if(L==="checkbox"){const{checked:K}=a.target;f(te=>({...te,[m]:K}))}else f(K=>({...K,[m]:m==="year"||m==="imdbRating"?parseFloat(b):b}))},d=a=>{E(a.target.value)},p=a=>{f(m=>{const b=m.genres||[],L=b.includes(a)?b.filter(K=>K!==a):[...b,a];return{...m,genres:L}})},w=async()=>{const a=I.trim();if(a){if(n.some(m=>m.toLowerCase()===a.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}R(!0);try{await $.collection("categories").add({name:a}),f(m=>({...m,genres:[...m.genres||[],a]})),D("")}catch(m){console.error("Error adding new genre:",m),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{R(!1)}}},x=(a,m,b)=>{const L=[...u.servers];L[a]={...L[a],[m]:b},f(K=>({...K,servers:L}))},G=()=>{f(a=>{const m={name:`Server ${a.servers.length+1}`,url:"",quality:"720p"};return{...a,servers:[...a.servers,m]}})},k=a=>{f(m=>({...m,servers:m.servers.filter((b,L)=>L!==a)}))},_=(a,m,b)=>{const L=[...u.backupServers||[]];L[a]={...L[a],[m]:b},f(K=>({...K,backupServers:L}))},ee=()=>{f(a=>{var m;return{...a,backupServers:[...a.backupServers||[],{name:`Backup Server ${(((m=a.backupServers)==null?void 0:m.length)||0)+1}`,url:"",quality:"720p"}]}})},V=a=>{f(m=>({...m,backupServers:(m.backupServers||[]).filter((b,L)=>L!==a)}))},se=a=>{if(a.preventDefault(),u.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const m=S.split(",").map(b=>b.trim()).filter(b=>b!=="");h({...u,tags:m})},H=n.filter(a=>a.toLowerCase().includes(U.toLowerCase())),W="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",Y="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:u.title,onChange:o,placeholder:"عنوان الفيلم",required:!0,className:W}),A&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),z&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),z]})]}),e.jsx("input",{type:"number",name:"year",value:u.year,onChange:o,placeholder:"سنة الإنتاج",required:!0,className:W})]}),e.jsx("textarea",{name:"description",value:u.description,onChange:o,placeholder:"وصف الفيلم",required:!0,className:`${W} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:u.posterUrl,onChange:o,placeholder:"رابط صورة البوستر",required:!0,className:W}),e.jsx("input",{type:"url",name:"backdropUrl",value:u.backdropUrl,onChange:o,placeholder:"رابط صورة الخلفية",required:!0,className:W})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:u.imdbRating||"",onChange:o,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:W}),e.jsx("input",{type:"url",name:"trailerUrl",value:u.trailerUrl??"",onChange:o,placeholder:"رابط المقطع الدعائي (اختياري)",className:W})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:S,onChange:d,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:W})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!u.isKurdish,onChange:o,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:N,children:[e.jsxs("button",{type:"button",onClick:()=>T(a=>!a),className:`${W} text-right flex justify-between items-center min-h-[52px]`,"aria-haspopup":"true","aria-expanded":B,children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:u.genres.length>0?u.genres.map(a=>e.jsxs("span",{className:"bg-cyan-500 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1",children:[a,e.jsx("button",{type:"button",onClick:m=>{m.stopPropagation(),p(a)},className:"text-cyan-100 hover:text-white leading-none text-lg","aria-label":`إزالة ${a}`,children:"×"})]},a)):e.jsx("span",{className:"text-slate-400 px-1",children:"اختر الفئات..."})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-slate-400 transition-transform ${B?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),B&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg animate-fade-in-up-fast",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",placeholder:"ابحث عن فئة...",value:U,onChange:a=>q(a.target.value),className:"w-full bg-slate-800 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none",autoFocus:!0})}),e.jsx("ul",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:H.length>0?H.map(a=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-700 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:u.genres.includes(a),onChange:()=>p(a),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("span",{className:"text-white select-none",children:a})]})},a)):e.jsx("li",{className:"text-slate-400 text-center p-4",children:"لا توجد نتائج"})}),e.jsx("div",{className:"border-t border-slate-700 p-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"أو أضف فئة جديدة...",value:I,onChange:a=>D(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),w())},className:"flex-grow bg-slate-800 text-white p-2 text-sm rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:w,disabled:O||!I.trim(),className:"flex-shrink-0 bg-cyan-600 text-white px-3 py-1.5 text-sm font-bold rounded-md hover:bg-cyan-700 transition-colors disabled:bg-slate-500 disabled:cursor-not-allowed",children:O?"...":"إضافة"})]})})]})]})]}),e.jsx("input",{type:"url",name:"downloadUrl",value:u.downloadUrl??"",onChange:o,placeholder:"رابط التحميل (اختياري)",className:W}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات المشاهدة"}),u.servers.map((a,m)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:a.name,onChange:b=>x(m,"name",b.target.value),placeholder:"اسم السيرفر",className:`${Y} flex-1`}),e.jsx("input",{type:"url",value:a.url,onChange:b=>x(m,"url",b.target.value),placeholder:"رابط السيرفر",required:!0,className:`${Y} flex-grow-[2]`}),e.jsxs("select",{value:a.quality,onChange:b=>x(m,"quality",b.target.value),className:`${Y} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>k(m),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},m)),e.jsx("button",{type:"button",onClick:G,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات احتياطية (اختياري)"}),(u.backupServers||[]).map((a,m)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:a.name,onChange:b=>_(m,"name",b.target.value),placeholder:"اسم السيرفر الاحتياطي",className:`${Y} flex-1`}),e.jsx("input",{type:"url",value:a.url,onChange:b=>_(m,"url",b.target.value),placeholder:"رابط السيرفر الاحتياطي",className:`${Y} flex-grow-[2]`}),e.jsxs("select",{value:a.quality,onChange:b=>_(m,"quality",b.target.value),className:`${Y} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>V(m),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},m)),e.jsx("button",{type:"button",onClick:ee,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:g,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:g||!!z,children:[g&&e.jsx(fe,{}),g?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},je=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Z=({isOpen:h,onClose:s,onConfirm:c,title:r,message:g,isLoading:n=!1})=>h?e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md animate-zoom-in border border-slate-700",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:r}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:g})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:c,disabled:n,children:[n&&e.jsx(je,{}),n?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:n,children:"إلغاء"})]})]})}):null,we=10,xe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((h,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(we)].map((h,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((c,r)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},r))]},s))})]})})]}),he=({message:h,type:s,onClose:c})=>(t.useEffect(()=>{const n=setTimeout(c,5e3);return()=>clearTimeout(n)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),ae=({children:h,onClose:s,title:c})=>(t.useEffect(()=>{const r=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",r),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",r),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,children:e.jsx("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] animate-zoom-in border border-slate-700",onClick:r=>r.stopPropagation(),children:e.jsxs("div",{className:"p-6 md:p-8 overflow-y-auto max-h-[90vh] scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),h]})})})),de=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),pe=({genres:h,onSubmit:s,onClose:c,isLoading:r})=>{const[g,n]=t.useState(h[0]||""),[u,f]=t.useState("add"),S=E=>{E.preventDefault(),g&&s(g,u)};return e.jsx(ae,{title:"تغيير الفئة بشكل جماعي",onClose:c,children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:g,onChange:E=>n(E.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:h.map(E=>e.jsx("option",{value:E,children:E},E))}),e.jsxs("select",{value:u,onChange:E=>f(E.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:c,disabled:r,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:r||!g,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[r&&e.jsx(de,{}),r?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ve=({onSubmit:h,onClose:s,isLoading:c})=>{const[r,g]=t.useState(new Date().getFullYear()),n=u=>{u.preventDefault(),h(r)};return e.jsx(ae,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:r,onChange:u=>g(parseInt(u.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[c&&e.jsx(de,{}),c?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ge=({onSubmit:h,onClose:s,isLoading:c})=>{const[r,g]=t.useState(""),[n,u]=t.useState("add"),f=S=>{S.preventDefault(),r.trim()&&h(r.trim(),n)};return e.jsx(ae,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:r,onChange:S=>g(S.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:n,onChange:S=>u(S.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c||!r.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[c&&e.jsx(de,{}),c?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},re=10,Ne=()=>{const[h,s]=t.useState([]),[c,r]=t.useState(null),[g,n]=t.useState(!1),[u,f]=t.useState(1),[S,E]=t.useState("all"),[B,T]=t.useState(""),[U,q]=t.useState(!1),[I,D]=t.useState(null),[O,R]=t.useState(!0),[N,A]=t.useState(!1),[P,z]=t.useState(null),[y,j]=t.useState([]),[o,d]=t.useState(null),[p,w]=t.useState([]);t.useEffect(()=>{R(!0);const l=$.collection("movies").orderBy("createdAt","desc").onSnapshot(F=>{const X=F.docs.map(Q=>({id:Q.id,...Q.data()}));s(X),R(!1)},F=>{console.error("Error fetching movies: ",F),z({message:"فشل في تحميل الأفلام.",type:"error"}),R(!1)}),v=$.collection("categories").orderBy("name").onSnapshot(F=>{const X=F.docs.map(Q=>Q.data().name);w(X)},F=>{console.error("Error fetching categories from ManageMovies: ",F)});return()=>{l(),v()}},[]),t.useEffect(()=>{f(1),j([])},[S,B]);const x=(l,v)=>{z({message:l,type:v})},G=async l=>{A(!0);try{await $.collection("movies").add({...l,createdAt:me.now()}),n(!1),f(1),x("تمت إضافة الفيلم بنجاح.","success")}catch(v){console.error("Error adding movie: ",v),x("حدث خطأ أثناء إضافة الفيلم.","error")}finally{A(!1)}},k=async(l,v)=>{A(!0);try{await $.collection("movies").doc(l).update(v),r(null),n(!1),x("تم تحديث الفيلم بنجاح.","success")}catch(F){console.error("Error updating movie: ",F),x("حدث خطأ أثناء تحديث الفيلم.","error")}finally{A(!1)}},_=l=>{D(l),q(!0)},ee=async()=>{if(I){A(!0);try{await $.collection("movies").doc(I.id).delete(),x("تم حذف الفيلم بنجاح.","success")}catch(l){console.error("Error deleting movie: ",l),x("حدث خطأ أثناء حذف الفيلم.","error")}finally{q(!1),D(null),A(!1)}}},V=l=>{r(l),n(!0)},se=()=>{r(null),n(!0)},H=()=>{r(null),n(!1),d(null)},W=l=>{j(v=>v.includes(l)?v.filter(F=>F!==l):[...v,l])},Y=l=>{l.target.checked?j(i.map(v=>v.id)):j([])},a=async(l,v)=>{A(!0);try{const F=$.batch();y.forEach(X=>{const Q=$.collection("movies").doc(X);F.update(Q,l)}),await F.commit(),x(v,"success"),j([])}catch(F){console.error("Bulk update failed:",F),x("فشل التحديث الجماعي.","error")}finally{A(!1),d(null)}},m=async()=>{A(!0);try{const l=$.batch();y.forEach(v=>{const F=$.collection("movies").doc(v);l.delete(F)}),await l.commit(),x(`تم حذف ${y.length} فيلم بنجاح.`,"success"),j([])}catch(l){console.error("Bulk delete failed:",l),x("فشل الحذف الجماعي.","error")}finally{A(!1),d(null)}},b=async(l,v)=>{const F={genres:v==="add"?J.arrayUnion(l):J.arrayRemove(l)};await a(F,`تم ${v==="add"?"إضافة":"إزالة"} فئة "${l}" بنجاح.`)},L=async(l,v)=>{const F={tags:v==="add"?J.arrayUnion(l):J.arrayRemove(l)};await a(F,`تم ${v==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${l}" بنجاح.`)},K=h.filter(l=>S==="kurdish"?l.isKurdish===!0:S==="non-kurdish"?!l.isKurdish:!0).filter(l=>ue(B,l.title)),te=Math.ceil(K.length/re),i=K.slice((u-1)*re,u*re),C=l=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${S===l?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,M=i.length>0&&y.length===i.length;return O?e.jsx(xe,{}):e.jsxs("div",{className:"relative",children:[P&&e.jsx(he,{...P,onClose:()=>z(null)}),e.jsx(Z,{isOpen:U,onClose:()=>q(!1),onConfirm:ee,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',I==null?void 0:I.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:N}),o==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>d(null),onConfirm:m,title:`تأكيد حذف ${y.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:N}),o==="genre"&&e.jsx(pe,{genres:p,onClose:H,onSubmit:b,isLoading:N}),o==="tags"&&e.jsx(ge,{onClose:H,onSubmit:L,isLoading:N}),o==="year"&&e.jsx(ve,{onClose:H,onSubmit:l=>a({year:l},"تم تحديث السنة بنجاح."),isLoading:N}),o==="markKurdish"&&e.jsx(Z,{isOpen:!0,onClose:H,onConfirm:()=>a({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:N}),o==="unmarkKurdish"&&e.jsx(Z,{isOpen:!0,onClose:H,onConfirm:()=>a({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:N}),g&&e.jsx(ae,{title:c?"تعديل الفيلم":"إضافة فيلم جديد",onClose:H,children:e.jsx(ye,{onSubmit:c?l=>k(c.id,l):G,initialData:c,onCancel:H,isKurdishByDefault:S==="kurdish"&&!c,isLoading:N,allGenres:p})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:se,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:B,onChange:l=>T(l.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>E("all"),className:C("all"),children:"الكل"}),e.jsx("button",{onClick:()=>E("kurdish"),className:C("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>E("non-kurdish"),className:C("non-kurdish"),children:"غير كردي"})]})]}),y.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[y.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>j([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>d("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>d("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>d("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>d("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>d("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>d("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:Y,checked:M,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:i.map(l=>{var v,F,X;return e.jsxs("tr",{className:`${y.includes(l.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:y.includes(l.id),onChange:()=>W(l.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:l.posterUrl,alt:l.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:l.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:l.imdbRating?l.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:l.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(v=l.genres)==null?void 0:v.slice(0,3).map(Q=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:Q},Q)),((F=l.genres)==null?void 0:F.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:l.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(X=l.createdAt)!=null&&X.toDate?l.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>V(l),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>_(l),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},l.id)})})]})}),K.length>re&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:u,totalPages:te,onPageChange:f})})]})]})},Ce=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ke=({onSubmit:h,initialData:s,onCancel:c,isLoading:r=!1,allGenres:g=[]})=>{const[n,u]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{seasonNumber:1,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"",downloadUrl:""}]}],trailerUrl:"",imdbRating:0}),[f,S]=t.useState(""),[E,B]=t.useState(!1),T=t.useRef(null);t.useEffect(()=>{s&&(u({...s,genres:s.genres||[],tags:s.tags||[],seasons:s.seasons&&s.seasons.length>0?s.seasons:[{seasonNumber:1,episodes:[]}],trailerUrl:s.trailerUrl||"",imdbRating:s.imdbRating||0}),S((s.tags||[]).join(", ")))},[s]),t.useEffect(()=>{const o=d=>{T.current&&!T.current.contains(d.target)&&B(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const U=o=>{const{name:d,value:p}=o.target;u(w=>({...w,[d]:d==="year"||d==="imdbRating"?parseFloat(p):p}))},q=o=>{S(o.target.value)},I=o=>{u(d=>({...d,genres:d.genres.includes(o)?d.genres.filter(p=>p!==o):[...d.genres,o]}))},D=(o,d,p)=>{const w=[...n.seasons];w[o][d]=p,u(x=>({...x,seasons:w}))},O=()=>{const o=n.seasons.length>0?Math.max(...n.seasons.map(d=>d.seasonNumber))+1:1;u(d=>({...d,seasons:[...d.seasons,{seasonNumber:o,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"",downloadUrl:""}]}]}))},R=o=>{u(d=>({...d,seasons:d.seasons.filter((p,w)=>w!==o)}))},N=(o,d,p,w)=>{const x=[...n.seasons],G=[...x[o].episodes];G[d]={...G[d],[p]:w},x[o]={...x[o],episodes:G},u(k=>({...k,seasons:x}))},A=o=>{const d=n.seasons[o].episodes.length>0?Math.max(...n.seasons[o].episodes.map(w=>w.episodeNumber))+1:1,p=[...n.seasons];p[o].episodes.push({episodeNumber:d,title:`الحلقة ${d}`,url:"",downloadUrl:""}),u(w=>({...w,seasons:p}))},P=(o,d)=>{const p=[...n.seasons];p[o].episodes=p[o].episodes.filter((w,x)=>x!==d),u(w=>({...w,seasons:p}))},z=o=>{o.preventDefault();const d=f.split(",").map(p=>p.trim()).filter(Boolean);h({...n,tags:d})},y="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",j="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:n.title,onChange:U,placeholder:"عنوان المسلسل",required:!0,className:y}),e.jsx("input",{type:"number",name:"year",value:n.year,onChange:U,placeholder:"سنة الإنتاج",required:!0,className:y})]}),e.jsx("textarea",{name:"description",value:n.description,onChange:U,placeholder:"وصف المسلسل",required:!0,className:`${y} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:n.posterUrl,onChange:U,placeholder:"رابط صورة البوستر",required:!0,className:y}),e.jsx("input",{type:"url",name:"backdropUrl",value:n.backdropUrl,onChange:U,placeholder:"رابط صورة الخلفية",required:!0,className:y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:n.imdbRating||"",onChange:U,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:y}),e.jsx("input",{type:"url",name:"trailerUrl",value:n.trailerUrl??"",onChange:U,placeholder:"رابط المقطع الدعائي (اختياري)",className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:T,children:[e.jsx("button",{type:"button",onClick:()=>B(o=>!o),className:`${y} text-right`,children:n.genres.length>0?n.genres.join(", "):"اختر الفئات..."}),E&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:g.map(o=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.genres.includes(o),onChange:()=>I(o)}),e.jsx("span",{children:o})]},o))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:f,onChange:q,placeholder:"أكشن, إثارة...",className:y})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),n.seasons.map((o,d)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:o.seasonNumber,onChange:p=>D(d,"seasonNumber",parseInt(p.target.value)),className:`${j} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>R(d),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"space-y-2 pl-4 border-r-2 border-slate-600",children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"الحلقات:"}),o.episodes.map((p,w)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:p.episodeNumber,onChange:x=>N(d,w,"episodeNumber",parseInt(x.target.value)),placeholder:"رقم",className:`${j} w-16`}),e.jsx("input",{type:"text",value:p.title,onChange:x=>N(d,w,"title",x.target.value),placeholder:"عنوان الحلقة",className:`${j} flex-1`}),e.jsx("button",{type:"button",onClick:()=>P(d,w),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:p.url,onChange:x=>N(d,w,"url",x.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${j} flex-1`}),e.jsx("input",{type:"url",value:p.downloadUrl||"",onChange:x=>N(d,w,"downloadUrl",x.target.value),placeholder:"رابط التحميل (اختياري)",className:`${j} flex-1`})]})]},w)),e.jsx("button",{type:"button",onClick:()=>A(d),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},d)),e.jsx("button",{type:"button",onClick:O,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:r,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:r,children:[r&&e.jsx(Ce,{}),s?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},le=10,Se=()=>{const[h,s]=t.useState([]),[c,r]=t.useState(null),[g,n]=t.useState(!1),[u,f]=t.useState(1),[S,E]=t.useState(""),[B,T]=t.useState(!1),[U,q]=t.useState(null),[I,D]=t.useState(!0),[O,R]=t.useState(!1),[N,A]=t.useState(null),[P,z]=t.useState([]),[y,j]=t.useState(null),[o,d]=t.useState([]);t.useEffect(()=>{D(!0);const i=$.collection("series").orderBy("createdAt","desc").onSnapshot(M=>{const l=M.docs.map(v=>({id:v.id,...v.data()}));s(l),D(!1)},M=>{console.error("Error fetching series: ",M),A({message:"فشل في تحميل المسلسلات.",type:"error"}),D(!1)}),C=$.collection("categories").orderBy("name").onSnapshot(M=>{const l=M.docs.map(v=>v.data().name);d(l)},M=>{console.error("Error fetching categories from ManageSeries: ",M)});return()=>{i(),C()}},[]),t.useEffect(()=>{f(1),z([])},[S]);const p=(i,C)=>{A({message:i,type:C})},w=async i=>{R(!0);try{await $.collection("series").add({...i,createdAt:me.now()}),n(!1),f(1),p("تمت إضافة المسلسل بنجاح.","success")}catch(C){console.error("Error adding series: ",C),p("حدث خطأ أثناء إضافة المسلسل.","error")}finally{R(!1)}},x=async(i,C)=>{R(!0);try{await $.collection("series").doc(i).update(C),r(null),n(!1),p("تم تحديث المسلسل بنجاح.","success")}catch(M){console.error("Error updating series: ",M),p("حدث خطأ أثناء تحديث المسلسل.","error")}finally{R(!1)}},G=i=>{q(i),T(!0)},k=async()=>{if(U){R(!0);try{await $.collection("series").doc(U.id).delete(),p("تم حذف المسلسل بنجاح.","success")}catch(i){console.error("Error deleting series: ",i),p("حدث خطأ أثناء حذف المسلسل.","error")}finally{T(!1),q(null),R(!1)}}},_=i=>{r(i),n(!0)},ee=()=>{r(null),n(!0)},V=()=>{r(null),n(!1),j(null)},se=i=>{z(C=>C.includes(i)?C.filter(M=>M!==i):[...C,i])},H=i=>{i.target.checked?z(K.map(C=>C.id)):z([])},W=async()=>{R(!0);try{const i=$.batch();P.forEach(C=>{const M=$.collection("series").doc(C);i.delete(M)}),await i.commit(),p(`تم حذف ${P.length} مسلسل بنجاح.`,"success"),z([])}catch(i){console.error("Bulk delete failed:",i),p("فشل الحذف الجماعي.","error")}finally{R(!1),j(null)}},Y=async(i,C)=>{const M={genres:C==="add"?J.arrayUnion(i):J.arrayRemove(i)};await m(M,`تم ${C==="add"?"إضافة":"إزالة"} فئة "${i}" بنجاح.`)},a=async(i,C)=>{const M={tags:C==="add"?J.arrayUnion(i):J.arrayRemove(i)};await m(M,`تم ${C==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${i}" بنجاح.`)},m=async(i,C)=>{R(!0);try{const M=$.batch();P.forEach(l=>{const v=$.collection("series").doc(l);M.update(v,i)}),await M.commit(),p(C,"success"),z([])}catch(M){console.error("Bulk update failed:",M),p("فشل التحديث الجماعي.","error")}finally{R(!1),j(null)}},b=h.filter(i=>ue(S,i.title)),L=Math.ceil(b.length/le),K=b.slice((u-1)*le,u*le),te=K.length>0&&P.length===K.length;return I?e.jsx(xe,{}):e.jsxs("div",{className:"relative",children:[N&&e.jsx(he,{...N,onClose:()=>A(null)}),e.jsx(Z,{isOpen:B,onClose:()=>T(!1),onConfirm:k,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',U==null?void 0:U.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:O}),y==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>j(null),onConfirm:W,title:`تأكيد حذف ${P.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:O}),y==="genre"&&e.jsx(pe,{genres:o,onClose:V,onSubmit:Y,isLoading:O}),y==="tags"&&e.jsx(ge,{onClose:V,onSubmit:a,isLoading:O}),g&&e.jsx(ae,{title:c?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:V,children:e.jsx(ke,{onSubmit:c?i=>x(c.id,i):w,initialData:c,onCancel:V,isLoading:O,allGenres:o})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ee,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsx("div",{className:"relative w-full sm:flex-grow",children:e.jsx("input",{type:"text",value:S,onChange:i=>E(i.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-4 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})})]}),P.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("span",{className:"text-white font-bold",children:[P.length," مسلسل محدد"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>j("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>j("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>j("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:H,checked:te})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:K.map(i=>{var C,M;return e.jsxs("tr",{className:`${P.includes(i.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:P.includes(i.id),onChange:()=>se(i.id)})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:i.posterUrl,alt:i.title,className:"h-20 w-auto rounded"})}),e.jsx("td",{className:"px-4 py-2 font-medium text-white",children:i.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:i.imdbRating?i.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:i.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:((C=i.seasons)==null?void 0:C.length)||0}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:(M=i.createdAt)!=null&&M.toDate?i.createdAt.toDate().toLocaleDateString("ar-EG"):"N/A"}),e.jsxs("td",{className:"px-4 py-2 font-medium",children:[e.jsx("button",{onClick:()=>_(i),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>G(i),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},i.id)})})]})}),b.length>le&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:u,totalPages:L,onPageChange:f})})]})]})},Ee=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((h,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},s))})]}),Ae="yO8pzykKincc5zgbdJGdN6xISr03",ne=10,Me=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),$e=({message:h,type:s,onClose:c})=>(t.useEffect(()=>{const n=setTimeout(c,5e3);return()=>clearTimeout(n)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ue=({children:h,onClose:s,title:c})=>(t.useEffect(()=>{const r=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",r),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",r),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,children:e.jsxs("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 animate-zoom-in",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),h]})})),Fe=()=>{const{currentUser:h}=be(),[s,c]=t.useState([]),[r,g]=t.useState(""),[n,u]=t.useState(""),[f,S]=t.useState(""),[E,B]=t.useState(!0),[T,U]=t.useState(!1),[q,I]=t.useState(1),[D,O]=t.useState(!1),[R,N]=t.useState(!1),[A,P]=t.useState(null),[z,y]=t.useState(null),j=(h==null?void 0:h.uid)===Ae;t.useEffect(()=>{if(!j){B(!1);return}B(!0);const k=$.collection("admins").onSnapshot(_=>{const ee=_.docs.map(V=>({id:V.id,uid:V.data().uid,email:V.data().email}));c(ee),B(!1)},_=>{console.error(_),o("فشل في تحميل قائمة المشرفين.","error"),B(!1)});return()=>k()},[j]);const o=(k,_)=>{y({message:k,type:_})},d=async k=>{if(k.preventDefault(),S(""),!r.trim()||!n.trim()){S("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}U(!0);try{await $.collection("admins").doc(r).set({uid:r,email:n}),o(`تمت إضافة المشرف ${n} بنجاح.`,"success"),O(!1),g(""),u("")}catch(_){console.error("Error adding admin:",_),o("فشل في إضافة المشرف.","error")}finally{U(!1)}},p=k=>{P(k),N(!0)},w=async()=>{if(A){U(!0);try{await $.collection("admins").doc(A.id).delete(),o(`تم حذف المشرف ${A.email} بنجاح.`,"success")}catch(k){console.error(k),o("حدث خطأ أثناء حذف المشرف.","error")}finally{N(!1),P(null),U(!1)}}};if(!j)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const x=Math.ceil(s.length/ne),G=s.slice((q-1)*ne,q*ne);return e.jsxs(e.Fragment,{children:[z&&e.jsx($e,{...z,onClose:()=>y(null)}),e.jsx(Z,{isOpen:R,onClose:()=>N(!1),onConfirm:w,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',A==null?void 0:A.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:T}),D&&e.jsx(Ue,{title:"إضافة مشرف جديد",onClose:()=>O(!1),children:e.jsxs("form",{onSubmit:d,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:r,onChange:k=>g(k.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:n,onChange:k=>u(k.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),f&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:f}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>O(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:T,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:T,children:[T&&e.jsx(Me,{}),T?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>O(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),E?e.jsx(Ee,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[h.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:G.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:k.email}),e.jsx("button",{onClick:()=>p(k),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},k.id))}),s.length>ne&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:q,totalPages:x,onPageChange:I})})]})]})]})},Re=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Be=({onSubmit:h,initialData:s,onCancel:c,isLoading:r=!1})=>{const[g,n]=t.useState("");t.useEffect(()=>{n(s?s.name:"")},[s]);const u=f=>{f.preventDefault(),g.trim()&&h({name:g})};return e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:g,onChange:f=>n(f.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:r,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:r,children:[r&&e.jsx(Re,{}),r?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},Pe=10,Te=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Pe)].map((h,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),oe=10,ze=({message:h,type:s,onClose:c})=>(t.useEffect(()=>{const n=setTimeout(c,5e3);return()=>clearTimeout(n)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ge=({children:h,onClose:s,title:c})=>(t.useEffect(()=>{const r=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",r),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",r),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),h]})})),Le=()=>{const[h,s]=t.useState([]),[c,r]=t.useState(null),[g,n]=t.useState(!1),[u,f]=t.useState(1),[S,E]=t.useState(!1),[B,T]=t.useState(null),[U,q]=t.useState(!0),[I,D]=t.useState(!1),[O,R]=t.useState(null);t.useEffect(()=>{q(!0);const x=$.collection("categories").orderBy("name").onSnapshot(G=>{const k=G.docs.map(_=>({id:_.id,..._.data()}));s(k),q(!1)},G=>{console.error("Error fetching categories: ",G),N("فشل في تحميل الفئات.","error"),q(!1)});return()=>x()},[]);const N=(x,G)=>{R({message:x,type:G})},A=async x=>{D(!0);try{await $.collection("categories").add(x),N("تمت إضافة الفئة بنجاح!","success"),n(!1),f(1)}catch(G){console.error("Error adding category: ",G),N("حدث خطأ أثناء إضافة الفئة.","error")}finally{D(!1)}},P=async(x,G)=>{D(!0);try{await $.collection("categories").doc(x).update(G),N("تم تحديث الفئة بنجاح!","success"),r(null),n(!1)}catch(k){console.error("Error updating category: ",k),N("حدث خطأ أثناء تحديث الفئة.","error")}finally{D(!1)}},z=x=>{T(x),E(!0)},y=async()=>{if(B){D(!0);try{await $.collection("categories").doc(B.id).delete(),N("تم حذف الفئة بنجاح!","success")}catch(x){console.error("Error deleting category: ",x),N("حدث خطأ أثناء حذف الفئة.","error")}finally{E(!1),T(null),D(!1)}}},j=x=>{r(x),n(!0)},o=()=>{r(null),n(!0)},d=()=>{r(null),n(!1)},p=Math.ceil(h.length/oe),w=h.slice((u-1)*oe,u*oe);return U?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Te,{})]}):e.jsxs("div",{children:[O&&e.jsx(ze,{...O,onClose:()=>R(null)}),e.jsx(Z,{isOpen:S,onClose:()=>E(!1),onConfirm:y,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',B==null?void 0:B.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:I}),g&&e.jsx(Ge,{title:c?"تعديل الفئة":"إضافة فئة جديدة",onClose:d,children:e.jsx(Be,{onSubmit:c?x=>P(c.id,x):A,initialData:c,onCancel:d,isLoading:I})}),e.jsx("button",{onClick:o,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:h.length>0?w.map(x=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:x.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>j(x),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>z(x),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},x.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),h.length>oe&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ce,{currentPage:u,totalPages:p,onPageChange:f})})]})]})},ie=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(Ne,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Se,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Le,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(Fe,{})}],De=({label:h,tabKey:s,activeTab:c,onClick:r})=>e.jsx("button",{onClick:()=>r(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${c===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":c===s,children:h}),Ie=()=>{var r;const[h,s]=t.useState(ie[0].key),c=(r=ie.find(g=>g.key===h))==null?void 0:r.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:ie.map(g=>e.jsx(De,{label:g.label,tabKey:g.key,activeTab:h,onClick:s},g.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:c})]})};export{Ie as default};
