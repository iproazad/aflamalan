import{r as i,j as t,d as F,L as q}from"./index-Dh8Pkb-q.js";import{u as z}from"./useWatchLater-BiQ9AbZF.js";import{u as J,a as Q,R as V}from"./ResumeFromModal-91QD90FT.js";import{M as X}from"./MovieGridSkeleton-B5NCI3A8.js";import{M as Y}from"./MovieGrid-CLmviSHu.js";import{S as ee}from"./SeriesGrid-BKLg3Ej2.js";import{P as te}from"./Pagination-o_qdMaqX.js";import"./MovieCardSkeleton-mlncPtAb.js";import"./SpinnerIcon-DP-3q0I9.js";const E=28,me=()=>{const[f,K]=i.useState([]),[b,T]=i.useState([]),[_,w]=i.useState(!0),{favorites:N}=z(),{favoriteSeries:P}=J(),{addWatchLaterSeries:R,removeWatchLaterSeries:W,isWatchLaterSeries:A,getWatchLaterInfo:k,loading:H}=Q(),[n,U]=i.useState("movies"),[g,C]=i.useState(1),[p,v]=i.useState(null);i.useEffect(()=>{(async()=>{w(!0);const r=async()=>{const a=N.filter(o=>typeof o=="string"&&o.trim()!=="");if(a.length===0)return[];try{const d=[];for(let s=0;s<a.length;s+=30)d.push(a.slice(s,s+30));const y=d.map(s=>F.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",s).get()),m=(await Promise.all(y)).flatMap(s=>s.docs.map(l=>({id:l.id,...l.data()})));return m.sort((s,l)=>{var u,h;return(((u=l.createdAt)==null?void 0:u.toMillis())||0)-(((h=s.createdAt)==null?void 0:h.toMillis())||0)}),m}catch(o){return console.error("Error fetching favorite movies: ",o),[]}},c=async()=>{const a=P.filter(o=>typeof o=="string"&&o.trim()!=="");if(a.length===0)return[];try{const d=[];for(let s=0;s<a.length;s+=30)d.push(a.slice(s,s+30));const y=d.map(s=>F.collection("series").where(window.firebase.firestore.FieldPath.documentId(),"in",s).get()),m=(await Promise.all(y)).flatMap(s=>s.docs.map(l=>({id:l.id,...l.data()})));return m.sort((s,l)=>{var u,h;return(((u=l.createdAt)==null?void 0:u.toMillis())||0)-(((h=s.createdAt)==null?void 0:h.toMillis())||0)}),m}catch(o){return console.error("Error fetching favorite series: ",o),[]}};try{const[a,o]=await Promise.all([r(),c()]);K(a),T(o)}catch(a){console.error("Error fetching all favorite content:",a)}finally{w(!1)}})()},[N,P]),i.useEffect(()=>{C(1)},[n]);const Z=e=>{A(e.id)?W(e.id):v(e)},D=(e,r)=>{p&&R(p.id,e,r),v(null)},S=i.useMemo(()=>f.filter(e=>!e.isKurdish),[f]),M=i.useMemo(()=>f.filter(e=>e.isKurdish),[f]),{paginatedItems:x,totalPages:L,totalItems:G}=i.useMemo(()=>{let e=[];n==="movies"&&(e=S),n==="kurdish"&&(e=M),n==="series"&&(e=b);const r=Math.ceil(e.length/E);return{paginatedItems:e.slice((g-1)*E,g*E),totalPages:r,totalItems:e.length}},[n,g,S,M,b]),$=i.useMemo(()=>new Map(x.map(e=>{const r=k(e.id);return[e.id,r?{season:r.season,episode:r.episode}:null]})),[x,k]),j=({tab:e,label:r,count:c})=>t.jsxs("button",{onClick:()=>U(e),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${n===e?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":n===e,children:[r,t.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${n===e?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:c})]}),I=({message:e,subMessage:r,buttonText:c,link:a})=>t.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[t.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:e}),t.jsx("p",{className:"text-slate-400 mb-6",children:r}),t.jsx(q,{to:a,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:c})]}),B=()=>{if(G>0)return t.jsxs(t.Fragment,{children:[n==="series"?t.jsx(ee,{series:x,onToggleWatchLater:Z,watchLaterInfoMap:$}):t.jsx(Y,{movies:x}),L>1&&t.jsx(te,{currentPage:g,totalPages:L,onPageChange:C})]});switch(n){case"movies":return t.jsx(I,{message:"قائمة أفلامك المفضلة فارغة.",subMessage:"أضف أفلامًا إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return t.jsx(I,{message:"قائمة الأفلام الكردية المفضلة فارغة.",subMessage:"أضف أفلامًا كردية إلى مفضلتك.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return t.jsx(I,{message:"قائمة مسلسلاتك المفضلة فارغة.",subMessage:"أضف مسلسلات إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(V,{isOpen:!!p,onClose:()=>v(null),series:p,onSave:D,isSaving:H}),t.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمتي المفضلة"}),t.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[t.jsx(j,{tab:"movies",label:"أفلام",count:S.length}),t.jsx(j,{tab:"kurdish",label:"كردي",count:M.length}),t.jsx(j,{tab:"series",label:"مسلسلات",count:b.length})]}),_?t.jsx(X,{count:12}):t.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:B()})]})};export{me as default};
