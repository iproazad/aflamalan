import{r as n,a as Q,j as t,d as R,L as V}from"./index-Dz2DXnM8.js";import{u as X}from"./useWatchLater-Bzggdk29.js";import{u as Y,a as ee,R as te}from"./ResumeFromModal-2gxD57xZ.js";import{M as se}from"./MovieGridSkeleton-eo5LrZbc.js";import{M as ae}from"./MovieGrid-XnU7ad2l.js";import{S as re}from"./SeriesGrid-Cs21YUq1.js";import{P as oe}from"./Pagination-C-vk0JvX.js";import"./MovieCardSkeleton-D_IMjcnN.js";import"./SpinnerIcon-DCw0DtRn.js";const y=30,ge=()=>{const[g,_]=n.useState([]),[b,U]=n.useState([]),[W,E]=n.useState(!0),{favorites:k}=X(),{favoriteSeries:N}=Y(),{addWatchLaterSeries:A,removeWatchLaterSeries:H,isWatchLaterSeries:Z,getWatchLaterInfo:C,loading:D}=ee(),[i,G]=n.useState("movies"),[p,v]=n.useState(null),[S,L]=Q(),F=n.useRef(!0),d=parseInt(S.get("page")||"1",10),T=n.useCallback(e=>{const a=new URLSearchParams(S);e<=1?a.delete("page"):a.set("page",e.toString()),L(a,{replace:!0}),window.scrollTo(0,0)},[S,L]);n.useEffect(()=>{(async()=>{E(!0);const a=async()=>{const r=k.filter(o=>typeof o=="string"&&o.trim()!=="");if(r.length===0)return[];try{const m=[];for(let s=0;s<r.length;s+=30)m.push(r.slice(s,s+30));const w=m.map(s=>R.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",s).get()),u=(await Promise.all(w)).flatMap(s=>s.docs.map(l=>({id:l.id,...l.data()})));return u.sort((s,l)=>{var h,f;return(((h=l.createdAt)==null?void 0:h.toMillis())||0)-(((f=s.createdAt)==null?void 0:f.toMillis())||0)}),u}catch(o){return console.error("Error fetching favorite movies: ",o),[]}},c=async()=>{const r=N.filter(o=>typeof o=="string"&&o.trim()!=="");if(r.length===0)return[];try{const m=[];for(let s=0;s<r.length;s+=30)m.push(r.slice(s,s+30));const w=m.map(s=>R.collection("series").where(window.firebase.firestore.FieldPath.documentId(),"in",s).get()),u=(await Promise.all(w)).flatMap(s=>s.docs.map(l=>({id:l.id,...l.data()})));return u.sort((s,l)=>{var h,f;return(((h=l.createdAt)==null?void 0:h.toMillis())||0)-(((f=s.createdAt)==null?void 0:f.toMillis())||0)}),u}catch(o){return console.error("Error fetching favorite series: ",o),[]}};try{const[r,o]=await Promise.all([a(),c()]);_(r),U(o)}catch(r){console.error("Error fetching all favorite content:",r)}finally{E(!1)}})()},[k,N]),n.useEffect(()=>{if(F.current){F.current=!1;return}d!==1&&T(1)},[i]);const $=e=>{Z(e.id)?H(e.id):v(e)},B=(e,a)=>{p&&A(p.id,e,a),v(null)},M=n.useMemo(()=>g.filter(e=>!e.isKurdish),[g]),j=n.useMemo(()=>g.filter(e=>e.isKurdish),[g]),{paginatedItems:x,totalPages:K,totalItems:O}=n.useMemo(()=>{let e=[];i==="movies"&&(e=M),i==="kurdish"&&(e=j),i==="series"&&(e=b);const a=Math.ceil(e.length/y);return{paginatedItems:e.slice((d-1)*y,d*y),totalPages:a,totalItems:e.length}},[i,d,M,j,b]),q=n.useMemo(()=>new Map(x.map(e=>{const a=C(e.id);return[e.id,a?{season:a.season,episode:a.episode}:null]})),[x,C]),I=({tab:e,label:a,count:c})=>t.jsxs("button",{onClick:()=>G(e),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${i===e?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":i===e,children:[a,t.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${i===e?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:c})]}),P=({message:e,subMessage:a,buttonText:c,link:r})=>t.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[t.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:e}),t.jsx("p",{className:"text-slate-400 mb-6",children:a}),t.jsx(V,{to:r,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:c})]}),z=()=>{if(O>0)return t.jsxs(t.Fragment,{children:[i==="series"?t.jsx(re,{series:x,onToggleWatchLater:$,watchLaterInfoMap:q}):t.jsx(ae,{movies:x}),K>1&&t.jsx(oe,{currentPage:d,totalPages:K,onPageChange:T})]});switch(i){case"movies":return t.jsx(P,{message:"قائمة أفلامك المفضلة فارغة.",subMessage:"أضف أفلامًا إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return t.jsx(P,{message:"قائمة الأفلام الكردية المفضلة فارغة.",subMessage:"أضف أفلامًا كردية إلى مفضلتك.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return t.jsx(P,{message:"قائمة مسلسلاتك المفضلة فارغة.",subMessage:"أضف مسلسلات إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(te,{isOpen:!!p,onClose:()=>v(null),series:p,onSave:B,isSaving:D}),t.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمتي المفضلة"}),t.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[t.jsx(I,{tab:"movies",label:"أفلام",count:M.length}),t.jsx(I,{tab:"kurdish",label:"كردي",count:j.length}),t.jsx(I,{tab:"series",label:"مسلسلات",count:b.length})]}),W?t.jsx(se,{count:12}):t.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:z()})]})};export{ge as default};
