import{r as a,a as U,j as t,s as E,L as q}from"./index-DLOQmAiS.js";import{u as z}from"./useWatchLater-9hxFhDiQ.js";import{u as H,a as J,R as Q}from"./ResumeFromModal-8T4Cf5bK.js";import{M as V}from"./MovieGridSkeleton-BIC0evs_.js";import{M as X}from"./MovieGrid-BYeTr3fp.js";import{S as Y}from"./SeriesGrid-C1YPQISH.js";import{P as Z}from"./Pagination-BQtzf5ih.js";import"./MovieCardSkeleton-B2tHPRXo.js";import"./SpinnerIcon-B4FaeE9s.js";const w=30,le=()=>{const[l,N]=a.useState([]),[u,_]=a.useState([]),[F,y]=a.useState(!0),{favorites:h}=z(),{favoriteSeries:f}=H(),{addWatchLaterSeries:R,removeWatchLaterSeries:C,isWatchLaterSeries:W,getWatchLaterInfo:k,loading:D}=J(),[o,G]=a.useState("movies"),[d,g]=a.useState(null),[x,P]=U(),L=a.useRef(!0),c=parseInt(x.get("page")||"1",10),T=a.useCallback(e=>{const s=new URLSearchParams(x);e<=1?s.delete("page"):s.set("page",e.toString()),P(s,{replace:!0}),window.scrollTo(0,0)},[x,P]);a.useEffect(()=>{(async()=>{y(!0);const s=async()=>{if(h.length===0)return[];try{const{data:r,error:n}=await E.from("movies").select("*").in("id",h);if(n)throw n;return r.sort((j,M)=>new Date(M.created_at).getTime()-new Date(j.created_at).getTime()),r}catch(r){return console.error("Error fetching favorite movies: ",r),[]}},i=async()=>{if(f.length===0)return[];try{const{data:r,error:n}=await E.from("series").select("*").in("id",f);if(n)throw n;return r.sort((j,M)=>new Date(M.created_at).getTime()-new Date(j.created_at).getTime()),r}catch(r){return console.error("Error fetching favorite series: ",r),[]}};try{const[r,n]=await Promise.all([s(),i()]);N(r),_(n)}catch(r){console.error("Error fetching all favorite content:",r)}finally{y(!1)}})()},[h,f]),a.useEffect(()=>{if(L.current){L.current=!1;return}c!==1&&T(1)},[o]);const A=e=>{W(e.id)?C(e.id):g(e)},$=(e,s)=>{d&&R(d.id,e,s),g(null)},p=a.useMemo(()=>l.filter(e=>e.movie_type==="kurdish"||e.is_kurdish===!0),[l]),b=a.useMemo(()=>l.filter(e=>e.movie_type!=="kurdish"&&!e.is_kurdish),[l]),{paginatedItems:m,totalPages:I,totalItems:B}=a.useMemo(()=>{let e=[];o==="movies"&&(e=b),o==="kurdish"&&(e=p),o==="series"&&(e=u);const s=Math.ceil(e.length/w);return{paginatedItems:e.slice((c-1)*w,c*w),totalPages:s,totalItems:e.length}},[o,c,b,p,u]),K=a.useMemo(()=>new Map(m.map(e=>{const s=k(e.id);return[e.id,s?{season:s.season,episode:s.episode}:null]})),[m,k]),v=({tab:e,label:s,count:i})=>t.jsxs("button",{onClick:()=>G(e),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${o===e?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":o===e,children:[s,t.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${o===e?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:i})]}),S=({message:e,subMessage:s,buttonText:i,link:r})=>t.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[t.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:e}),t.jsx("p",{className:"text-slate-400 mb-6",children:s}),t.jsx(q,{to:r,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:i})]}),O=()=>{if(B>0)return t.jsxs(t.Fragment,{children:[o==="series"?t.jsx(Y,{series:m,onToggleWatchLater:A,watchLaterInfoMap:K}):t.jsx(X,{movies:m}),I>1&&t.jsx(Z,{currentPage:c,totalPages:I,onPageChange:T})]});switch(o){case"movies":return t.jsx(S,{message:"قائمة أفلامك المفضلة فارغة.",subMessage:"أضف أفلامًا إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return t.jsx(S,{message:"قائمة الأفلام الكردية المفضلة فارغة.",subMessage:"أضف أفلامًا كردية إلى مفضلتك.",buttonText:"تصفح الأفلام الكردية",link:"/movies/kurdish"});case"series":return t.jsx(S,{message:"قائمة مسلسلاتك المفضلة فارغة.",subMessage:"أضف مسلسلات إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(Q,{isOpen:!!d,onClose:()=>g(null),series:d,onSave:$,isSaving:D}),t.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمتي المفضلة"}),t.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[t.jsx(v,{tab:"movies",label:"أفلام",count:b.length}),t.jsx(v,{tab:"kurdish",label:"كردي",count:p.length}),t.jsx(v,{tab:"series",label:"مسلسلات",count:u.length})]}),F?t.jsx(V,{count:12}):t.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:O()})]})};export{le as default};
