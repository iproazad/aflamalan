import{r as t,d as F,j as e,f as xe,F as ee,T as me,u as fe,h as ye,i as je,s as Ne}from"./index-Dz2DXnM8.js";import{P as ie}from"./Pagination-C-vk0JvX.js";import{F as re,S as ae}from"./SpinnerIcon-DCw0DtRn.js";const we=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ve=({onSubmit:p,initialData:s,onCancel:m,isKurdishByDefault:i=!1,isLoading:y=!1,allGenres:l=[]})=>{const[a,g]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1,imdbRating:void 0}),[C,M]=t.useState(""),[A,I]=t.useState(!1),[T,_]=t.useState(""),[K,B]=t.useState(""),[D,q]=t.useState(!1),E=t.useRef(null),[f,v]=t.useState(!1),[$,N]=t.useState(""),b=t.useRef(null);t.useEffect(()=>{s?(g({...s,genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"1080p"}],backupServers:s.backupServers||[],trailerUrl:s.trailerUrl||"",isKurdish:s.isKurdish||!1,imdbRating:s.imdbRating,downloadUrl:s.downloadUrl||""}),M((s.tags||[]).join(", "))):(g({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:i,imdbRating:void 0}),M(""))},[s,i]),t.useEffect(()=>{const r=h=>{E.current&&!E.current.contains(h.target)&&I(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]),t.useEffect(()=>{b.current&&clearTimeout(b.current);const r=a.title.trim();if(!r||s&&r===s.title.trim()){N(""),v(!1);return}return v(!0),N(""),b.current=window.setTimeout(async()=>{try{const h=await F.collection("movies").where("title","==",r).get();let j=!1;h.empty||(s?h.forEach(L=>{L.id!==s.id&&(j=!0)}):j=!0),N(j?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(h){console.error("Error checking for duplicate title:",h)}finally{v(!1)}},500),()=>{b.current&&clearTimeout(b.current)}},[a.title,s]),t.useEffect(()=>{const r=a.downloadUrl;if(r&&r.includes("vidtube.pro/d/")){const h=r.replace("/d/","/embed-");a.servers.length>0&&a.servers[0].url!==h&&g(j=>{const L=[...j.servers];return L[0]={...L[0],url:h},{...j,servers:L}})}},[a.downloadUrl]),t.useEffect(()=>{if(!s){const r=a.title.match(/\b(19[89]\d|20\d{2})\b/);if(r&&r[0]){const h=parseInt(r[0],10);g(j=>({...j,year:h}))}}},[a.title,s]),t.useEffect(()=>{!s&&!a.backdropUrl.trim()&&g(r=>({...r,backdropUrl:r.posterUrl}))},[a.posterUrl,s,a.backdropUrl]);const o=r=>{const{name:h,value:j,type:L}=r.target;if(L==="checkbox"){const{checked:G}=r.target;g(J=>({...J,[h]:G}))}else if(h==="year"){const G=parseInt(j,10);g(J=>({...J,[h]:isNaN(G)?0:G}))}else if(h==="imdbRating"){const G=parseFloat(j);g(J=>({...J,imdbRating:isNaN(G)?void 0:G}))}else g(G=>({...G,[h]:j}))},n=r=>{M(r.target.value)},d=r=>{g(h=>{const j=h.genres||[],L=j.includes(r)?j.filter(G=>G!==r):[...j,r];return{...h,genres:L}})},w=async()=>{const r=K.trim();if(r){if(l.some(h=>h.toLowerCase()===r.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}q(!0);try{await F.collection("categories").add({name:r}),g(h=>({...h,genres:[...h.genres||[],r]})),B("")}catch(h){console.error("Error adding new genre:",h),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{q(!1)}}},c=(r,h,j)=>{const L=[...a.servers];L[r]={...L[r],[h]:j},g(G=>({...G,servers:L}))},k=()=>{g(r=>{const h={name:`Server ${r.servers.length+1}`,url:"",quality:"1080p"};return{...r,servers:[...r.servers,h]}})},S=r=>{g(h=>({...h,servers:h.servers.filter((j,L)=>L!==r)}))},P=(r,h,j)=>{const L=[...a.backupServers||[]];L[r]={...L[r],[h]:j},g(G=>({...G,backupServers:L}))},se=()=>{g(r=>{var h;return{...r,backupServers:[...r.backupServers||[],{name:`Backup Server ${(((h=r.backupServers)==null?void 0:h.length)||0)+1}`,url:"",quality:"1080p",noSubUrl:""}]}})},W=r=>{g(h=>({...h,backupServers:(h.backupServers||[]).filter((j,L)=>L!==r)}))},te=r=>{if(r.preventDefault(),a.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const h=C.split(",").map(j=>j.trim()).filter(j=>j!=="");p({...a,tags:h})},Y=l.filter(r=>r.toLowerCase().includes(T.toLowerCase())),V="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",H="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:a.title,onChange:o,placeholder:"عنوان الفيلم",required:!0,className:V}),f&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),$&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),$]})]}),e.jsx("input",{type:"number",name:"year",value:a.year||"",onChange:o,placeholder:"سنة الإنتاج",required:!0,className:V})]}),e.jsx("textarea",{name:"description",value:a.description,onChange:o,placeholder:"وصف الفيلم",required:!0,className:`${V} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:a.posterUrl,onChange:o,placeholder:"رابط صورة البوستر",required:!0,className:V}),e.jsx("input",{type:"url",name:"backdropUrl",value:a.backdropUrl,onChange:o,placeholder:"رابط صورة الخلفية",required:!0,className:V})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:a.imdbRating??"",onChange:o,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:V}),e.jsx("input",{type:"url",name:"trailerUrl",value:a.trailerUrl??"",onChange:o,placeholder:"رابط المقطع الدعائي (اختياري)",className:V})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:C,onChange:n,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:V})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!a.isKurdish,onChange:o,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:E,children:[e.jsxs("button",{type:"button",onClick:()=>I(r=>!r),className:`${V} text-right flex justify-between items-center`,children:[e.jsx("span",{children:a.genres.length>0?a.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${A?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),A&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:T,onChange:r=>_(r.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:Y.map(r=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.genres.includes(r),onChange:()=>d(r),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:r})]},r))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:K,onChange:r=>B(r.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:w,disabled:D||!K.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:D?"...":"إضافة"})]})})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),a.servers.map((r,h)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:r.name,onChange:j=>c(h,"name",j.target.value),placeholder:"اسم السيرفر",className:`${H} flex-1`}),e.jsxs("select",{value:r.quality,onChange:j=>c(h,"quality",j.target.value),className:`${H} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),a.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>S(h),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),h===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:r.url,onChange:j=>c(h,"url",j.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${H} w-full`}),e.jsx("input",{type:"url",name:"downloadUrl",value:a.downloadUrl||"",onChange:o,placeholder:"رابط تحميل الفيلم (اختياري)",className:`${H} w-full`})]}):e.jsx("input",{type:"url",value:r.url,onChange:j=>c(h,"url",j.target.value),placeholder:"رابط السيرفر",required:!0,className:`${H} w-full`})]},h)),e.jsx("button",{type:"button",onClick:k,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(a.backupServers||[]).map((r,h)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:r.name,onChange:j=>P(h,"name",j.target.value),placeholder:"اسم السيرفر",className:`${H} flex-1`}),e.jsxs("select",{value:r.quality,onChange:j=>P(h,"quality",j.target.value),className:`${H} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>W(h),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:r.url,onChange:j=>P(h,"url",j.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${H} w-full`}),e.jsx("input",{type:"url",value:r.noSubUrl||"",onChange:j=>P(h,"noSubUrl",j.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${H} w-full`})]})]},h)),e.jsx("button",{type:"button",onClick:se,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:y,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:y||f||!!$,children:[y&&e.jsx(we,{}),y?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},Ce=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),X=({isOpen:p,onClose:s,onConfirm:m,title:i,message:y,isLoading:l=!1})=>{const[a,g]=t.useState(p);return t.useEffect(()=>{if(p)g(!0);else{const C=setTimeout(()=>g(!1),300);return()=>clearTimeout(C)}},[p]),a?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${p?"animate-fade-in":"animate-fade-out"}`,onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${p?"animate-zoom-in":"animate-zoom-out"}`,onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:i}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:y})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:m,disabled:l,children:[l&&e.jsx(Ce,{}),l?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:l,children:"إلغاء"})]})]})}):null},ke=10,pe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((p,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(ke)].map((p,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((m,i)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},i))]},s))})]})})]}),he=({message:p,type:s,onClose:m})=>(t.useEffect(()=>{const l=setTimeout(m,5e3);return()=>clearTimeout(l)},[m]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:m,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),ge=({genres:p,onSubmit:s,onClose:m,isLoading:i})=>{const[y,l]=t.useState(p[0]||""),[a,g]=t.useState("add"),C=M=>{M.preventDefault(),y&&s(y,a)};return e.jsx(re,{title:"تغيير الفئة بشكل جماعي",onClose:m,isOpen:!0,children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:y,onChange:M=>l(M.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:p.map(M=>e.jsx("option",{value:M,children:M},M))}),e.jsxs("select",{value:a,onChange:M=>g(M.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:m,disabled:i,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:i||!y,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[i&&e.jsx(ae,{}),i?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Se=({onSubmit:p,onClose:s,isLoading:m})=>{const[i,y]=t.useState(new Date().getFullYear()),l=a=>{a.preventDefault(),p(i)};return e.jsx(re,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,isOpen:!0,children:e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:i,onChange:a=>y(parseInt(a.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:m,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[m&&e.jsx(ae,{}),m?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},be=({onSubmit:p,onClose:s,isLoading:m})=>{const[i,y]=t.useState(""),[l,a]=t.useState("add"),g=C=>{C.preventDefault(),i.trim()&&p(i.trim(),l)};return e.jsx(re,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,isOpen:!0,children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:i,onChange:C=>y(C.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:l,onChange:C=>a(C.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:m||!i.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[m&&e.jsx(ae,{}),m?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},le=10,Ee=()=>{const[p,s]=t.useState([]),[m,i]=t.useState(null),[y,l]=t.useState(!1),[a,g]=t.useState(1),[C,M]=t.useState("all"),[A,I]=t.useState(""),[T,_]=t.useState(!1),[K,B]=t.useState(null),[D,q]=t.useState(!0),[E,f]=t.useState(!1),[v,$]=t.useState(null),[N,b]=t.useState([]),[o,n]=t.useState(null),[d,w]=t.useState([]);t.useEffect(()=>{q(!0);const u=F.collection("movies").orderBy("createdAt","desc").onSnapshot(z=>{const Z=z.docs.map(Q=>({id:Q.id,...Q.data()}));s(Z),q(!1)},z=>{console.error("Error fetching movies: ",z),$({message:"فشل في تحميل الأفلام.",type:"error"}),q(!1)}),U=F.collection("categories").orderBy("name").onSnapshot(z=>{const Z=z.docs.map(Q=>Q.data().name);w(Z)},z=>{console.error("Error fetching categories from ManageMovies: ",z)});return()=>{u(),U()}},[]),t.useEffect(()=>{g(1),b([])},[C,A]);const c=(u,U)=>{$({message:u,type:U})},k=async u=>{f(!0);try{await F.collection("movies").add({...u,createdAt:me.now()}),l(!1),g(1),c("تمت إضافة الفيلم بنجاح.","success")}catch(U){console.error("Error adding movie: ",U),c("حدث خطأ أثناء إضافة الفيلم.","error")}finally{f(!1)}},S=async(u,U)=>{f(!0);try{await F.collection("movies").doc(u).update(U),i(null),l(!1),c("تم تحديث الفيلم بنجاح.","success")}catch(z){console.error("Error updating movie: ",z),c("حدث خطأ أثناء تحديث الفيلم.","error")}finally{f(!1)}},P=u=>{B(u),_(!0)},se=async()=>{if(K){f(!0);try{await F.collection("movies").doc(K.id).delete(),c("تم حذف الفيلم بنجاح.","success")}catch(u){console.error("Error deleting movie: ",u),c("حدث خطأ أثناء حذف الفيلم.","error")}finally{_(!1),B(null),f(!1)}}},W=u=>{i(u),l(!0)},te=()=>{i(null),l(!0)},Y=()=>{i(null),l(!1),n(null)},V=u=>{b(U=>U.includes(u)?U.filter(z=>z!==u):[...U,u])},H=u=>{u.target.checked?b(x.map(U=>U.id)):b([])},r=async(u,U)=>{f(!0);try{const z=F.batch();N.forEach(Z=>{const Q=F.collection("movies").doc(Z);z.update(Q,u)}),await z.commit(),c(U,"success"),b([])}catch(z){console.error("Bulk update failed:",z),c("فشل التحديث الجماعي.","error")}finally{f(!1),n(null)}},h=async()=>{f(!0);try{const u=F.batch();N.forEach(U=>{const z=F.collection("movies").doc(U);u.delete(z)}),await u.commit(),c(`تم حذف ${N.length} فيلم بنجاح.`,"success"),b([])}catch(u){console.error("Bulk delete failed:",u),c("فشل الحذف الجماعي.","error")}finally{f(!1),n(null)}},j=async(u,U)=>{const z={genres:U==="add"?ee.arrayUnion(u):ee.arrayRemove(u)};await r(z,`تم ${U==="add"?"إضافة":"إزالة"} فئة "${u}" بنجاح.`)},L=async(u,U)=>{const z={tags:U==="add"?ee.arrayUnion(u):ee.arrayRemove(u)};await r(z,`تم ${U==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${u}" بنجاح.`)},G=p.filter(u=>C==="kurdish"?u.isKurdish===!0:C==="non-kurdish"?!u.isKurdish:!0).filter(u=>xe(A,u.title)),J=Math.ceil(G.length/le),x=G.slice((a-1)*le,a*le),R=u=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${C===u?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,O=x.length>0&&N.length===x.length;return D?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[v&&e.jsx(he,{...v,onClose:()=>$(null)}),e.jsx(X,{isOpen:T,onClose:()=>_(!1),onConfirm:se,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',K==null?void 0:K.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:E}),o==="delete"&&e.jsx(X,{isOpen:!0,onClose:()=>n(null),onConfirm:h,title:`تأكيد حذف ${N.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:E}),o==="genre"&&e.jsx(ge,{genres:d,onClose:Y,onSubmit:j,isLoading:E}),o==="tags"&&e.jsx(be,{onClose:Y,onSubmit:L,isLoading:E}),o==="year"&&e.jsx(Se,{onClose:Y,onSubmit:u=>r({year:u},"تم تحديث السنة بنجاح."),isLoading:E}),o==="markKurdish"&&e.jsx(X,{isOpen:!0,onClose:Y,onConfirm:()=>r({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:E}),o==="unmarkKurdish"&&e.jsx(X,{isOpen:!0,onClose:Y,onConfirm:()=>r({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:E}),y&&e.jsx(re,{title:m?"تعديل الفيلم":"إضافة فيلم جديد",onClose:Y,isOpen:y,children:e.jsx(ve,{onSubmit:m?u=>S(m.id,u):k,initialData:m,onCancel:Y,isKurdishByDefault:C==="kurdish"&&!m,isLoading:E,allGenres:d})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:te,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:A,onChange:u=>I(u.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>M("all"),className:R("all"),children:"الكل"}),e.jsx("button",{onClick:()=>M("kurdish"),className:R("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>M("non-kurdish"),className:R("non-kurdish"),children:"غير كردي"})]})]}),N.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[N.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>b([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>n("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>n("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>n("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>n("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>n("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>n("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:H,checked:O,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:x.map(u=>{var U,z,Z;return e.jsxs("tr",{className:`${N.includes(u.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:N.includes(u.id),onChange:()=>V(u.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:u.posterUrl,alt:u.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:u.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:u.imdbRating?u.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:u.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(U=u.genres)==null?void 0:U.slice(0,3).map(Q=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:Q},Q)),((z=u.genres)==null?void 0:z.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:u.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(Z=u.createdAt)!=null&&Z.toDate?u.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>W(u),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>P(u),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},u.id)})})]})}),G.length>le&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:a,totalPages:J,onPageChange:g})})]})]})},Ae=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ue=({onSubmit:p,initialData:s,onCancel:m,isLoading:i=!1,allGenres:y=[]})=>{const[l,a]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{seasonNumber:1,title:"الموسم 1",description:"",posterUrl:"",year:new Date().getFullYear(),episodes:[{episodeNumber:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",downloadUrl:"",quality:"1080p"}],imdbRating:0}],trailerUrl:"",imdbRating:0}),[g,C]=t.useState(""),[M,A]=t.useState(!1),I=t.useRef(null);t.useEffect(()=>{s&&(a({...s,genres:s.genres||[],tags:s.tags||[],seasons:s.seasons&&s.seasons.length>0?s.seasons:[{seasonNumber:1,title:"الموسم 1",description:"",posterUrl:s.posterUrl,year:s.year,episodes:[],imdbRating:0}],trailerUrl:s.trailerUrl||"",imdbRating:s.imdbRating||0}),C((s.tags||[]).join(", ")))},[s]),t.useEffect(()=>{const o=n=>{I.current&&!I.current.contains(n.target)&&A(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const T=o=>{const{name:n,value:d}=o.target;if(n==="year"||n==="imdbRating"){const w=parseFloat(d);a(c=>({...c,[n]:isNaN(w)?0:w}))}else a(w=>({...w,[n]:d}))},_=o=>{C(o.target.value)},K=o=>{a(n=>({...n,genres:n.genres.includes(o)?n.genres.filter(d=>d!==o):[...n.genres,o]}))},B=(o,n,d)=>{const w=[...l.seasons],c={...w[o]};if(n==="seasonNumber"||n==="year"||n==="imdbRating"){const k=typeof d=="string"?parseFloat(d):d;c[n]=isNaN(k)?0:k}else c[n]=d;w[o]=c,a(k=>({...k,seasons:w}))},D=()=>{const o=l.seasons.length>0?Math.max(...l.seasons.map(d=>d.seasonNumber))+1:1,n=l.seasons.length>0?l.seasons[l.seasons.length-1].year:l.year;a(d=>({...d,seasons:[...d.seasons,{seasonNumber:o,title:`الموسم ${o}`,description:"",posterUrl:d.posterUrl,year:n+1,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",downloadUrl:"",quality:"1080p"}],imdbRating:0}]}))},q=o=>{a(n=>({...n,seasons:n.seasons.filter((d,w)=>w!==o)}))},E=(o,n,d,w)=>{const c=[...l.seasons],k=[...c[o].episodes],S={...k[n]};if(d==="episodeNumber"){const P=typeof w=="string"?parseFloat(w):w;S[d]=isNaN(P)?0:P}else S[d]=w;k[n]=S,c[o]={...c[o],episodes:k},a(P=>({...P,seasons:c}))},f=o=>{const n=l.seasons[o],d=n.episodes.length>0?Math.max(...n.episodes.map(k=>k.episodeNumber))+1:1,w={episodeNumber:d,title:`الحلقة ${d}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",downloadUrl:"",quality:"1080p"},c=l.seasons.map((k,S)=>S===o?{...k,episodes:[...k.episodes,w]}:k);a(k=>({...k,seasons:c}))},v=(o,n)=>{const d=l.seasons.map((w,c)=>c===o?{...w,episodes:w.episodes.filter((k,S)=>S!==n)}:w);a(w=>({...w,seasons:d}))},$=o=>{o.preventDefault();const n=g.split(",").map(d=>d.trim()).filter(Boolean);p({...l,tags:n})},N="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",b="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:l.title,onChange:T,placeholder:"عنوان المسلسل",required:!0,className:N}),e.jsx("input",{type:"number",name:"year",value:l.year||"",onChange:T,placeholder:"سنة بداية العرض",required:!0,className:N})]}),e.jsx("textarea",{name:"description",value:l.description,onChange:T,placeholder:"وصف المسلسل العام",required:!0,className:`${N} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:l.posterUrl,onChange:T,placeholder:"رابط البوستر الرئيسي",required:!0,className:N}),e.jsx("input",{type:"url",name:"backdropUrl",value:l.backdropUrl,onChange:T,placeholder:"رابط صورة الخلفية",required:!0,className:N})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:l.imdbRating??"",onChange:T,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:N}),e.jsx("input",{type:"url",name:"trailerUrl",value:l.trailerUrl??"",onChange:T,placeholder:"رابط المقطع الدعائي (اختياري)",className:N})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:I,children:[e.jsx("button",{type:"button",onClick:()=>A(o=>!o),className:`${N} text-right`,children:l.genres.length>0?l.genres.join(", "):"اختر الفئات..."}),M&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:y.map(o=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.genres.includes(o),onChange:()=>K(o),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:o})]},o))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:g,onChange:_,placeholder:"أكشن, إثارة...",className:N})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),l.seasons.map((o,n)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:o.seasonNumber||"",onChange:d=>B(n,"seasonNumber",d.target.value),className:`${b} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>q(n),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:o.title,onChange:d=>B(n,"title",d.target.value),placeholder:"عنوان الموسم",required:!0,className:b}),e.jsx("input",{type:"number",value:o.year||"",onChange:d=>B(n,"year",d.target.value),placeholder:"سنة الموسم",required:!0,className:b}),e.jsx("input",{type:"number",value:o.imdbRating??"",onChange:d=>B(n,"imdbRating",d.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:b}),e.jsx("input",{type:"url",value:o.posterUrl,onChange:d=>B(n,"posterUrl",d.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${b} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:o.description,onChange:d=>B(n,"description",d.target.value),placeholder:"وصف الموسم",required:!0,className:`${b} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",o.seasonNumber,":"]}),o.episodes.map((d,w)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:d.episodeNumber||"",onChange:c=>E(n,w,"episodeNumber",c.target.value),placeholder:"رقم",className:`${b} w-16`}),e.jsx("input",{type:"text",value:d.title,onChange:c=>E(n,w,"title",c.target.value),placeholder:"عنوان الحلقة",className:`${b} flex-1`}),e.jsx("button",{type:"button",onClick:()=>v(n,w),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:d.url,onChange:c=>E(n,w,"url",c.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${b} flex-1`}),e.jsxs("select",{value:d.quality||"1080p",onChange:c=>E(n,w,"quality",c.target.value),className:`${b} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]})]}),e.jsx("input",{type:"url",value:d.downloadUrl||"",onChange:c=>E(n,w,"downloadUrl",c.target.value),placeholder:"رابط التحميل (اختياري)",className:`${b} w-full`})]})]},w)),e.jsx("button",{type:"button",onClick:()=>f(n),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},n)),e.jsx("button",{type:"button",onClick:D,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:i,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:i,children:[i&&e.jsx(Ae,{}),s?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},ne=10,Me=()=>{const[p,s]=t.useState([]),[m,i]=t.useState(null),[y,l]=t.useState(!1),[a,g]=t.useState(1),[C,M]=t.useState(""),[A,I]=t.useState(!1),[T,_]=t.useState(null),[K,B]=t.useState(!0),[D,q]=t.useState(!1),[E,f]=t.useState(null),[v,$]=t.useState([]),[N,b]=t.useState(null),[o,n]=t.useState([]);t.useEffect(()=>{B(!0);const x=F.collection("series").orderBy("createdAt","desc").onSnapshot(O=>{const u=O.docs.map(U=>({id:U.id,...U.data()}));s(u),B(!1)},O=>{console.error("Error fetching series: ",O),f({message:"فشل في تحميل المسلسلات.",type:"error"}),B(!1)}),R=F.collection("categories").orderBy("name").onSnapshot(O=>{const u=O.docs.map(U=>U.data().name);n(u)},O=>{console.error("Error fetching categories from ManageSeries: ",O)});return()=>{x(),R()}},[]),t.useEffect(()=>{g(1),$([])},[C]);const d=(x,R)=>{f({message:x,type:R})},w=async x=>{q(!0);try{await F.collection("series").add({...x,createdAt:me.now()}),l(!1),g(1),d("تمت إضافة المسلسل بنجاح.","success")}catch(R){console.error("Error adding series: ",R),d("حدث خطأ أثناء إضافة المسلسل.","error")}finally{q(!1)}},c=async(x,R)=>{q(!0);try{await F.collection("series").doc(x).update(R),i(null),l(!1),d("تم تحديث المسلسل بنجاح.","success")}catch(O){console.error("Error updating series: ",O),d("حدث خطأ أثناء تحديث المسلسل.","error")}finally{q(!1)}},k=x=>{_(x),I(!0)},S=async()=>{if(T){q(!0);try{await F.collection("series").doc(T.id).delete(),d("تم حذف المسلسل بنجاح.","success")}catch(x){console.error("Error deleting series: ",x),d("حدث خطأ أثناء حذف المسلسل.","error")}finally{I(!1),_(null),q(!1)}}},P=x=>{i(x),l(!0)},se=()=>{i(null),l(!0)},W=()=>{i(null),l(!1),b(null)},te=x=>{$(R=>R.includes(x)?R.filter(O=>O!==x):[...R,x])},Y=x=>{x.target.checked?$(G.map(R=>R.id)):$([])},V=async()=>{q(!0);try{const x=F.batch();v.forEach(R=>{const O=F.collection("series").doc(R);x.delete(O)}),await x.commit(),d(`تم حذف ${v.length} مسلسل بنجاح.`,"success"),$([])}catch(x){console.error("Bulk delete failed:",x),d("فشل الحذف الجماعي.","error")}finally{q(!1),b(null)}},H=async(x,R)=>{const O={genres:R==="add"?ee.arrayUnion(x):ee.arrayRemove(x)};await h(O,`تم ${R==="add"?"إضافة":"إزالة"} فئة "${x}" بنجاح.`)},r=async(x,R)=>{const O={tags:R==="add"?ee.arrayUnion(x):ee.arrayRemove(x)};await h(O,`تم ${R==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${x}" بنجاح.`)},h=async(x,R)=>{q(!0);try{const O=F.batch();v.forEach(u=>{const U=F.collection("series").doc(u);O.update(U,x)}),await O.commit(),d(R,"success"),$([])}catch(O){console.error("Bulk update failed:",O),d("فشل التحديث الجماعي.","error")}finally{q(!1),b(null)}},j=p.filter(x=>xe(C,x.title)),L=Math.ceil(j.length/ne),G=j.slice((a-1)*ne,a*ne),J=G.length>0&&v.length===G.length;return K?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[E&&e.jsx(he,{...E,onClose:()=>f(null)}),e.jsx(X,{isOpen:A,onClose:()=>I(!1),onConfirm:S,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',T==null?void 0:T.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:D}),N==="delete"&&e.jsx(X,{isOpen:!0,onClose:()=>b(null),onConfirm:V,title:`تأكيد حذف ${v.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:D}),N==="genre"&&e.jsx(ge,{genres:o,onClose:W,onSubmit:H,isLoading:D}),N==="tags"&&e.jsx(be,{onClose:W,onSubmit:r,isLoading:D}),y&&e.jsx(re,{title:m?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:W,isOpen:y,children:e.jsx(Ue,{onSubmit:m?x=>c(m.id,x):w,initialData:m,onCancel:W,isLoading:D,allGenres:o})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:se,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsx("div",{className:"relative w-full sm:flex-grow",children:e.jsx("input",{type:"text",value:C,onChange:x=>M(x.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-4 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})})]}),v.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("span",{className:"text-white font-bold",children:[v.length," مسلسل محدد"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>b("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>b("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>b("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:Y,checked:J})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:G.map(x=>{var R,O;return e.jsxs("tr",{className:`${v.includes(x.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:v.includes(x.id),onChange:()=>te(x.id)})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:x.posterUrl,alt:x.title,className:"h-20 w-auto rounded"})}),e.jsx("td",{className:"px-4 py-2 font-medium text-white",children:x.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:x.imdbRating?x.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:x.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:((R=x.seasons)==null?void 0:R.length)||0}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:(O=x.createdAt)!=null&&O.toDate?x.createdAt.toDate().toLocaleDateString("ar-EG"):"N/A"}),e.jsxs("td",{className:"px-4 py-2 font-medium",children:[e.jsx("button",{onClick:()=>P(x),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>k(x),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},x.id)})})]})}),j.length>ne&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:a,totalPages:L,onPageChange:g})})]})]})},$e=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((p,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},s))})]}),Re="yO8pzykKincc5zgbdJGdN6xISr03",oe=10,Fe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Te=({message:p,type:s,onClose:m})=>(t.useEffect(()=>{const l=setTimeout(m,5e3);return()=>clearTimeout(l)},[m]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:m,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Be=({children:p,onClose:s,title:m,isOpen:i})=>{const[y,l]=t.useState(i);return t.useEffect(()=>{if(i){l(!0),document.body.style.overflow="hidden";const a=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}}else{const a=setTimeout(()=>{l(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(a)}},[i,s]),y?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:m}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),p]})}):null},Oe=()=>{const{currentUser:p}=fe(),[s,m]=t.useState([]),[i,y]=t.useState(""),[l,a]=t.useState(""),[g,C]=t.useState(""),[M,A]=t.useState(!0),[I,T]=t.useState(!1),[_,K]=t.useState(1),[B,D]=t.useState(!1),[q,E]=t.useState(!1),[f,v]=t.useState(null),[$,N]=t.useState(null),b=(p==null?void 0:p.uid)===Re;t.useEffect(()=>{if(!b){A(!1);return}A(!0);const S=F.collection("admins").onSnapshot(P=>{const se=P.docs.map(W=>({id:W.id,uid:W.data().uid,email:W.data().email}));m(se),A(!1)},P=>{console.error(P),o("فشل في تحميل قائمة المشرفين.","error"),A(!1)});return()=>S()},[b]);const o=(S,P)=>{N({message:S,type:P})},n=async S=>{if(S.preventDefault(),C(""),!i.trim()||!l.trim()){C("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}T(!0);try{await F.collection("admins").doc(i).set({uid:i,email:l}),o(`تمت إضافة المشرف ${l} بنجاح.`,"success"),D(!1),y(""),a("")}catch(P){console.error("Error adding admin:",P),o("فشل في إضافة المشرف.","error")}finally{T(!1)}},d=S=>{v(S),E(!0)},w=async()=>{if(f){T(!0);try{await F.collection("admins").doc(f.id).delete(),o(`تم حذف المشرف ${f.email} بنجاح.`,"success")}catch(S){console.error(S),o("حدث خطأ أثناء حذف المشرف.","error")}finally{E(!1),v(null),T(!1)}}};if(!b)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const c=Math.ceil(s.length/oe),k=s.slice((_-1)*oe,_*oe);return e.jsxs(e.Fragment,{children:[$&&e.jsx(Te,{...$,onClose:()=>N(null)}),e.jsx(X,{isOpen:q,onClose:()=>E(!1),onConfirm:w,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',f==null?void 0:f.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:I}),e.jsx(Be,{isOpen:B,title:"إضافة مشرف جديد",onClose:()=>D(!1),children:e.jsxs("form",{onSubmit:n,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:i,onChange:S=>y(S.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:l,onChange:S=>a(S.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),g&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:g}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>D(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:I,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:I,children:[I&&e.jsx(Fe,{}),I?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>D(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),M?e.jsx($e,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[p.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:k.map(S=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:S.email}),e.jsx("button",{onClick:()=>d(S),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},S.id))}),s.length>oe&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:_,totalPages:c,onPageChange:K})})]})]})]})},qe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Pe=({onSubmit:p,initialData:s,onCancel:m,isLoading:i=!1})=>{const[y,l]=t.useState("");t.useEffect(()=>{l(s?s.name:"")},[s]);const a=g=>{g.preventDefault(),y.trim()&&p({name:y})};return e.jsxs("form",{onSubmit:a,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:y,onChange:g=>l(g.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:i,children:[i&&e.jsx(qe,{}),i?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},Le=10,ze=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Le)].map((p,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),ce=10,Ge=({message:p,type:s,onClose:m})=>(t.useEffect(()=>{const l=setTimeout(m,5e3);return()=>clearTimeout(l)},[m]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:m,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ie=({children:p,onClose:s,title:m,isOpen:i})=>{const[y,l]=t.useState(i);return t.useEffect(()=>{if(i){l(!0),document.body.style.overflow="hidden";const a=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}}else{const a=setTimeout(()=>{l(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(a)}},[i,s]),y?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:m}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),p]})}):null},De=()=>{const[p,s]=t.useState([]),[m,i]=t.useState(null),[y,l]=t.useState(!1),[a,g]=t.useState(1),[C,M]=t.useState(!1),[A,I]=t.useState(null),[T,_]=t.useState(!0),[K,B]=t.useState(!1),[D,q]=t.useState(null);t.useEffect(()=>{_(!0);const c=F.collection("categories").orderBy("name").onSnapshot(k=>{const S=k.docs.map(P=>({id:P.id,...P.data()}));s(S),_(!1)},k=>{console.error("Error fetching categories: ",k),E("فشل في تحميل الفئات.","error"),_(!1)});return()=>c()},[]);const E=(c,k)=>{q({message:c,type:k})},f=async c=>{B(!0);try{await F.collection("categories").add(c),E("تمت إضافة الفئة بنجاح!","success"),l(!1),g(1)}catch(k){console.error("Error adding category: ",k),E("حدث خطأ أثناء إضافة الفئة.","error")}finally{B(!1)}},v=async(c,k)=>{B(!0);try{await F.collection("categories").doc(c).update(k),E("تم تحديث الفئة بنجاح!","success"),i(null),l(!1)}catch(S){console.error("Error updating category: ",S),E("حدث خطأ أثناء تحديث الفئة.","error")}finally{B(!1)}},$=c=>{I(c),M(!0)},N=async()=>{if(A){B(!0);try{await F.collection("categories").doc(A.id).delete(),E("تم حذف الفئة بنجاح!","success")}catch(c){console.error("Error deleting category: ",c),E("حدث خطأ أثناء حذف الفئة.","error")}finally{M(!1),I(null),B(!1)}}},b=c=>{i(c),l(!0)},o=()=>{i(null),l(!0)},n=()=>{i(null),l(!1)},d=Math.ceil(p.length/ce),w=p.slice((a-1)*ce,a*ce);return T?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(ze,{})]}):e.jsxs("div",{children:[D&&e.jsx(Ge,{...D,onClose:()=>q(null)}),e.jsx(X,{isOpen:C,onClose:()=>M(!1),onConfirm:N,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',A==null?void 0:A.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:K}),e.jsx(Ie,{isOpen:y,title:m?"تعديل الفئة":"إضافة فئة جديدة",onClose:n,children:e.jsx(Pe,{onSubmit:m?c=>v(m.id,c):f,initialData:m,onCancel:n,isLoading:K})}),e.jsx("button",{onClick:o,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:p.length>0?w.map(c=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:c.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>b(c),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>$(c),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},c.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),p.length>ce&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ie,{currentPage:a,totalPages:d,onPageChange:g})})]})]})},de=["movies","series","categories"],_e=()=>{const[p,s]=t.useState(ye()),[m,i]=t.useState(!1),[y,l]=t.useState(null),[a,g]=t.useState(!1),[C,M]=t.useState(null),A=(f,v)=>{l({message:f,type:v})},I=f=>{const{name:v,value:$}=f.target;s(N=>({...N,[v]:$}))},T=()=>{Ne(p),A("تم حفظ الإعدادات بنجاح.","success"),alert("تم حفظ الإعدادات. يرجى إعادة تحميل الصفحة لتطبيق التغييرات والاتصال بمشروع Firebase الجديد.")},_=()=>{je(),A("تمت إعادة تعيين الإعدادات إلى الوضع الافتراضي.","success"),alert("تمت إعادة تعيين الإعدادات. يرجى إعادة تحميل الصفحة للعودة إلى الإعدادات الافتراضية.")},K=async()=>{i(!0),A("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const f={};for(const n of de){const d=await F.collection(n).get();f[n]=d.docs.map(w=>({id:w.id,...w.data()}))}const v=JSON.stringify(f,null,2),$=new Blob([v],{type:"application/json"}),N=URL.createObjectURL($),b=document.createElement("a");b.href=N;const o=new Date().toISOString().slice(0,10);b.download=`firebase-backup-${o}.json`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(N),A("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(f){console.error("Backup failed:",f);let v="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";f.code==="permission-denied"&&(v="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد أمان Firestore تسمح للمشرفين بقراءة المجموعات."),A(v,"error")}finally{i(!1)}},B=f=>{var $;const v=($=f.target.files)==null?void 0:$[0];if(v){const N=new FileReader;N.onload=b=>{var o;try{const n=(o=b.target)==null?void 0:o.result,d=JSON.parse(n,(w,c)=>c&&typeof c=="object"&&c.hasOwnProperty("seconds")&&c.hasOwnProperty("nanoseconds")?new me(c.seconds,c.nanoseconds):c);M(d)}catch(n){A("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",n),M(null)}},N.readAsText(v)}},D=()=>{C?g(!0):A("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},q=async()=>{if(g(!1),!!C){i(!0),A("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let f=0,v=[];for(const N of Object.keys(C)){if(!de.includes(N)){v.push(N),console.warn(`Skipping restore for unsupported collection: "${N}"`);continue}const b=C[N];if(Array.isArray(b)){for(let n=0;n<b.length;n+=400){const d=F.batch(),w=b.slice(n,n+400);for(const c of w)if(c.id){const{id:k,...S}=c,P=F.collection(N).doc(k);d.set(P,S)}await d.commit()}f++}}let $="تمت استعادة البيانات بنجاح!";v.length>0&&($+=` تم تخطي المجموعات التالية: ${v.join(", ")}.`),f===0&&v.length>0?A(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${v.join(", ")}.`,"error"):A($,"success")}catch(f){console.error("Restore failed:",f),A("فشلت عملية الاستعادة. تحقق من وحدة التحكم.","error")}finally{i(!1),M(null)}}},E="w-full bg-slate-700 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none transition";return e.jsxs("div",{className:"space-y-12",children:[y&&e.jsx(he,{...y,onClose:()=>l(null)}),e.jsx(X,{isOpen:a,onClose:()=>g(!1),onConfirm:q,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:m}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إعدادات Firebase SDK"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"عدّل هذه القيم للاتصال بمشروع Firebase مختلف. بعد الحفظ، ستحتاج إلى إعادة تحميل الصفحة."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.keys(p).map(f=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:f}),e.jsx("input",{name:f,value:p[f]||"",onChange:I,className:E})]},f))}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-600",children:[e.jsx("button",{onClick:_,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition-colors",children:"إعادة للوضع الافتراضي"}),e.jsx("button",{onClick:T,className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"حفظ الإعدادات"})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",de.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:K,disabled:m,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[m&&e.jsx(ae,{}),m?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:B,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:D,disabled:m||!C,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[m&&e.jsx(ae,{}),m?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},ue=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(Ee,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Me,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(De,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(Oe,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(_e,{})}],Ke=({label:p,tabKey:s,activeTab:m,onClick:i})=>e.jsx("button",{onClick:()=>i(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${m===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":m===s,children:p}),Ye=()=>{var i;const[p,s]=t.useState(ue[0].key),m=(i=ue.find(y=>y.key===p))==null?void 0:i.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:ue.map(y=>e.jsx(Ke,{label:y.label,tabKey:y.key,activeTab:p,onClick:s},y.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:m})]})};export{Ye as default};
