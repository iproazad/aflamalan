import{u as N,r as l,d as w,F as y,T as S,R as L,j as e,L as k}from"./index-Dh8Pkb-q.js";import{u as C}from"./MovieCardSkeleton-mlncPtAb.js";import{F as R,S as F}from"./SpinnerIcon-DP-3q0I9.js";const I=()=>{const{currentUser:s}=N(),[o,a]=l.useState([]);l.useEffect(()=>{if(!s){a([]);return}const b=w.collection("user_lists").doc(s.uid).onSnapshot(m=>{if(m.exists){const i=m.data();a((i==null?void 0:i.favoriteSeries)||[])}else a([])},m=>{console.error("Error listening to favorite series:",m)});return()=>b()},[s]);const v=l.useCallback(async r=>{if(!s){console.warn("User must be logged in to manage favorite series.");return}const b=w.collection("user_lists").doc(s.uid),m=o.includes(r);try{m?await b.update({favoriteSeries:y.arrayRemove(r)}):await b.set({favoriteSeries:y.arrayUnion(r)},{merge:!0})}catch(i){console.error("Error toggling favorite series in Firestore:",i)}},[s,o]),u=l.useCallback(r=>o.includes(r),[o]);return{favoriteSeries:o,toggleFavoriteSeries:v,isFavoriteSeries:u}},D=()=>{const{currentUser:s}=N(),[o,a]=l.useState([]),[v,u]=l.useState(!1);l.useEffect(()=>{if(!s){a([]);return}const c=w.collection("user_lists").doc(s.uid).onSnapshot(d=>{if(d.exists){const n=d.data(),p=(n==null?void 0:n.watchLaterSeries)||[];p.sort((g,t)=>{var x,f;return(((x=t.addedAt)==null?void 0:x.toMillis())||0)-(((f=g.addedAt)==null?void 0:f.toMillis())||0)}),a(p)}else a([])},d=>{console.error("Error listening to watch later series list:",d)});return()=>c()},[s]);const r=l.useCallback(async(h,c,d)=>{var g;if(!s){console.warn("User must be logged in to manage watch later list.");return}u(!0);const n=w.collection("user_lists").doc(s.uid),p={seriesId:h,season:c,episode:d,addedAt:S.now()};try{const t=await n.get();if(t.exists){const f=[...(((g=t.data())==null?void 0:g.watchLaterSeries)||[]).filter(j=>j.seriesId!==h),p];await n.update({watchLaterSeries:f})}else await n.set({watchLaterSeries:[p]})}catch(t){console.error("Error adding to watch later series in Firestore:",t)}finally{u(!1)}},[s]),b=l.useCallback(async h=>{var d;if(!s)return;u(!0);const c=w.collection("user_lists").doc(s.uid);try{const n=await c.get();if(n.exists){const g=(((d=n.data())==null?void 0:d.watchLaterSeries)||[]).filter(t=>t.seriesId!==h);await c.update({watchLaterSeries:g})}}catch(n){console.error("Error removing from watch later series in Firestore:",n)}finally{u(!1)}},[s]),m=l.useCallback(h=>o.some(c=>c.seriesId===h),[o]),i=l.useCallback(h=>o.find(c=>c.seriesId===h),[o]);return{watchLaterSeries:o,addWatchLaterSeries:r,removeWatchLaterSeries:b,isWatchLaterSeries:m,getWatchLaterInfo:i,loading:v}},E=({isFavorite:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${s?"text-red-500":"text-white"}`,fill:s?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 016.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"})}),M=({isWatchLater:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${s?"text-cyan-400":"text-white"}`,fill:s?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),$=({series:s,isFavorite:o,isWatchLater:a,onToggleFavorite:v,onToggleWatchLater:u,watchLaterInfo:r=null})=>{const{currentUser:b}=N(),{imageRef:m,imageSrc:i,isLoaded:h,handleImageLoad:c}=C(s.posterUrl),[d,n]=l.useState(!1),p=x=>{x.preventDefault(),x.stopPropagation(),v(s.id)},g=x=>{x.preventDefault(),x.stopPropagation(),u(s)},t=r?`/series/${s.id}?season=${r.season}&episode=${r.episode}`:`/series/${s.id}`;return e.jsx("div",{className:"relative group",children:e.jsxs(k,{to:t,className:"relative block z-10 rounded-lg overflow-hidden shadow-lg hover:shadow-xl hover:shadow-cyan-500/20 transform transition-all duration-300 ease-in-out group-hover:scale-105 bg-slate-800",children:[b&&e.jsxs("div",{className:"absolute top-1.5 right-1.5 z-20 flex flex-col gap-1.5 opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0 transition-all duration-300",children:[e.jsx("button",{onClick:p,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":o?"إزالة من المفضلة":"إضافة إلى المفضلة",children:e.jsx(E,{isFavorite:o})}),e.jsx("button",{onClick:g,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":a?"إزالة من قائمة المشاهدة لاحقاً":"إضافة إلى قائمة المشاهدة لاحقاً",children:e.jsx(M,{isWatchLater:a})})]}),e.jsx("div",{className:"relative w-full aspect-[2/3] bg-slate-800 overflow-hidden",children:e.jsx("img",{ref:m,src:i,onLoad:c,alt:s.title,className:`
              w-full h-full object-cover
              transition-all duration-500 ease-in-out group-hover:opacity-75
              ${h?"scale-100 blur-0 grayscale-0":"scale-110 blur-md grayscale"}
            `})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/70 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4 transition-all duration-300 group-hover:-translate-y-1",children:[e.jsx("h3",{className:"text-white text-sm sm:text-base font-bold truncate",children:s.title}),s.genres&&s.genres.length>0&&e.jsxs("div",{className:"relative mt-1",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[e.jsx("p",{className:"text-slate-400 text-xs truncate",children:s.genres.join(" / ")}),d&&e.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-max max-w-xs bg-slate-900 text-white text-xs rounded py-1.5 px-3 z-10 shadow-lg border border-slate-700 pointer-events-none animate-fade-in-up-fast",children:s.genres.join(", ")})]}),e.jsxs("div",{className:"mt-1 flex justify-between items-center",children:[e.jsx("p",{className:"text-slate-300 text-xs sm:text-sm",children:s.year}),s.imdbRating&&s.imdbRating>0?e.jsxs("div",{className:"flex items-center gap-1.5",title:`IMDb Rating: ${s.imdbRating}/10`,children:[e.jsx("span",{className:"bg-yellow-500 text-black text-xs sm:text-sm font-bold px-2 py-0.5 rounded-sm",children:"IMDb"}),e.jsx("span",{className:"font-bold text-white text-sm",children:s.imdbRating.toFixed(1)})]}):e.jsx("div",{className:"h-5"})]}),r&&e.jsxs("div",{className:"mt-1.5 text-center text-xs font-bold text-cyan-200 bg-cyan-500/20 px-2 py-1 rounded-sm",children:["استئناف م",r.season," ح",r.episode]})]})]})})},_=L.memo($),A=({isOpen:s,onClose:o,series:a,onSave:v,isSaving:u})=>{var g;const[r,b]=l.useState(1),[m,i]=l.useState(1);if(l.useEffect(()=>{if(a&&a.seasons.length>0){const t=a.seasons[0];b(t.seasonNumber),t.episodes.length>0&&i(t.episodes[0].episodeNumber)}},[a]),!a)return null;const h=()=>{v(r,m)},c=t=>{const x=Number(t.target.value);b(x);const f=a.seasons.find(j=>j.seasonNumber===x);f&&f.episodes.length>0?i(f.episodes[0].episodeNumber):i(1)},d=a.seasons||[],n=((g=d.find(t=>t.seasonNumber===r))==null?void 0:g.episodes)||[],p="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition cursor-pointer";return e.jsx(R,{isOpen:s,onClose:o,title:`أضف "${a.title}" للمشاهدة لاحقاً`,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"اختر الحلقة التي توقفت عندها للعودة إليها بسهولة لاحقًا."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"season",className:"block text-sm font-medium text-slate-300 mb-2",children:"الموسم"}),e.jsx("select",{id:"season",value:r,onChange:c,className:p,children:d.map(t=>e.jsxs("option",{value:t.seasonNumber,children:["الموسم ",t.seasonNumber]},t.seasonNumber))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"episode",className:"block text-sm font-medium text-slate-300 mb-2",children:"الحلقة"}),e.jsx("select",{id:"episode",value:m,onChange:t=>i(Number(t.target.value)),className:p,children:n.map(t=>e.jsxs("option",{value:t.episodeNumber,children:["الحلقة ",t.episodeNumber,": ",t.title]},t.episodeNumber))})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-700",children:[e.jsx("button",{onClick:o,disabled:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{onClick:h,disabled:u,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[u&&e.jsx(F,{}),u?"جاري الحفظ...":"حفظ واستئناف"]})]})]})})};export{A as R,_ as S,D as a,I as u};
