import{r as n,a as X,j as t,d as F,L as Y}from"./index-Dz2DXnM8.js";import{a as ee}from"./useWatchLater-Bzggdk29.js";import{a as te,R as se}from"./ResumeFromModal-2gxD57xZ.js";import{M as ae}from"./MovieGridSkeleton-eo5LrZbc.js";import{M as re}from"./MovieGrid-XnU7ad2l.js";import{S as oe}from"./SeriesGrid-Cs21YUq1.js";import{P as ne}from"./Pagination-C-vk0JvX.js";import"./MovieCardSkeleton-D_IMjcnN.js";import"./SpinnerIcon-DCw0DtRn.js";const E=30,ge=()=>{const[p,H]=n.useState([]),[b,Z]=n.useState([]),[A,k]=n.useState(!0),{watchLater:N}=ee(),{watchLaterSeries:d,addWatchLaterSeries:D,removeWatchLaterSeries:G,isWatchLaterSeries:$,loading:O}=te(),[i,q]=n.useState("movies"),[g,v]=n.useState(null),[S,C]=X(),T=n.useRef(!0),u=parseInt(S.get("page")||"1",10),W=n.useCallback(e=>{const s=new URLSearchParams(S);e<=1?s.delete("page"):s.set("page",e.toString()),C(s,{replace:!0}),window.scrollTo(0,0)},[S,C]);n.useEffect(()=>{(async()=>{k(!0);const s=d.map(a=>a.seriesId).filter(a=>typeof a=="string"&&a.trim()!==""),h=async()=>{const a=N.filter(c=>typeof c=="string"&&c.trim()!=="");if(a.length===0)return[];try{const x=[];for(let r=0;r<a.length;r+=30)x.push(a.slice(r,r+30));const _=x.map(r=>F.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",r).get()),o=(await Promise.all(_)).flatMap(r=>r.docs.map(l=>({id:l.id,...l.data()})));return o.sort((r,l)=>{var m,f;return(((m=l.createdAt)==null?void 0:m.toMillis())||0)-(((f=r.createdAt)==null?void 0:f.toMillis())||0)}),o}catch(c){return console.error("Error fetching watch later movies: ",c),[]}},P=async()=>{if(s.length===0)return[];try{const c=[];for(let o=0;o<s.length;o+=30)c.push(s.slice(o,o+30));const x=c.map(o=>F.collection("series").where(window.firebase.firestore.FieldPath.documentId(),"in",o).get()),y=(await Promise.all(x)).flatMap(o=>o.docs.map(r=>({id:r.id,...r.data()})));return y.sort((o,r)=>{var f,U;const l=d.find(L=>L.seriesId===o.id),m=d.find(L=>L.seriesId===r.id);return(((f=m==null?void 0:m.addedAt)==null?void 0:f.toMillis())||0)-(((U=l==null?void 0:l.addedAt)==null?void 0:U.toMillis())||0)}),y}catch(a){return console.error("Error fetching watch later series: ",a),[]}};try{const[a,c]=await Promise.all([h(),P()]);H(a),Z(c)}catch(a){console.error("Error fetching all watch later content:",a)}finally{k(!1)}})()},[N,d]),n.useEffect(()=>{if(T.current){T.current=!1;return}u!==1&&W(1)},[i]);const z=e=>{$(e.id)?G(e.id):v(e)},B=(e,s)=>{g&&D(g.id,e,s),v(null)},M=n.useMemo(()=>p.filter(e=>!e.isKurdish),[p]),w=n.useMemo(()=>p.filter(e=>e.isKurdish),[p]),{paginatedItems:K,totalPages:R,totalItems:J}=n.useMemo(()=>{let e=[];i==="movies"&&(e=M),i==="kurdish"&&(e=w),i==="series"&&(e=b);const s=Math.ceil(e.length/E);return{paginatedItems:e.slice((u-1)*E,u*E),totalPages:s,totalItems:e.length}},[i,u,M,w,b]),Q=n.useMemo(()=>new Map(d.map(e=>[e.seriesId,{season:e.season,episode:e.episode}])),[d]),I=({tab:e,label:s,count:h})=>t.jsxs("button",{onClick:()=>q(e),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${i===e?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":i===e,children:[s,t.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${i===e?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:h})]}),j=({message:e,subMessage:s,buttonText:h,link:P})=>t.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[t.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:e}),t.jsx("p",{className:"text-slate-400 mb-6",children:s}),t.jsx(Y,{to:P,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:h})]}),V=()=>{if(J>0)return t.jsxs(t.Fragment,{children:[i==="series"?t.jsx(oe,{series:K,onToggleWatchLater:z,watchLaterInfoMap:Q}):t.jsx(re,{movies:K}),R>1&&t.jsx(ne,{currentPage:u,totalPages:R,onPageChange:W})]});switch(i){case"movies":return t.jsx(j,{message:"قائمة أفلامك فارغة.",subMessage:"أضف أفلامًا لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return t.jsx(j,{message:"قائمة الأفلام الكردية فارغة.",subMessage:"أضف أفلامًا كردية لمشاهدتها لاحقًا.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return t.jsx(j,{message:"قائمة مسلسلاتك فارغة.",subMessage:"أضف مسلسلات لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(se,{isOpen:!!g,onClose:()=>v(null),series:g,onSave:B,isSaving:O}),t.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),t.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[t.jsx(I,{tab:"movies",label:"أفلام",count:M.length}),t.jsx(I,{tab:"kurdish",label:"كردي",count:w.length}),t.jsx(I,{tab:"series",label:"مسلسلات",count:b.length})]}),A?t.jsx(ae,{count:12}):t.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:V()})]})};export{ge as default};
