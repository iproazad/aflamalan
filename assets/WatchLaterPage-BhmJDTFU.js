import{r as n,j as t,e as _,L as V}from"./index-DHK5cvRJ.js";import{a as X}from"./useWatchLater-BcOOIyUy.js";import{a as Y,R as ee}from"./ResumeFromModal-q3WC36pm.js";import{M as te}from"./MovieGridSkeleton-DB659YRz.js";import{M as se}from"./MovieGrid-DNh_sAbN.js";import{S as ae}from"./SeriesGrid-jwrBYdZO.js";import{P as re}from"./Pagination-Cb39dPnj.js";import"./MovieCardSkeleton-DdmktY3e.js";import"./SpinnerIcon-rVrOQveZ.js";const T=28,ge=()=>{const[p,R]=n.useState([]),[S,F]=n.useState([]),[H,D]=n.useState(!0),{watchLater:P}=X(),{watchLaterSeries:m,addWatchLaterSeries:U,removeWatchLaterSeries:Z,isWatchLaterSeries:G,loading:$}=Y(),[c,O]=n.useState("movies"),[x,k]=n.useState(1),[b,w]=n.useState(null);n.useEffect(()=>{(async()=>{D(!0);const i=m.map(a=>a.seriesId).filter(a=>typeof a=="string"&&a.trim()!==""),h=async()=>{const a=P.filter(l=>typeof l=="string"&&l.trim()!=="");if(a.length===0)return[];try{const v=[];for(let s=0;s<a.length;s+=30)v.push(a.slice(s,s+30));const W=v.map(s=>_.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",s).get()),o=(await Promise.all(W)).flatMap(s=>s.docs.map(r=>({id:r.id,...r.data()})));return o.sort((s,r)=>{var g,f;const d=(g=s.createdAt)!=null&&g.toDate?s.createdAt.toDate().getTime():new Date(s.createdAt).getTime(),u=(f=r.createdAt)!=null&&f.toDate?r.createdAt.toDate().getTime():new Date(r.createdAt).getTime();return(isNaN(u)?0:u)-(isNaN(d)?0:d)}),o}catch(l){return console.error("Error fetching watch later movies: ",l),[]}},y=async()=>{if(i.length===0)return[];try{const l=[];for(let o=0;o<i.length;o+=30)l.push(i.slice(o,o+30));const v=l.map(o=>_.collection("series").where(window.firebase.firestore.FieldPath.documentId(),"in",o).get()),L=(await Promise.all(v)).flatMap(o=>o.docs.map(s=>({id:s.id,...s.data()})));return L.sort((o,s)=>{var f,K;const r=m.find(E=>E.seriesId===o.id),d=m.find(E=>E.seriesId===s.id),u=(f=r==null?void 0:r.addedAt)!=null&&f.toDate?r.addedAt.toDate().getTime():new Date(r==null?void 0:r.addedAt).getTime(),g=(K=d==null?void 0:d.addedAt)!=null&&K.toDate?d.addedAt.toDate().getTime():new Date(d==null?void 0:d.addedAt).getTime();return(isNaN(g)?0:g)-(isNaN(u)?0:u)}),L}catch(a){return console.error("Error fetching watch later series: ",a),[]}};try{const[a,l]=await Promise.all([h(),y()]);R(a),F(l)}catch(a){console.error("Error fetching all watch later content:",a)}finally{D(!1)}})()},[P,m]),n.useEffect(()=>{k(1)},[c]);const q=e=>{G(e.id)?Z(e.id):w(e)},z=(e,i)=>{b&&U(b.id,e,i),w(null)},j=n.useMemo(()=>p.filter(e=>!e.isKurdish),[p]),N=n.useMemo(()=>p.filter(e=>e.isKurdish),[p]),{paginatedItems:A,totalPages:C,totalItems:B}=n.useMemo(()=>{let e=[];c==="movies"&&(e=j),c==="kurdish"&&(e=N),c==="series"&&(e=S);const i=Math.ceil(e.length/T);return{paginatedItems:e.slice((x-1)*T,x*T),totalPages:i,totalItems:e.length}},[c,x,j,N,S]),J=n.useMemo(()=>new Map(m.map(e=>[e.seriesId,{season:e.season,episode:e.episode}])),[m]),I=({tab:e,label:i,count:h})=>t.jsxs("button",{onClick:()=>O(e),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${c===e?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":c===e,children:[i,t.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${c===e?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:h})]}),M=({message:e,subMessage:i,buttonText:h,link:y})=>t.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[t.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:e}),t.jsx("p",{className:"text-slate-400 mb-6",children:i}),t.jsx(V,{to:y,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:h})]}),Q=()=>{if(B>0)return t.jsxs(t.Fragment,{children:[c==="series"?t.jsx(ae,{series:A,onToggleWatchLater:q,watchLaterInfoMap:J}):t.jsx(se,{movies:A}),C>1&&t.jsx(re,{currentPage:x,totalPages:C,onPageChange:k})]});switch(c){case"movies":return t.jsx(M,{message:"قائمة أفلامك فارغة.",subMessage:"أضف أفلامًا لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return t.jsx(M,{message:"قائمة الأفلام الكردية فارغة.",subMessage:"أضف أفلامًا كردية لمشاهدتها لاحقًا.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return t.jsx(M,{message:"قائمة مسلسلاتك فارغة.",subMessage:"أضف مسلسلات لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(ee,{isOpen:!!b,onClose:()=>w(null),series:b,onSave:z,isSaving:$}),t.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),t.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[t.jsx(I,{tab:"movies",label:"أفلام",count:j.length}),t.jsx(I,{tab:"kurdish",label:"كردي",count:N.length}),t.jsx(I,{tab:"series",label:"مسلسلات",count:S.length})]}),H?t.jsx(te,{count:12}):t.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:Q()})]})};export{ge as default};
