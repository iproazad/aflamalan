import{r as o,j as e,s as $,f as mt,R as bt}from"./index-DLOQmAiS.js";import{P as nt}from"./Pagination-BQtzf5ih.js";import{F as Ce,S as Ne}from"./SpinnerIcon-B4FaeE9s.js";const yt=[{key:"foreign",label:"افلام اجنبي"},{key:"kurdish",label:"افلام كردي"},{key:"asian",label:"افلام اسيوية"},{key:"turkish",label:"افلام تركية"},{key:"arabic",label:"افلام عربي"},{key:"classic",label:"افلام كلاسيكيه"},{key:"dubbed",label:"افلام مدبلجة"},{key:"indian",label:"افلام هندية"},{key:"anime",label:"افلام انمي"}],ut=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jt=({onSubmit:i,initialData:n,onCancel:x,isLoading:u=!1,allGenres:w=[]})=>{var Z,ae,ee;const[s,c]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,movie_type:"foreign",imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),[k,b]=o.useState(""),[P,K]=o.useState(""),[G,X]=o.useState(!1),[g,v]=o.useState(""),[R,F]=o.useState(!1),[q,W]=o.useState(""),[E,M]=o.useState(""),[Y,U]=o.useState(!1),y=o.useRef(null);o.useEffect(()=>{if(n){let a=n.movie_type;!a&&n.is_kurdish&&(a="kurdish"),c({title:n.title||"",description:n.description||"",poster_url:n.poster_url||"",backdrop_url:n.backdrop_url||"",year:n.year||new Date().getFullYear(),genres:n.genres||[],tags:n.tags||[],servers:n.servers&&n.servers.length>0?n.servers:[{name:"Server 1",url:"",quality:"1080p"}],backup_servers:n.backup_servers||[],download_url:n.download_url||"",trailer_url:n.trailer_url||"",is_kurdish:a==="kurdish",movie_type:a||"foreign",imdb_rating:n.imdb_rating,quality:n.quality||"",duration:n.duration||"",language:n.language||"",country:n.country||"",directors:n.directors||[],writers:n.writers||[],cast:n.cast||[]}),b((n.tags||[]).join(", "))}else c({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,movie_type:"foreign",imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),b("")},[n]),o.useEffect(()=>{const a=t=>{y.current&&!y.current.contains(t.target)&&F(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),o.useEffect(()=>{const a=s.download_url;if(a&&a.includes("vidtube.pro/d/")){const t=a.replace("/d/","/embed-");s.servers.length>0&&s.servers[0].url!==t&&c(l=>{const h=[...l.servers];return h[0]={...h[0],url:t},{...l,servers:h}})}},[s.download_url,s.servers]),o.useEffect(()=>{if(!n){const a=s.title.match(/\b(19[89]\d|20\d{2})\b/);if(a&&a[0]){const t=parseInt(a[0],10),l=s.title.replace(a[0],"").replace(/\s\s+/g," ").trim();c(h=>h.year!==t||h.title!==l?{...h,year:t,title:l}:h)}}},[s.title,n]),o.useEffect(()=>{!n&&!s.backdrop_url.trim()&&c(a=>({...a,backdrop_url:a.poster_url}))},[s.poster_url,n,s.backdrop_url]);const I=async a=>{var t;try{if(!((t=navigator.clipboard)!=null&&t.readText))throw new Error("Clipboard API not available.");const l=await navigator.clipboard.readText();l&&a(l)}catch(l){console.error("Failed to read clipboard contents: ",l),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},d=a=>{const{name:t,value:l,type:h}=a.target;if(h==="checkbox"){const{checked:_}=a.target;c(T=>({...T,[t]:_}))}else if(t==="year"){const _=parseInt(l,10);c(T=>({...T,[t]:isNaN(_)?0:_}))}else if(t==="imdb_rating"){const _=parseFloat(l);c(T=>({...T,imdb_rating:isNaN(_)?void 0:_}))}else c(_=>({..._,[t]:l}))},p=a=>{b(a.target.value)},m=a=>{c(t=>{const l=t.genres||[],h=l.includes(a)?l.filter(_=>_!==a):[...l,a];return{...t,genres:h}})},S=async()=>{const a=E.trim();if(a){if(w.some(t=>t.toLowerCase()===a.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}U(!0);try{const{error:t}=await $.from("categories").insert({name:a});if(t)throw t;c(l=>({...l,genres:[...l.genres||[],a]})),M("")}catch(t){console.error("Error adding new genre:",t),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{U(!1)}}},j=(a,t,l)=>{const h=[...s.servers];h[a]={...h[a],[t]:l},c(_=>({..._,servers:h}))},B=()=>{c(a=>{const t={name:`Server ${a.servers.length+1}`,url:"",quality:"1080p"};return{...a,servers:[...a.servers,t]}})},re=a=>{c(t=>({...t,servers:t.servers.filter((l,h)=>h!==a)}))},te=(a,t,l)=>{const h=[...s.backup_servers||[]];h[a]={...h[a],[t]:l},c(_=>({..._,backup_servers:h}))},we=()=>{c(a=>{var t;return{...a,backup_servers:[...a.backup_servers||[],{name:`Server ${(((t=a.backup_servers)==null?void 0:t.length)||0)+1}`,url:"",quality:"1080p",no_sub_url:""}]}})},ce=a=>{c(t=>({...t,backup_servers:(t.backup_servers||[]).filter((l,h)=>h!==a)}))},N=async()=>{var a,t,l,h,_,T,r,f,C,D,de,fe,be,ye,he,Se,ot,it,ct;if(!P){v("Please enter a URL.");return}X(!0),v("");try{v("Fetching movie page...");const Fe=`https://corsproxy.io/?${encodeURIComponent(P)}`,Ie=await fetch(Fe);if(!Ie.ok)throw new Error(`Failed to fetch URL: ${Ie.statusText}`);const gt=await Ie.text(),dt=new DOMParser,se=dt.parseFromString(gt,"text/html");if(P.includes("a.asd.homes")){v("جلب البيانات من عرب سيد...");const ne=J=>{var Q,Ee;const H=Array.from(se.querySelectorAll(".info__area__ul > li")).find(ue=>{var me,Xe;return(Xe=(me=ue.querySelector(".title__kit span"))==null?void 0:me.textContent)==null?void 0:Xe.trim().startsWith(J)});if(!H)return[];const oe=Array.from(H.querySelectorAll("ul.tags__list a"));if(oe.length>0)return oe.map(ue=>{var me;return((me=ue.textContent)==null?void 0:me.trim())||""}).filter(Boolean);const ie=Array.from(H.childNodes).find(ue=>{var me;return ue.nodeType===Node.TEXT_NODE&&((me=ue.textContent)==null?void 0:me.trim())});if(ie)return[((Q=ie.textContent)==null?void 0:Q.trim())||""];const A=H.querySelector("a");return A?[((Ee=A.textContent)==null?void 0:Ee.trim())||""]:[]},_e=((t=(a=se.querySelector("h1.post__name"))==null?void 0:a.textContent)==null?void 0:t.trim())||"",xe=_e.match(/\(\s*(\d{4})\s*\)/),ze=xe?parseInt(xe[1],10):new Date().getFullYear(),pe=xe?_e.replace(xe[0],"").trim():_e,De=((h=(l=se.querySelector(".post__story p"))==null?void 0:l.textContent)==null?void 0:h.trim())||"",$e=((_=se.querySelector(".poster__single img"))==null?void 0:_.getAttribute("data-src"))||((T=se.querySelector(".poster__single img"))==null?void 0:T.getAttribute("src"))||"",We=((f=(r=se.querySelector(".rating__box .rate__txt"))==null?void 0:r.textContent)==null?void 0:f.trim().split("/")[0].trim())||"0",Je=parseFloat(We)||void 0,Ye=ne("نوع العرض"),Ve=ne("جودة العرض").join(", "),He=ne("مدة العرض").join(", "),Ke=ne("لغة العرض").join(", "),Qe=ne("بلد العرض").join(", "),Oe=[],Te=[],Pe=[];se.querySelectorAll(".persons__list li a").forEach(J=>{var oe,ie,A,Q;const le=(ie=(oe=J.querySelector(".name"))==null?void 0:oe.textContent)==null?void 0:ie.trim(),H=(Q=(A=J.querySelector(".role"))==null?void 0:A.textContent)==null?void 0:Q.trim();le&&H&&(H.includes("مخرج")?Oe.push(le):H.includes("كاتب")?Te.push(le):Pe.push(le))});const Re=((C=se.querySelector(".show__trailer"))==null?void 0:C.getAttribute("data-iframe"))||"",Me=async J=>{var le;if(!J)return"";try{v("Fetching watch page...");const H=await fetch(`https://corsproxy.io/?${encodeURIComponent(J)}`);if(!H.ok)throw new Error(`Failed to fetch watch page: ${H.statusText}`);const oe=await H.text(),A=(le=new DOMParser().parseFromString(oe,"text/html").querySelector(".player__iframe iframe"))==null?void 0:le.getAttribute("src");return A?A.startsWith("/")?`https://a.asd.homes${A}`:new URL(A,J).href:""}catch(H){return console.error("Error scraping watch page:",H),v("Warning: Could not automatically find watch server."),""}},Be=(J,le,H)=>new Promise(async(oe,ie)=>{if(!J)return oe("");let A=null,Q=null;const Ee=setTimeout(()=>{Q==null||Q.disconnect(),A==null||A.remove(),ie(new Error(`Scraping timed out for ${J}`))},15e3);try{const ue=await fetch(`https://corsproxy.io/?${encodeURIComponent(J)}`);if(!ue.ok)return ie(new Error(`Failed to fetch intermediate page: ${J}`));const me=await ue.text(),Ze=new DOMParser().parseFromString(me,"text/html").querySelector(le);if(Ze&&Ze.getAttribute(H))return clearTimeout(Ee),oe(Ze.getAttribute(H)||"");A=document.createElement("div"),A.style.display="none",document.body.appendChild(A),Q=new MutationObserver(()=>{const et=A==null?void 0:A.querySelector(le);if(et&&et.getAttribute(H)){const ft=et.getAttribute(H)||"";Q==null||Q.disconnect(),clearTimeout(Ee),A==null||A.remove(),oe(ft)}}),Q.observe(A,{childList:!0,subtree:!0}),A.innerHTML=me}catch(ue){clearTimeout(Ee),Q==null||Q.disconnect(),A==null||A.remove(),ie(ue)}});v("Fetching watch & download pages (this may take a moment)...");const ge=(D=se.querySelector("a.watch__btn"))==null?void 0:D.getAttribute("href"),qe=(de=se.querySelector("a.download__btn"))==null?void 0:de.getAttribute("href"),[je,Ae]=await Promise.all([Me(ge),Be(qe,'a.downloadsLink, a[href*="vidtube.pro/d/"], .downloads__links__list a',"href").catch(J=>(console.warn("Could not scrape download URL:",J),v("Warning: Could not automatically find download link."),""))]);let ve=[];je&&(v("Parsing watch servers..."),ve.push({name:"Server 1",url:je,quality:"HD"})),c(J=>({...J,title:pe,year:ze||J.year,description:De,poster_url:$e,backdrop_url:$e,imdb_rating:Je,genres:[...new Set([...J.genres,...Ye])],quality:Ve,duration:He,language:Ke,country:Qe,directors:Oe,writers:Te,cast:Pe,trailer_url:Re,servers:ve.length>0?ve:J.servers,download_url:Ae||J.download_url})),v("تم جلب البيانات بنجاح!")}else if(P.includes("topcinema.cam")){const ne=ge=>{var le,H,oe;const je=Array.from(se.querySelectorAll(".RightTaxContent > li")).find(ie=>{var A,Q;return(Q=(A=ie.querySelector("span"))==null?void 0:A.textContent)==null?void 0:Q.trim().startsWith(ge)});if(!je)return[];const Ae=Array.from(je.querySelectorAll("a, strong"));if(Ae.length>0)return Ae.map(ie=>{var A;return((A=ie.textContent)==null?void 0:A.trim())||""}).filter(Boolean);const ve=je.cloneNode(!0);(le=ve.querySelector("i"))==null||le.remove(),(H=ve.querySelector("span"))==null||H.remove();const J=(oe=ve.textContent)==null?void 0:oe.trim().replace(/^:/,"").trim();return J?J.split(/\s*,\s*/):[]},_e=((be=(fe=se.querySelector("h1.post-title"))==null?void 0:fe.textContent)==null?void 0:be.trim())||"",xe=_e.match(/\b(19\d{2}|20\d{2})\b/),ze=xe?parseInt(xe[0],10):new Date().getFullYear();let pe=_e;pe=pe.replace(/فيلم|مترجم|اون لاين|اونلاين|WEB-DL|BluRay|HD/gi,"").replace(/[\u0600-\u06FF]+/g,""),xe&&(pe=pe.replace(xe[0],"")),pe=pe.trim().replace(/^[^a-zA-Z0-9\s]+|[^a-zA-Z0-9\s]+$/g,"").trim();const De=((he=(ye=se.querySelector(".story p"))==null?void 0:ye.textContent)==null?void 0:he.trim())||"",$e=((Se=se.querySelector(".MainSingle .left .image img"))==null?void 0:Se.getAttribute("src"))||"",We=((it=(ot=se.querySelector(".imdbR span"))==null?void 0:ot.textContent)==null?void 0:it.trim())||"0",Je=parseFloat(We)||void 0,Ye=ne("نوع الفيلم"),Ve=ne("جودة الفيلم").join(", "),He=ne("توقيت الفيلم").join(", "),Ke=ne("لغة الفيلم").join(", "),Qe=ne("دولة الفيلم").join(", "),Oe=ne("المخرجين"),Te=ne("المؤلفين"),Pe=ne("بطولة");let Re="";const Me=se.querySelector("a.download"),Be=Me==null?void 0:Me.getAttribute("href");if(Be){v("Fetching download link...");const ge=`https://corsproxy.io/?${encodeURIComponent(Be)}`,qe=await fetch(ge);if(qe.ok){const je=await qe.text();Re=((ct=dt.parseFromString(je,"text/html").querySelector('a.downloadsLink, a[href*="vidtube.pro/d/"]'))==null?void 0:ct.getAttribute("href"))||""}}c(ge=>({...ge,title:pe,year:ze||ge.year,description:De,poster_url:$e,backdrop_url:$e,imdb_rating:Je,genres:[...new Set([...ge.genres,...Ye])],quality:Ve,duration:He,language:Ke,country:Qe,directors:Oe,writers:Te,cast:Pe,download_url:Re})),v("تم جلب البيانات بنجاح!")}else{v("هذا الموقع غير مدعوم حاليًا للجلب."),X(!1);return}}catch(Fe){console.error("Scraping failed:",Fe),v(`فشل جلب البيانات: ${Fe.message}.`)}finally{X(!1)}},O=a=>{if(a.preventDefault(),s.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const t=k.split(",").map(h=>h.trim()).filter(Boolean),l={...s,tags:t,is_kurdish:s.movie_type==="kurdish"};i(l)},V=w.filter(a=>a.toLowerCase().includes(q.toLowerCase())),z="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",L="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[e.jsx("label",{htmlFor:"scrape_url",className:"block text-lg font-semibold text-white",children:"جلب البيانات من رابط"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"scrape_url",type:"url",value:P,onChange:a=>K(a.target.value),placeholder:"https://web6.topcinema.cam/... or https://a.asd.homes/...",className:`${z} flex-grow`}),e.jsxs("button",{type:"button",onClick:N,disabled:G,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700 flex-shrink-0 flex items-center disabled:bg-slate-500",children:[G&&e.jsx(ut,{}),G?"جاري الجلب...":"جلب البيانات"]})]}),g&&e.jsx("p",{className:`text-sm mt-1 ${g.startsWith("فشل")||g.startsWith("هذا")?"text-red-400":"text-green-400"}`,children:g})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("input",{type:"text",name:"title",value:s.title,onChange:d,placeholder:"عنوان الفيلم (بالانجليزية)",required:!0,className:z})}),e.jsx("input",{type:"number",name:"year",value:s.year||"",onChange:d,placeholder:"سنة الإنتاج",required:!0,className:z})]}),e.jsx("textarea",{name:"description",value:s.description,onChange:d,placeholder:"وصف الفيلم",required:!0,className:`${z} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",name:"poster_url",value:s.poster_url,onChange:d,placeholder:"رابط صورة البوستر",required:!0,className:`${z} flex-grow`}),e.jsx("button",{type:"button",onClick:()=>I(a=>c(t=>({...t,poster_url:a,backdrop_url:a}))),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-2 px-4 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsx("input",{type:"url",name:"backdrop_url",value:s.backdrop_url,onChange:d,placeholder:"رابط صورة الخلفية",required:!0,className:z})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:s.imdb_rating??"",onChange:d,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:z}),e.jsx("input",{type:"url",name:"trailer_url",value:s.trailer_url??"",onChange:d,placeholder:"رابط المقطع الدعائي (اختياري)",className:z})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"movie_type",className:"block text-sm font-medium text-slate-300 mb-2",children:"نوع الفيلم"}),e.jsx("select",{id:"movie_type",name:"movie_type",value:s.movie_type||"foreign",onChange:d,className:z,children:yt.map(a=>e.jsx("option",{value:a.key,children:a.label},a.key))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-slate-300 mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:k,onChange:p,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:z})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:y,children:[e.jsxs("button",{type:"button",onClick:()=>F(a=>!a),className:`${z} text-right flex justify-between items-center`,children:[e.jsx("span",{children:s.genres.length>0?s.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${R?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),R&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:q,onChange:a=>W(a.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:V.map(a=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.genres.includes(a),onChange:()=>m(a),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:a})]},a))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:E,onChange:a=>M(a.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:S,disabled:Y||!E.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:Y?"...":"إضافة"})]})})]})]})]}),e.jsxs("details",{className:"bg-slate-900/30 p-4 rounded-lg border border-slate-700",open:!0,children:[e.jsx("summary",{className:"text-lg font-semibold text-white cursor-pointer",children:"تفاصيل إضافية للفيلم"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"quality",value:s.quality,onChange:d,placeholder:"الجودة (e.g. 1080p WEB-DL)",className:L}),e.jsx("input",{type:"text",name:"duration",value:s.duration,onChange:d,placeholder:"مدة العرض",className:L}),e.jsx("input",{type:"text",name:"language",value:s.language,onChange:d,placeholder:"اللغة",className:L}),e.jsx("input",{type:"text",name:"country",value:s.country,onChange:d,placeholder:"الدولة",className:L})]}),e.jsx("textarea",{value:(Z=s.directors)==null?void 0:Z.join(", "),onChange:a=>c(t=>({...t,directors:a.target.value.split(",").map(l=>l.trim())})),placeholder:"المخرجين (مفصولة بفاصلة)",className:`${L} w-full`,rows:2}),e.jsx("textarea",{value:(ae=s.writers)==null?void 0:ae.join(", "),onChange:a=>c(t=>({...t,writers:a.target.value.split(",").map(l=>l.trim())})),placeholder:"المؤلفين (مفصولة بفاصلة)",className:`${L} w-full`,rows:2}),e.jsx("textarea",{value:(ee=s.cast)==null?void 0:ee.join(", "),onChange:a=>c(t=>({...t,cast:a.target.value.split(",").map(l=>l.trim())})),placeholder:"البطولة (مفصولة بفاصلة)",className:`${L} w-full`,rows:3})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),s.servers.map((a,t)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a.name,onChange:l=>j(t,"name",l.target.value),placeholder:"اسم السيرفر",className:`${L} flex-1`}),e.jsxs("select",{value:a.quality,onChange:l=>j(t,"quality",l.target.value),className:`${L} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),s.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>re(t),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),t===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:a.url,onChange:l=>j(t,"url",l.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${L} w-full`}),e.jsx("input",{type:"url",name:"download_url",value:s.download_url||"",onChange:d,placeholder:"رابط تحميل الفيلم (اختياري)",className:`${L} w-full`})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:a.url,onChange:l=>j(t,"url",l.target.value),placeholder:`رابط السيرفر ${t+1}`,required:!0,className:`${L} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>I(l=>j(t,"url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]},t)),e.jsx("button",{type:"button",onClick:B,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(s.backup_servers||[]).map((a,t)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a.name,onChange:l=>te(t,"name",l.target.value),placeholder:"اسم السيرفر",className:`${L} flex-1`}),e.jsxs("select",{value:a.quality,onChange:l=>te(t,"quality",l.target.value),className:`${L} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>ce(t),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:a.url,onChange:l=>te(t,"url",l.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${L} w-full`}),e.jsx("input",{type:"url",value:a.no_sub_url||"",onChange:l=>te(t,"no_sub_url",l.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${L} w-full`})]})]},t)),e.jsx("button",{type:"button",onClick:we,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:x,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:u,children:[u&&e.jsx(ut,{}),u?n?"جاري التحديث...":"جاري الإضافة...":n?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},wt=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ke=({isOpen:i,onClose:n,onConfirm:x,title:u,message:w,isLoading:s=!1})=>{const[c,k]=o.useState(i);return o.useEffect(()=>{if(i)k(!0);else{const b=setTimeout(()=>k(!1),300);return()=>clearTimeout(b)}},[i]),c?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:n,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:u}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:w})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:x,disabled:s,children:[s&&e.jsx(wt,{}),s?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:n,disabled:s,children:"إلغاء"})]})]})}):null},vt=10,ht=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((i,n)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},n))})}),e.jsx("tbody",{children:[...Array(vt)].map((i,n)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((x,u)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},u))]},n))})]})})]}),lt=({message:i,type:n,onClose:x})=>(o.useEffect(()=>{const s=setTimeout(x,5e3);return()=>clearTimeout(s)},[x]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${n==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:i}),e.jsx("button",{onClick:x,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),xt=({genres:i,onSubmit:n,onClose:x,isLoading:u})=>{const[w,s]=o.useState(i[0]||""),[c,k]=o.useState("add"),b=P=>{P.preventDefault(),w&&n(w,c)};return e.jsx(Ce,{title:"تغيير الفئة بشكل جماعي",onClose:x,isOpen:!0,children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:w,onChange:P=>s(P.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:i.map(P=>e.jsx("option",{value:P,children:P},P))}),e.jsxs("select",{value:c,onChange:P=>k(P.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:x,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!w,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(Ne,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Nt=({onSubmit:i,onClose:n,isLoading:x})=>{const[u,w]=o.useState(new Date().getFullYear()),s=c=>{c.preventDefault(),i(u)};return e.jsx(Ce,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:n,isOpen:!0,children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:u,onChange:c=>w(parseInt(c.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:n,disabled:x,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:x,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[x&&e.jsx(Ne,{}),x?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},pt=({onSubmit:i,onClose:n,isLoading:x})=>{const[u,w]=o.useState(""),[s,c]=o.useState("add"),k=b=>{b.preventDefault(),u.trim()&&i(u.trim(),s)};return e.jsx(Ce,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:n,isOpen:!0,children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:u,onChange:b=>w(b.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:s,onChange:b=>c(b.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:n,disabled:x,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:x||!u.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[x&&e.jsx(Ne,{}),x?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},kt=({movieTypes:i,onSubmit:n,onClose:x,isLoading:u})=>{var k;const[w,s]=o.useState(((k=i[0])==null?void 0:k.key)||"foreign"),c=b=>{b.preventDefault(),n(w)};return e.jsx(Ce,{title:"تغيير نوع الفيلم بشكل جماعي",onClose:x,isOpen:!0,children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر النوع الجديد ليتم تطبيقه على جميع الأفلام المحددة."}),e.jsx("select",{value:w,onChange:b=>s(b.target.value),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:i.map(b=>e.jsx("option",{value:b.key,children:b.label},b.key))}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:x,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(Ne,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Le=10,tt=[{key:"foreign",label:"افلام اجنبي"},{key:"kurdish",label:"افلام كردي"},{key:"asian",label:"افلام اسيوية"},{key:"turkish",label:"افلام تركية"},{key:"arabic",label:"افلام عربي"},{key:"classic",label:"افلام كلاسيكيه"},{key:"dubbed",label:"افلام مدبلجة"},{key:"indian",label:"افلام هندية"},{key:"anime",label:"افلام انمي"}],Ct=()=>{const[i,n]=o.useState([]),[x,u]=o.useState(null),[w,s]=o.useState(!1),[c,k]=o.useState(1),[b,P]=o.useState("all"),[K,G]=o.useState(""),[X,g]=o.useState(!1),[v,R]=o.useState(null),[F,q]=o.useState(!0),[W,E]=o.useState(!1),[M,Y]=o.useState(null),[U,y]=o.useState([]),[I,d]=o.useState(null),[p,m]=o.useState([]),S=async()=>{const{data:r,error:f}=await $.from("movies").select("*").order("created_at",{ascending:!1});f?(console.error("Error fetching movies: ",f),j("فشل في تحميل الأفلام.","error")):n(r);const{data:C,error:D}=await $.from("categories").select("name").order("name");D?console.error("Error fetching categories from ManageMovies: ",D):m(C.map(de=>de.name)),q(!1)};o.useEffect(()=>{q(!0),S();const r=$.channel("public:movies").on("postgres_changes",{event:"*",schema:"public",table:"movies"},()=>S()).subscribe();return()=>{$.removeChannel(r)}},[]),o.useEffect(()=>{k(1),y([])},[b,K]);const j=(r,f)=>{Y({message:r,type:f})},B=async r=>{E(!0);try{const{error:f}=await $.from("movies").insert([{...r,created_at:new Date().toISOString()}]);if(f)throw f;await S(),s(!1),k(1),j("تمت إضافة الفيلم بنجاح.","success")}catch(f){console.error("Error adding movie: ",f);const C=f.message||JSON.stringify(f);j(`حدث خطأ أثناء إضافة الفيلم: ${C}`,"error")}finally{E(!1)}},re=async(r,f)=>{E(!0);try{const{error:C}=await $.from("movies").update(f).eq("id",r);if(C)throw C;await S(),u(null),s(!1),j("تم تحديث الفيلم بنجاح.","success")}catch(C){console.error("Error updating movie: ",C);const D=C.message||JSON.stringify(C);j(`حدث خطأ أثناء تحديث الفيلم: ${D}`,"error")}finally{E(!1)}},te=r=>{R(r),g(!0)},we=async()=>{if(v){E(!0);try{const{error:r}=await $.from("movies").delete().eq("id",v.id);if(r)throw r;j("تم حذف الفيلم بنجاح.","success")}catch(r){console.error("Error deleting movie: ",r);const f=r.message||JSON.stringify(r);j(`حدث خطأ أثناء حذف الفيلم: ${f}`,"error")}finally{g(!1),R(null),E(!1)}}},ce=r=>{u(r),s(!0)},N=()=>{u(null),s(!0)},O=()=>{u(null),s(!1),d(null)},V=r=>{y(f=>f.includes(r)?f.filter(C=>C!==r):[...f,r])},z=r=>{r.target.checked?y(h.map(f=>f.id)):y(U.filter(f=>!h.some(C=>C.id===f)))},L=async(r,f)=>{E(!0);try{const{error:C}=await $.from("movies").update(r).in("id",U);if(C)throw C;j(f,"success"),y([])}catch(C){console.error("Bulk update failed:",C),j("فشل التحديث الجماعي.","error")}finally{E(!1),d(null)}},Z=async r=>{await L({movie_type:r,is_kurdish:r==="kurdish"},"تم تغيير النوع بنجاح.")},ae=async()=>{E(!0);try{const{error:r}=await $.from("movies").delete().in("id",U);if(r)throw r;j(`تم حذف ${U.length} فيلم بنجاح.`,"success"),y([])}catch(r){console.error("Bulk delete failed:",r),j("فشل الحذف الجماعي.","error")}finally{E(!1),d(null)}},ee=async(r,f)=>{E(!0);try{const{data:C,error:D}=await $.from("movies").select("id, genres").in("id",U);if(D)throw D;const de=C.map(be=>{const ye=be.genres||[];let he;return f==="add"?he=[...new Set([...ye,r])]:he=ye.filter(Se=>Se!==r),{id:be.id,genres:he}}),{error:fe}=await $.from("movies").upsert(de);if(fe)throw fe;j(`تم ${f==="add"?"إضافة":"إزالة"} فئة "${r}" بنجاح.`,"success"),y([])}catch(C){console.error("Bulk genre change failed:",C),j("فشل تغيير الفئة الجماعي.","error")}finally{E(!1),d(null)}},a=async(r,f)=>{E(!0);try{const{data:C,error:D}=await $.from("movies").select("id, tags").in("id",U);if(D)throw D;const de=C.map(be=>{const ye=be.tags||[];let he;return f==="add"?he=[...new Set([...ye,r])]:he=ye.filter(Se=>Se!==r),{id:be.id,tags:he}}),{error:fe}=await $.from("movies").upsert(de);if(fe)throw fe;j(`تم ${f==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${r}" بنجاح.`,"success"),y([])}catch(C){console.error("Bulk tags change failed:",C),j("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{E(!1),d(null)}},t=i.filter(r=>b==="all"?!0:b==="foreign"?r.movie_type==="foreign"||!r.movie_type:b==="kurdish"?r.movie_type==="kurdish"||r.is_kurdish===!0:r.movie_type===b).filter(r=>mt(K,r.title)),l=Math.ceil(t.length/Le),h=t.slice((c-1)*Le,c*Le),_=h.length>0&&h.every(r=>U.includes(r.id)),T=r=>{var C;let f=r.movie_type;return!f&&r.is_kurdish?f="kurdish":f||(f="foreign"),((C=tt.find(D=>D.key===f))==null?void 0:C.label)||f};return F?e.jsx(ht,{}):e.jsxs("div",{className:"relative",children:[M&&e.jsx(lt,{...M,onClose:()=>Y(null)}),e.jsx(ke,{isOpen:X,onClose:()=>g(!1),onConfirm:we,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',v==null?void 0:v.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:W}),I==="delete"&&e.jsx(ke,{isOpen:!0,onClose:()=>d(null),onConfirm:ae,title:`تأكيد حذف ${U.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:W}),I==="genre"&&e.jsx(xt,{genres:p,onClose:O,onSubmit:ee,isLoading:W}),I==="tags"&&e.jsx(pt,{onClose:O,onSubmit:a,isLoading:W}),I==="year"&&e.jsx(Nt,{onClose:O,onSubmit:r=>L({year:r},"تم تحديث السنة بنجاح."),isLoading:W}),I==="changeType"&&e.jsx(kt,{movieTypes:tt,onClose:O,onSubmit:Z,isLoading:W}),w&&e.jsx(Ce,{title:x?"تعديل الفيلم":"إضافة فيلم جديد",onClose:O,isOpen:w,children:e.jsx(jt,{onSubmit:x?r=>re(x.id,r):B,initialData:x,onCancel:O,isLoading:W,allGenres:p})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:N,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:K,onChange:r=>G(r.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("select",{value:b,onChange:r=>P(r.target.value),className:"w-full sm:w-auto bg-slate-700 text-white p-2.5 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors flex-shrink-0","aria-label":"Filter by movie type",children:[e.jsx("option",{value:"all",children:"كل الأنواع"}),tt.map(r=>e.jsx("option",{value:r.key,children:r.label},r.key))]})]}),U.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[U.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>y([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>d("changeType"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير النوع"}),e.jsx("button",{onClick:()=>d("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>d("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>d("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>d("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:z,checked:_,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"نوع الفيلم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:h.map(r=>{var f,C;return e.jsxs("tr",{className:`${U.includes(r.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:U.includes(r.id),onChange:()=>V(r.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:r.poster_url,alt:r.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:r.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:r.imdb_rating?r.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:r.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(f=r.genres)==null?void 0:f.slice(0,3).map(D=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:D},D)),((C=r.genres)==null?void 0:C.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:T(r)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:r.created_at?new Date(r.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>ce(r),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>te(r),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},r.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:z,checked:_,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),h.map(r=>{var f,C;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${U.includes(r.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:r.poster_url,alt:r.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:r.title}),e.jsx("input",{type:"checkbox",checked:U.includes(r.id),onChange:()=>V(r.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:r.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:r.imdb_rating?r.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{children:T(r)})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(f=r.genres)==null?void 0:f.slice(0,2).map(D=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:D},D)),((C=r.genres)==null?void 0:C.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",r.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",r.created_at?new Date(r.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>ce(r),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>te(r),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},r.id)})]})]}),t.length>Le&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(nt,{currentPage:c,totalPages:l,onPageChange:k})})]})},St=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),_t=({onSubmit:i,initialData:n,onCancel:x,isLoading:u=!1,allGenres:w=[]})=>{const[s,c]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:"",year:new Date().getFullYear(),episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}],trailer_url:"",imdb_rating:0}),[k,b]=o.useState(""),[P,K]=o.useState(!1),G=o.useRef(null);o.useEffect(()=>{n&&(c({...n,genres:n.genres||[],tags:n.tags||[],seasons:n.seasons&&n.seasons.length>0?n.seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:n.poster_url,year:n.year,episodes:[],imdb_rating:0}],trailer_url:n.trailer_url||"",imdb_rating:n.imdb_rating||0}),b((n.tags||[]).join(", ")))},[n]),o.useEffect(()=>{const d=p=>{G.current&&!G.current.contains(p.target)&&K(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const X=async d=>{var p;try{if(!((p=navigator.clipboard)!=null&&p.readText))throw new Error("Clipboard API not available.");const m=await navigator.clipboard.readText();m&&d(m)}catch(m){console.error("Failed to read clipboard contents: ",m),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},g=d=>{const{name:p,value:m}=d.target;if(p==="year"||p==="imdb_rating"){const S=parseFloat(m);c(j=>({...j,[p]:isNaN(S)?0:S}))}else c(S=>({...S,[p]:m}))},v=d=>{b(d.target.value)},R=d=>{c(p=>({...p,genres:p.genres.includes(d)?p.genres.filter(m=>m!==d):[...p.genres,d]}))},F=(d,p,m)=>{const S=[...s.seasons],j={...S[d]};if(p==="season_number"||p==="year"||p==="imdb_rating"){const B=typeof m=="string"?parseFloat(m):m;j[p]=isNaN(B)?0:B}else j[p]=m;S[d]=j,c(B=>({...B,seasons:S}))},q=()=>{const d=s.seasons.length>0?Math.max(...s.seasons.map(m=>m.season_number))+1:1,p=s.seasons.length>0?s.seasons[s.seasons.length-1].year:s.year;c(m=>({...m,seasons:[...m.seasons,{season_number:d,title:`الموسم ${d}`,description:"",poster_url:m.poster_url,year:p+1,episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}]}))},W=d=>{c(p=>({...p,seasons:p.seasons.filter((m,S)=>S!==d)}))},E=(d,p,m,S)=>{const j=[...s.seasons],B=[...j[d].episodes],re={...B[p]};if(m==="episode_number"){const te=typeof S=="string"?parseFloat(S):S;re[m]=isNaN(te)?0:te}else re[m]=S;B[p]=re,j[d]={...j[d],episodes:B},c(te=>({...te,seasons:j}))},M=d=>{const p=s.seasons[d],m=p.episodes.length>0?Math.max(...p.episodes.map(B=>B.episode_number))+1:1,S={episode_number:m,title:`الحلقة ${m}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"},j=s.seasons.map((B,re)=>re===d?{...B,episodes:[...B.episodes,S]}:B);c(B=>({...B,seasons:j}))},Y=(d,p)=>{const m=s.seasons.map((S,j)=>j===d?{...S,episodes:S.episodes.filter((B,re)=>re!==p)}:S);c(S=>({...S,seasons:m}))},U=d=>{d.preventDefault();const p=k.split(",").map(m=>m.trim()).filter(Boolean);i({...s,tags:p})},y="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",I="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:s.title,onChange:g,placeholder:"عنوان المسلسل",required:!0,className:y}),e.jsx("input",{type:"number",name:"year",value:s.year||"",onChange:g,placeholder:"سنة بداية العرض",required:!0,className:y})]}),e.jsx("textarea",{name:"description",value:s.description,onChange:g,placeholder:"وصف المسلسل العام",required:!0,className:`${y} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:s.poster_url,onChange:g,placeholder:"رابط البوستر الرئيسي",required:!0,className:y}),e.jsx("input",{type:"url",name:"backdrop_url",value:s.backdrop_url,onChange:g,placeholder:"رابط صورة الخلفية",required:!0,className:y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:s.imdb_rating??"",onChange:g,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:y}),e.jsx("input",{type:"url",name:"trailer_url",value:s.trailer_url??"",onChange:g,placeholder:"رابط المقطع الدعائي (اختياري)",className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:G,children:[e.jsx("button",{type:"button",onClick:()=>K(d=>!d),className:`${y} text-right`,children:s.genres.length>0?s.genres.join(", "):"اختر الفئات..."}),P&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:w.map(d=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.genres.includes(d),onChange:()=>R(d),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:d})]},d))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:k,onChange:v,placeholder:"أكشن, إثارة...",className:y})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),s.seasons.map((d,p)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:d.season_number||"",onChange:m=>F(p,"season_number",m.target.value),className:`${I} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>W(p),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:d.title,onChange:m=>F(p,"title",m.target.value),placeholder:"عنوان الموسم",required:!0,className:I}),e.jsx("input",{type:"number",value:d.year||"",onChange:m=>F(p,"year",m.target.value),placeholder:"سنة الموسم",required:!0,className:I}),e.jsx("input",{type:"number",value:d.imdb_rating??"",onChange:m=>F(p,"imdb_rating",m.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:I}),e.jsx("input",{type:"url",value:d.poster_url,onChange:m=>F(p,"poster_url",m.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${I} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:d.description,onChange:m=>F(p,"description",m.target.value),placeholder:"وصف الموسم",required:!0,className:`${I} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",d.season_number,":"]}),d.episodes.map((m,S)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:m.episode_number||"",onChange:j=>E(p,S,"episode_number",j.target.value),placeholder:"رقم",className:`${I} w-16`}),e.jsx("input",{type:"text",value:m.title,onChange:j=>E(p,S,"title",j.target.value),placeholder:"عنوان الحلقة",className:`${I} flex-1`}),e.jsx("button",{type:"button",onClick:()=>Y(p,S),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{type:"url",value:m.url,onChange:j=>E(p,S,"url",j.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${I} flex-1`}),e.jsx("button",{type:"button",onClick:()=>X(j=>E(p,S,"url",j)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("select",{value:m.quality||"1080p",onChange:j=>E(p,S,"quality",j.target.value),className:`${I} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]})]}),e.jsx("input",{type:"url",value:m.download_url||"",onChange:j=>E(p,S,"download_url",j.target.value),placeholder:"رابط التحميل (اختياري)",className:`${I} w-full`})]})]},S)),e.jsx("button",{type:"button",onClick:()=>M(p),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},p)),e.jsx("button",{type:"button",onClick:q,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:x,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:u,children:[u&&e.jsx(St,{}),n?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},Ue=10,Et=()=>{const[i,n]=o.useState([]),[x,u]=o.useState(null),[w,s]=o.useState(!1),[c,k]=o.useState(1),[b,P]=o.useState(""),[K,G]=o.useState(!1),[X,g]=o.useState(null),[v,R]=o.useState(!0),[F,q]=o.useState(!1),[W,E]=o.useState(null),[M,Y]=o.useState([]),[U,y]=o.useState(null),[I,d]=o.useState([]),p=async()=>{const{data:t,error:l}=await $.from("series").select("*").order("created_at",{ascending:!1});l?(console.error("Error fetching series: ",l),m("فشل في تحميل المسلسلات.","error")):n(t);const{data:h,error:_}=await $.from("categories").select("name").order("name");_?console.error("Error fetching categories: ",_):d(h.map(T=>T.name)),R(!1)};o.useEffect(()=>{R(!0),p();const t=$.channel("public:series").on("postgres_changes",{event:"*",schema:"public",table:"series"},p).subscribe();return()=>{$.removeChannel(t)}},[]),o.useEffect(()=>{k(1),Y([])},[b]);const m=(t,l)=>{E({message:t,type:l})},S=async t=>{q(!0);try{const{error:l}=await $.from("series").insert([{...t,created_at:new Date().toISOString()}]);if(l)throw l;await p(),s(!1),k(1),m("تمت إضافة المسلسل بنجاح.","success")}catch(l){console.error("Error adding series: ",l);const h=l.message||JSON.stringify(l);m(`حدث خطأ أثناء إضافة المسلسل: ${h}`,"error")}finally{q(!1)}},j=async(t,l)=>{q(!0);try{const{error:h}=await $.from("series").update(l).eq("id",t);if(h)throw h;await p(),u(null),s(!1),m("تم تحديث المسلسل بنجاح.","success")}catch(h){console.error("Error updating series:",h);const _=h.message||JSON.stringify(h);m(`حدث خطأ أثناء تحديث المسلسل: ${_}`,"error")}finally{q(!1)}},B=t=>{g(t),G(!0)},re=async()=>{if(X){q(!0);try{const{error:t}=await $.from("series").delete().eq("id",X.id);if(t)throw t;m("تم حذف المسلسل بنجاح.","success")}catch(t){console.error("Error deleting series:",t);const l=t.message||JSON.stringify(t);m(`حدث خطأ أثناء حذف المسلسل: ${l}`,"error")}finally{G(!1),g(null),q(!1)}}},te=t=>{u(t),s(!0)},we=()=>{u(null),s(!0)},ce=()=>{u(null),s(!1),y(null)},N=t=>{Y(l=>l.includes(t)?l.filter(h=>h!==t):[...l,t])},O=t=>{t.target.checked?Y(ee.map(l=>l.id)):Y(M.filter(l=>!ee.some(h=>h.id===l)))},V=async()=>{q(!0);try{const{error:t}=await $.from("series").delete().in("id",M);if(t)throw t;m(`تم حذف ${M.length} مسلسل بنجاح.`,"success"),Y([])}catch(t){console.error("Bulk delete failed:",t),m("فشل الحذف الجماعي.","error")}finally{q(!1),y(null)}},z=async(t,l)=>{q(!0);try{const{data:h,error:_}=await $.from("series").select("id, genres").in("id",M);if(_)throw _;const T=h.map(f=>{const C=f.genres||[],D=l==="add"?[...new Set([...C,t])]:C.filter(de=>de!==t);return{id:f.id,genres:D}}),{error:r}=await $.from("series").upsert(T);if(r)throw r;m(`تم ${l==="add"?"إضافة":"إزالة"} فئة "${t}" بنجاح.`,"success"),Y([])}catch(h){console.error("Bulk genre change failed:",h),m("فشل تغيير الفئة الجماعي.","error")}finally{q(!1),y(null)}},L=async(t,l)=>{q(!0);try{const{data:h,error:_}=await $.from("series").select("id, tags").in("id",M);if(_)throw _;const T=h.map(f=>{const C=f.tags||[],D=l==="add"?[...new Set([...C,t])]:C.filter(de=>de!==t);return{id:f.id,tags:D}}),{error:r}=await $.from("series").upsert(T);if(r)throw r;m(`تم ${l==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${t}" بنجاح.`,"success"),Y([])}catch(h){console.error("Bulk tags change failed:",h),m("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{q(!1),y(null)}},Z=i.filter(t=>mt(b,t.title)),ae=Math.ceil(Z.length/Ue),ee=Z.slice((c-1)*Ue,c*Ue),a=ee.length>0&&ee.every(t=>M.includes(t.id));return v?e.jsx(ht,{}):e.jsxs("div",{className:"relative",children:[W&&e.jsx(lt,{...W,onClose:()=>E(null)}),e.jsx(ke,{isOpen:K,onClose:()=>G(!1),onConfirm:re,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',X==null?void 0:X.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:F}),U==="delete"&&e.jsx(ke,{isOpen:!0,onClose:()=>y(null),onConfirm:V,title:`تأكيد حذف ${M.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:F}),U==="genre"&&e.jsx(xt,{genres:I,onClose:ce,onSubmit:z,isLoading:F}),U==="tags"&&e.jsx(pt,{onClose:ce,onSubmit:L,isLoading:F}),w&&e.jsx(Ce,{title:x?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:ce,isOpen:w,children:e.jsx(_t,{onSubmit:x?t=>j(x.id,t):S,initialData:x,onCancel:ce,isLoading:F,allGenres:I})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:we,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:b,onChange:t=>P(t.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})]})]}),M.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[M.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>Y([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>y("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>y("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:O,checked:a,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:ee.map(t=>{var l,h,_;return e.jsxs("tr",{className:`${M.includes(t.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:M.includes(t.id),onChange:()=>N(t.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:t.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(l=t.genres)==null?void 0:l.slice(0,3).map(T=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:T},T)),((h=t.genres)==null?void 0:h.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:((_=t.seasons)==null?void 0:_.length)||0}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>te(t),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>B(t),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:O,checked:a,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),ee.map(t=>{var l,h,_;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${M.includes(t.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:t.title}),e.jsx("input",{type:"checkbox",checked:M.includes(t.id),onChange:()=>N(t.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:t.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsxs("span",{children:[((l=t.seasons)==null?void 0:l.length)||0," مواسم"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(h=t.genres)==null?void 0:h.slice(0,2).map(T=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:T},T)),((_=t.genres)==null?void 0:_.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",t.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>te(t),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>B(t),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})]})]}),Z.length>Ue&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(nt,{currentPage:c,totalPages:ae,onPageChange:k})})]})},$t=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Mt=({onSubmit:i,initialData:n,onCancel:x,isLoading:u=!1})=>{const[w,s]=o.useState("");o.useEffect(()=>{s(n?n.name:"")},[n]);const c=k=>{k.preventDefault(),w.trim()&&i({name:w})};return e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:w,onChange:k=>s(k.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:x,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:u,children:[u&&e.jsx($t,{}),u?n?"جاري التحديث...":"جاري الإضافة...":n?"تحديث":"إضافة"]})]})]})},qt=10,At=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(qt)].map((i,n)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},n))})]})})}),Ft=({isOpen:i,onClose:n,onSubmit:x,isLoading:u,categories:w})=>{const[s,c]=o.useState(""),[k,b]=o.useState(""),[P,K]=o.useState(""),G=bt.useMemo(()=>w.filter(g=>g.name!==s),[w,s]);o.useEffect(()=>{if(i&&w.length>0){const g=w[0].name;c(g);const v=w.filter(R=>R.name!==g);b(v.length>0?v[0].name:"")}},[i,w]),o.useEffect(()=>{K(s&&k&&s===k?"لا يمكن دمج فئة مع نفسها. الرجاء اختيار فئتين مختلفتين.":"")},[s,k]),o.useEffect(()=>{G.some(g=>g.name===k)||b(G.length>0?G[0].name:"")},[s,G,k]);const X=g=>{g.preventDefault(),!(P||!s||!k)&&x(s,k)};return e.jsx(Ce,{title:"توحيد (دمج) الفئات",onClose:n,isOpen:i,children:e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"سيتم نقل كل المحتوى من الفئة المصدر إلى الفئة الهدف، ثم سيتم حذف الفئة المصدر نهائياً."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"دمج من هذه الفئة (سيتم حذفها):"}),e.jsx("select",{id:"source_category",value:s,onChange:g=>c(g.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",children:w.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"destination_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"الدمج في هذه الفئة (ستبقى):"}),e.jsx("select",{id:"destination_category",value:k,onChange:g=>b(g.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",disabled:G.length===0,children:G.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))})]}),P&&e.jsx("p",{className:"text-red-400 text-center text-sm bg-red-500/10 p-2 rounded-md",children:P}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:n,disabled:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!!P||!s||!k,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[u&&e.jsx(Ne,{}),u?"جاري الدمج...":"تنفيذ الدمج"]})]})]})})},Ge=10,Ot=({message:i,type:n,onClose:x})=>(o.useEffect(()=>{const s=setTimeout(x,5e3);return()=>clearTimeout(s)},[x]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${n==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:i}),e.jsx("button",{onClick:x,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Tt=({children:i,onClose:n,title:x,isOpen:u})=>{const[w,s]=o.useState(u);return o.useEffect(()=>{if(u){s(!0),document.body.style.overflow="hidden";const c=k=>{k.key==="Escape"&&n()};return window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)}}else{const c=setTimeout(()=>{s(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(c)}},[u,n]),w?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${u?"animate-fade-in":"animate-fade-out"}`,onClick:n,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${u?"animate-zoom-in":"animate-zoom-out"}`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:x}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),i]})}):null},Pt=()=>{const[i,n]=o.useState([]),[x,u]=o.useState(null),[w,s]=o.useState(!1),[c,k]=o.useState(1),[b,P]=o.useState(!1),[K,G]=o.useState(null),[X,g]=o.useState(!0),[v,R]=o.useState(!1),[F,q]=o.useState(null),[W,E]=o.useState(!1),[M,Y]=o.useState(null),U=async()=>{const{data:N,error:O}=await $.from("categories").select("*").order("name");O?(console.error("Error fetching categories: ",O),y("فشل في تحميل الفئات.","error")):n(N),g(!1)};o.useEffect(()=>{g(!0),U();const N=$.channel("public:categories").on("postgres_changes",{event:"*",schema:"public",table:"categories"},U).subscribe();return()=>{$.removeChannel(N)}},[]);const y=(N,O)=>{q({message:N,type:O})},I=async N=>{R(!0);try{const{error:O}=await $.from("categories").insert([N]);if(O)throw O;y("تمت إضافة الفئة بنجاح!","success"),s(!1),k(1)}catch(O){console.error("Error adding category: ",O);const V=O.message||JSON.stringify(O);y(`حدث خطأ أثناء إضافة الفئة: ${V}`,"error")}finally{R(!1)}},d=async(N,O)=>{R(!0);const V=x==null?void 0:x.name,z=O.name,L=V&&z&&V!==z;try{const{error:Z}=await $.from("categories").update(O).eq("id",N);if(Z)throw Z;if(L){y("تم تحديث الفئة. جاري تحديث المحتوى المرتبط...","success");const{data:ae,error:ee}=await $.from("movies").select("id, genres").contains("genres",[V]);if(ee)console.error("Error fetching movies to update:",ee),y("تم تحديث الفئة، لكن حدث خطأ أثناء جلب الأفلام للتحديث.","error");else if(ae&&ae.length>0){const l=ae.map(T=>{const r=T.genres.map(f=>f===V?z:f);return $.from("movies").update({genres:r}).eq("id",T.id)}),_=(await Promise.all(l)).find(T=>T.error);_&&(console.error("Error updating movies with new category:",_.error),y("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض الأفلام.","error"))}const{data:a,error:t}=await $.from("series").select("id, genres").contains("genres",[V]);if(t)console.error("Error fetching series to update:",t),y("تم تحديث الفئة، لكن حدث خطأ أثناء جلب المسلسلات للتحديث.","error");else if(a&&a.length>0){const l=a.map(T=>{const r=T.genres.map(f=>f===V?z:f);return $.from("series").update({genres:r}).eq("id",T.id)}),_=(await Promise.all(l)).find(T=>T.error);_&&(console.error("Error updating series with new category:",_.error),y("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض المسلسلات.","error"))}y("تم تحديث الفئة والمحتوى المرتبط بنجاح!","success")}else y("تم تحديث الفئة بنجاح!","success");u(null),s(!1)}catch(Z){if(console.error("Error updating category transaction: ",Z),Z.code==="23505")y(`فشل التحديث: اسم الفئة "${z}" موجود بالفعل.`,"error");else{const ae=Z.message||JSON.stringify(Z);y(`حدث خطأ أثناء تحديث الفئة: ${ae}`,"error")}}finally{R(!1)}},p=N=>{G(N),P(!0)},m=async()=>{if(K){R(!0);try{const{error:N}=await $.from("categories").delete().eq("id",K.id);if(N)throw N;y("تم حذف الفئة بنجاح!","success")}catch(N){console.error("Error deleting category: ",N);const O=N.message||JSON.stringify(N);y(`حدث خطأ أثناء حذف الفئة: ${O}`,"error")}finally{P(!1),G(null),R(!1)}}},S=N=>{u(N),s(!0)},j=()=>{u(null),s(!0)},B=()=>{u(null),s(!1)},re=(N,O)=>{E(!1),Y({source:N,dest:O})},te=async()=>{if(!M)return;const{source:N,dest:O}=M;R(!0);try{y("جاري تحديث الأفلام...","success");const{data:V,error:z}=await $.from("movies").select("id, genres").contains("genres",[N]);if(z)throw new Error(`Failed to fetch movies: ${z.message}`);if(V&&V.length>0){const ee=V.map(a=>{const t=[...new Set(a.genres.filter(l=>l!==N).concat([O]))];return $.from("movies").update({genres:t}).eq("id",a.id)});await Promise.all(ee)}y("جاري تحديث المسلسلات...","success");const{data:L,error:Z}=await $.from("series").select("id, genres").contains("genres",[N]);if(Z)throw new Error(`Failed to fetch series: ${Z.message}`);if(L&&L.length>0){const ee=L.map(a=>{const t=[...new Set(a.genres.filter(l=>l!==N).concat([O]))];return $.from("series").update({genres:t}).eq("id",a.id)});await Promise.all(ee)}y("جاري حذف الفئة المدمجة...","success");const{error:ae}=await $.from("categories").delete().eq("name",N);if(ae)throw new Error(`Failed to delete category: ${ae.message}`);y("تم دمج الفئات بنجاح!","success")}catch(V){console.error("Error merging categories: ",V),y(`فشل دمج الفئات: ${V.message}`,"error")}finally{Y(null),R(!1)}},we=Math.ceil(i.length/Ge),ce=i.slice((c-1)*Ge,c*Ge);return X?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(At,{})]}):e.jsxs("div",{children:[F&&e.jsx(Ot,{...F,onClose:()=>q(null)}),e.jsx(ke,{isOpen:b,onClose:()=>P(!1),onConfirm:m,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',K==null?void 0:K.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:v}),e.jsx(ke,{isOpen:!!M,onClose:()=>Y(null),onConfirm:te,title:"تأكيد عملية الدمج",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد دمج الفئة ",e.jsxs("strong",{className:"text-white",children:['"',M==null?void 0:M.source,'"']})," في الفئة ",e.jsxs("strong",{className:"text-white",children:['"',M==null?void 0:M.dest,'"']}),"؟",e.jsx("br",{}),e.jsxs("span",{className:"text-yellow-400",children:['سيتم حذف الفئة "',M==null?void 0:M.source,'" نهائياً. لا يمكن التراجع عن هذا الإجراء.']})]}),isLoading:v}),e.jsx(Ft,{isOpen:W,onClose:()=>E(!1),onSubmit:re,isLoading:v,categories:i}),e.jsx(Tt,{isOpen:w,title:x?"تعديل الفئة":"إضافة فئة جديدة",onClose:B,children:e.jsx(Mt,{onSubmit:x?N=>d(x.id,N):I,initialData:x,onCancel:B,isLoading:v})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("button",{onClick:j,className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsx("button",{onClick:()=>E(!0),className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition-colors",children:"توحيد الفئات"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden hidden sm:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:i.length>0?ce.map(N=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:N.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>S(N),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>p(N),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},N.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:i.length>0?ce.map(N=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-white",children:N.name}),e.jsxs("div",{className:"flex gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>S(N),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:"تعديل"}),e.jsx("button",{onClick:()=>p(N),className:"text-red-500 hover:text-red-400 text-sm font-medium",children:"حذف"})]})]},N.id)):e.jsx("div",{className:"text-center py-8 text-gray-400 bg-slate-900/50 rounded-lg",children:"لا توجد فئات حالياً."})})]}),i.length>Ge&&e.jsx("div",{className:"mt-4",children:e.jsx(nt,{currentPage:c,totalPages:we,onPageChange:k})})]})},st=["movies","series","categories"],Rt=i=>i.replace(/[A-Z]/g,n=>`_${n.toLowerCase()}`),at=i=>Array.isArray(i)?i.map(n=>at(n)):i!==null&&typeof i=="object"&&i.constructor===Object?i.hasOwnProperty("seconds")&&i.hasOwnProperty("nanoseconds")&&Object.keys(i).length===2&&typeof i.seconds=="number"&&typeof i.nanoseconds=="number"?new Date(i.seconds*1e3).toISOString():i.hasOwnProperty("_seconds")&&i.hasOwnProperty("_nanoseconds")&&Object.keys(i).length===2&&typeof i._seconds=="number"&&typeof i._nanoseconds=="number"?new Date(i._seconds*1e3).toISOString():Object.keys(i).reduce((n,x)=>{const u=Rt(x);return n[u]=at(i[x]),n},{}):i,Bt=()=>{const[i,n]=o.useState(!1),[x,u]=o.useState(null),[w,s]=o.useState(!1),[c,k]=o.useState(null),b=(g,v)=>{u({message:g,type:v})},P=async()=>{n(!0),b("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const g={};for(const E of st){const{data:M,error:Y}=await $.from(E).select("*");if(Y)throw Y;g[E]=M||[]}const v=JSON.stringify(g,null,2),R=new Blob([v],{type:"application/json"}),F=URL.createObjectURL(R),q=document.createElement("a");q.href=F;const W=new Date().toISOString().slice(0,10);q.download=`supabase-backup-${W}.json`,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(F),b("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(g){console.error("Backup failed:",g);let v="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";g.code==="42501"&&(v="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد RLS تسمح للمشرفين بقراءة المجموعات."),b(v,"error")}finally{n(!1)}},K=g=>{var R;const v=(R=g.target.files)==null?void 0:R[0];if(v){const F=new FileReader;F.onload=q=>{var W;try{const E=(W=q.target)==null?void 0:W.result,M=JSON.parse(E);k(M)}catch(E){b("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",E),k(null)}},F.readAsText(v)}},G=()=>{c?s(!0):b("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},X=async()=>{if(s(!1),!!c){n(!0),b("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let g=0,v=[];for(const F of Object.keys(c)){if(!st.includes(F)){v.push(F),console.warn(`Skipping restore for unsupported collection: "${F}"`);continue}const q=c[F];if(Array.isArray(q)&&q.length>0){const W=q.map(M=>at(M)),{error:E}=await $.from(F).upsert(W);if(E)throw console.error(`Error during upsert to "${F}":`,JSON.stringify(E,null,2)),console.error("First failed object (transformed):",JSON.stringify(W[0],null,2)),E;g++}}let R="تمت استعادة البيانات بنجاح!";v.length>0&&(R+=` تم تخطي المجموعات التالية: ${v.join(", ")}.`),g===0&&v.length>0?b(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${v.join(", ")}.`,"error"):g>0?b(R,"success"):b("لم يتم العثور على بيانات صالحة للاستعادة في الملف.","error")}catch(g){console.error("Restore failed:",JSON.stringify(g,null,2));const v=`فشلت عملية الاستعادة: ${g.message||"خطأ غير معروف"}. يرجى مراجعة وحدة التحكم للحصول على التفاصيل الفنية.`;b(v,"error")}finally{n(!1),k(null)}}};return e.jsxs("div",{className:"space-y-12",children:[x&&e.jsx(lt,{...x,onClose:()=>u(null)}),e.jsx(ke,{isOpen:w,onClose:()=>s(!1),onConfirm:X,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:i}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",st.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:P,disabled:i,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[i&&e.jsx(Ne,{}),i?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:K,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:G,disabled:i||!c,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[i&&e.jsx(Ne,{}),i?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},rt=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(Ct,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Et,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Pt,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(Bt,{})}],Lt=({label:i,tabKey:n,activeTab:x,onClick:u})=>e.jsx("button",{onClick:()=>u(n),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex-shrink-0 ${x===n?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":x===n,children:i}),Dt=()=>{var u;const[i,n]=o.useState(rt[0].key),x=(u=rt.find(w=>w.key===i))==null?void 0:u.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6 overflow-x-auto whitespace-nowrap scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",role:"tablist",children:rt.map(w=>e.jsx(Lt,{label:w.label,tabKey:w.key,activeTab:i,onClick:n},w.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-3 sm:p-6 rounded-lg border border-slate-700",children:x})]})};export{Dt as default};
