import{r as t,d as $,j as e,f as xe,F as J,T as he,u as ye}from"./index-C75TUr8p.js";import{P as ie}from"./Pagination-Cc511sZ2.js";const je=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),we=({onSubmit:h,initialData:s,onCancel:c,isKurdishByDefault:r=!1,isLoading:g=!1,allGenres:n=[]})=>{const[u,f]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1}),[S,E]=t.useState(""),[P,z]=t.useState(!1),[B,I]=t.useState(""),[R,D]=t.useState(""),[q,F]=t.useState(!1),v=t.useRef(null),[A,T]=t.useState(!1),[G,N]=t.useState(""),y=t.useRef(null);t.useEffect(()=>{s?(f({...s,genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:s.backupServers||[],trailerUrl:s.trailerUrl||"",isKurdish:s.isKurdish||!1}),E((s.tags||[]).join(", "))):(f({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:r}),E(""))},[s,r]),t.useEffect(()=>{const a=x=>{v.current&&!v.current.contains(x.target)&&z(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),t.useEffect(()=>{y.current&&clearTimeout(y.current);const a=u.title.trim();if(!a||s&&a===s.title.trim()){N(""),T(!1);return}return T(!0),N(""),y.current=window.setTimeout(async()=>{try{const x=await $.collection("movies").where("title","==",a).get();let b=!1;x.empty||(s?x.forEach(O=>{O.id!==s.id&&(b=!0)}):b=!0),N(b?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(x){console.error("Error checking for duplicate title:",x)}finally{T(!1)}},500),()=>{y.current&&clearTimeout(y.current)}},[u.title,s]);const o=a=>{const{name:x,value:b,type:O}=a.target;if(O==="checkbox"){const{checked:K}=a.target;f(te=>({...te,[x]:K}))}else f(K=>({...K,[x]:x==="year"?parseInt(b):b}))},i=a=>{E(a.target.value)},p=a=>{f(x=>{const b=x.genres||[],O=b.includes(a)?b.filter(K=>K!==a):[...b,a];return{...x,genres:O}})},j=async()=>{const a=R.trim();if(a){if(n.some(x=>x.toLowerCase()===a.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}F(!0);try{await $.collection("categories").add({name:a}),f(x=>({...x,genres:[...x.genres||[],a]})),D("")}catch(x){console.error("Error adding new genre:",x),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{F(!1)}}},m=(a,x,b)=>{const O=[...u.servers];O[a]={...O[a],[x]:b},f(K=>({...K,servers:O}))},L=()=>{f(a=>{const x={name:`Server ${a.servers.length+1}`,url:"",quality:"720p"};return{...a,servers:[...a.servers,x]}})},k=a=>{f(x=>({...x,servers:x.servers.filter((b,O)=>O!==a)}))},_=(a,x,b)=>{const O=[...u.backupServers||[]];O[a]={...O[a],[x]:b},f(K=>({...K,backupServers:O}))},ee=()=>{f(a=>{var x;return{...a,backupServers:[...a.backupServers||[],{name:`Backup Server ${(((x=a.backupServers)==null?void 0:x.length)||0)+1}`,url:"",quality:"720p"}]}})},V=a=>{f(x=>({...x,backupServers:(x.backupServers||[]).filter((b,O)=>O!==a)}))},se=a=>{if(a.preventDefault(),u.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const x=S.split(",").map(b=>b.trim()).filter(b=>b!=="");h({...u,tags:x})},H=n.filter(a=>a.toLowerCase().includes(B.toLowerCase())),W="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",Y="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:u.title,onChange:o,placeholder:"عنوان الفيلم",required:!0,className:W}),A&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),G&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),G]})]}),e.jsx("input",{type:"number",name:"year",value:u.year,onChange:o,placeholder:"سنة الإنتاج",required:!0,className:W})]}),e.jsx("textarea",{name:"description",value:u.description,onChange:o,placeholder:"وصف الفيلم",required:!0,className:`${W} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:u.posterUrl,onChange:o,placeholder:"رابط صورة البوستر",required:!0,className:W}),e.jsx("input",{type:"url",name:"backdropUrl",value:u.backdropUrl,onChange:o,placeholder:"رابط صورة الخلفية",required:!0,className:W})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:S,onChange:i,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:W})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!u.isKurdish,onChange:o,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsxs("button",{type:"button",onClick:()=>z(a=>!a),className:`${W} text-right flex justify-between items-center min-h-[52px]`,"aria-haspopup":"true","aria-expanded":P,children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:u.genres.length>0?u.genres.map(a=>e.jsxs("span",{className:"bg-cyan-500 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1",children:[a,e.jsx("button",{type:"button",onClick:x=>{x.stopPropagation(),p(a)},className:"text-cyan-100 hover:text-white leading-none text-lg","aria-label":`إزالة ${a}`,children:"×"})]},a)):e.jsx("span",{className:"text-slate-400 px-1",children:"اختر الفئات..."})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-slate-400 transition-transform ${P?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),P&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg animate-fade-in-up-fast",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",placeholder:"ابحث عن فئة...",value:B,onChange:a=>I(a.target.value),className:"w-full bg-slate-800 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none",autoFocus:!0})}),e.jsx("ul",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:H.length>0?H.map(a=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-700 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:u.genres.includes(a),onChange:()=>p(a),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("span",{className:"text-white select-none",children:a})]})},a)):e.jsx("li",{className:"text-slate-400 text-center p-4",children:"لا توجد نتائج"})}),e.jsx("div",{className:"border-t border-slate-700 p-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"أو أضف فئة جديدة...",value:R,onChange:a=>D(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),j())},className:"flex-grow bg-slate-800 text-white p-2 text-sm rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:j,disabled:q||!R.trim(),className:"flex-shrink-0 bg-cyan-600 text-white px-3 py-1.5 text-sm font-bold rounded-md hover:bg-cyan-700 transition-colors disabled:bg-slate-500 disabled:cursor-not-allowed",children:q?"...":"إضافة"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"downloadUrl",value:u.downloadUrl??"",onChange:o,placeholder:"رابط التحميل (اختياري)",className:W}),e.jsx("input",{type:"url",name:"trailerUrl",value:u.trailerUrl??"",onChange:o,placeholder:"رابط المقطع الدعائي (اختياري)",className:W})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات المشاهدة"}),u.servers.map((a,x)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:a.name,onChange:b=>m(x,"name",b.target.value),placeholder:"اسم السيرفر",className:`${Y} flex-1`}),e.jsx("input",{type:"url",value:a.url,onChange:b=>m(x,"url",b.target.value),placeholder:"رابط السيرفر",required:!0,className:`${Y} flex-grow-[2]`}),e.jsxs("select",{value:a.quality,onChange:b=>m(x,"quality",b.target.value),className:`${Y} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>k(x),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},x)),e.jsx("button",{type:"button",onClick:L,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات احتياطية (اختياري)"}),(u.backupServers||[]).map((a,x)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:a.name,onChange:b=>_(x,"name",b.target.value),placeholder:"اسم السيرفر الاحتياطي",className:`${Y} flex-1`}),e.jsx("input",{type:"url",value:a.url,onChange:b=>_(x,"url",b.target.value),placeholder:"رابط السيرفر الاحتياطي",className:`${Y} flex-grow-[2]`}),e.jsxs("select",{value:a.quality,onChange:b=>_(x,"quality",b.target.value),className:`${Y} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>V(x),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},x)),e.jsx("button",{type:"button",onClick:ee,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:g,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:g||!!G,children:[g&&e.jsx(je,{}),g?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},ve=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Z=({isOpen:h,onClose:s,onConfirm:c,title:r,message:g,isLoading:n=!1})=>h?e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md animate-zoom-in border border-slate-700",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:r}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:g})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:c,disabled:n,children:[n&&e.jsx(ve,{}),n?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:n,children:"إلغاء"})]})]})}):null,Ne=10,pe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((h,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(Ne)].map((h,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((c,r)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},r))]},s))})]})})]}),ge=({message:h,type:s,onClose:c})=>(t.useEffect(()=>{const n=setTimeout(c,5e3);return()=>clearTimeout(n)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),re=({children:h,onClose:s,title:c})=>(t.useEffect(()=>{const r=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",r),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",r),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,children:e.jsx("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] animate-zoom-in border border-slate-700",onClick:r=>r.stopPropagation(),children:e.jsxs("div",{className:"p-6 md:p-8 overflow-y-auto max-h-[90vh] scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),h]})})})),ue=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),be=({genres:h,onSubmit:s,onClose:c,isLoading:r})=>{const[g,n]=t.useState(h[0]||""),[u,f]=t.useState("add"),S=E=>{E.preventDefault(),g&&s(g,u)};return e.jsx(re,{title:"تغيير الفئة بشكل جماعي",onClose:c,children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:g,onChange:E=>n(E.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:h.map(E=>e.jsx("option",{value:E,children:E},E))}),e.jsxs("select",{value:u,onChange:E=>f(E.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:c,disabled:r,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:r||!g,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[r&&e.jsx(ue,{}),r?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ce=({onSubmit:h,onClose:s,isLoading:c})=>{const[r,g]=t.useState(new Date().getFullYear()),n=u=>{u.preventDefault(),h(r)};return e.jsx(re,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:r,onChange:u=>g(parseInt(u.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[c&&e.jsx(ue,{}),c?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},fe=({onSubmit:h,onClose:s,isLoading:c})=>{const[r,g]=t.useState(""),[n,u]=t.useState("add"),f=S=>{S.preventDefault(),r.trim()&&h(r.trim(),n)};return e.jsx(re,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:r,onChange:S=>g(S.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:n,onChange:S=>u(S.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c||!r.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[c&&e.jsx(ue,{}),c?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},le=10,ke=()=>{const[h,s]=t.useState([]),[c,r]=t.useState(null),[g,n]=t.useState(!1),[u,f]=t.useState(1),[S,E]=t.useState("all"),[P,z]=t.useState(""),[B,I]=t.useState(!1),[R,D]=t.useState(null),[q,F]=t.useState(!0),[v,A]=t.useState(!1),[T,G]=t.useState(null),[N,y]=t.useState([]),[o,i]=t.useState(null),[p,j]=t.useState([]);t.useEffect(()=>{F(!0);const l=$.collection("movies").orderBy("createdAt","desc").onSnapshot(U=>{const X=U.docs.map(Q=>({id:Q.id,...Q.data()}));s(X),F(!1)},U=>{console.error("Error fetching movies: ",U),G({message:"فشل في تحميل الأفلام.",type:"error"}),F(!1)}),w=$.collection("categories").orderBy("name").onSnapshot(U=>{const X=U.docs.map(Q=>Q.data().name);j(X)},U=>{console.error("Error fetching categories from ManageMovies: ",U)});return()=>{l(),w()}},[]),t.useEffect(()=>{f(1),y([])},[S,P]);const m=(l,w)=>{G({message:l,type:w})},L=async l=>{A(!0);try{await $.collection("movies").add({...l,createdAt:he.now()}),n(!1),f(1),m("تمت إضافة الفيلم بنجاح.","success")}catch(w){console.error("Error adding movie: ",w),m("حدث خطأ أثناء إضافة الفيلم.","error")}finally{A(!1)}},k=async(l,w)=>{A(!0);try{await $.collection("movies").doc(l).update(w),r(null),n(!1),m("تم تحديث الفيلم بنجاح.","success")}catch(U){console.error("Error updating movie: ",U),m("حدث خطأ أثناء تحديث الفيلم.","error")}finally{A(!1)}},_=l=>{D(l),I(!0)},ee=async()=>{if(R){A(!0);try{await $.collection("movies").doc(R.id).delete(),m("تم حذف الفيلم بنجاح.","success")}catch(l){console.error("Error deleting movie: ",l),m("حدث خطأ أثناء حذف الفيلم.","error")}finally{I(!1),D(null),A(!1)}}},V=l=>{r(l),n(!0)},se=()=>{r(null),n(!0)},H=()=>{r(null),n(!1),i(null)},W=l=>{y(w=>w.includes(l)?w.filter(U=>U!==l):[...w,l])},Y=l=>{l.target.checked?y(d.map(w=>w.id)):y([])},a=async(l,w)=>{A(!0);try{const U=$.batch();N.forEach(X=>{const Q=$.collection("movies").doc(X);U.update(Q,l)}),await U.commit(),m(w,"success"),y([])}catch(U){console.error("Bulk update failed:",U),m("فشل التحديث الجماعي.","error")}finally{A(!1),i(null)}},x=async()=>{A(!0);try{const l=$.batch();N.forEach(w=>{const U=$.collection("movies").doc(w);l.delete(U)}),await l.commit(),m(`تم حذف ${N.length} فيلم بنجاح.`,"success"),y([])}catch(l){console.error("Bulk delete failed:",l),m("فشل الحذف الجماعي.","error")}finally{A(!1),i(null)}},b=async(l,w)=>{const U={genres:w==="add"?J.arrayUnion(l):J.arrayRemove(l)};await a(U,`تم ${w==="add"?"إضافة":"إزالة"} فئة "${l}" بنجاح.`)},O=async(l,w)=>{const U={tags:w==="add"?J.arrayUnion(l):J.arrayRemove(l)};await a(U,`تم ${w==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${l}" بنجاح.`)},K=h.filter(l=>S==="kurdish"?l.isKurdish===!0:S==="non-kurdish"?!l.isKurdish:!0).filter(l=>xe(P,l.title)),te=Math.ceil(K.length/le),d=K.slice((u-1)*le,u*le),C=l=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${S===l?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,M=d.length>0&&N.length===d.length;return q?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[T&&e.jsx(ge,{...T,onClose:()=>G(null)}),e.jsx(Z,{isOpen:B,onClose:()=>I(!1),onConfirm:ee,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',R==null?void 0:R.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:v}),o==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>i(null),onConfirm:x,title:`تأكيد حذف ${N.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:v}),o==="genre"&&e.jsx(be,{genres:p,onClose:H,onSubmit:b,isLoading:v}),o==="tags"&&e.jsx(fe,{onClose:H,onSubmit:O,isLoading:v}),o==="year"&&e.jsx(Ce,{onClose:H,onSubmit:l=>a({year:l},"تم تحديث السنة بنجاح."),isLoading:v}),o==="markKurdish"&&e.jsx(Z,{isOpen:!0,onClose:H,onConfirm:()=>a({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:v}),o==="unmarkKurdish"&&e.jsx(Z,{isOpen:!0,onClose:H,onConfirm:()=>a({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:v}),g&&e.jsx(re,{title:c?"تعديل الفيلم":"إضافة فيلم جديد",onClose:H,children:e.jsx(we,{onSubmit:c?l=>k(c.id,l):L,initialData:c,onCancel:H,isKurdishByDefault:S==="kurdish"&&!c,isLoading:v,allGenres:p})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:se,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:P,onChange:l=>z(l.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>E("all"),className:C("all"),children:"الكل"}),e.jsx("button",{onClick:()=>E("kurdish"),className:C("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>E("non-kurdish"),className:C("non-kurdish"),children:"غير كردي"})]})]}),N.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[N.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>y([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>i("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>i("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>i("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>i("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>i("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>i("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:Y,checked:M,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الكلمات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:d.map(l=>{var w,U,X,Q,me;return e.jsxs("tr",{className:`${N.includes(l.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:N.includes(l.id),onChange:()=>W(l.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:l.posterUrl,alt:l.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:l.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:l.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(w=l.genres)==null?void 0:w.slice(0,3).map(ae=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:ae},ae)),((U=l.genres)==null?void 0:U.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(X=l.tags)==null?void 0:X.slice(0,3).map(ae=>e.jsx("span",{className:"bg-slate-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:ae},ae)),((Q=l.tags)==null?void 0:Q.length)>3&&e.jsx("span",{className:"bg-slate-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:l.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(me=l.createdAt)!=null&&me.toDate?l.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>V(l),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>_(l),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},l.id)})})]})}),K.length>le&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:u,totalPages:te,onPageChange:f})})]})]})},Se=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ee=({onSubmit:h,initialData:s,onCancel:c,isLoading:r=!1,allGenres:g=[]})=>{const[n,u]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{seasonNumber:1,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"",downloadUrl:""}]}],trailerUrl:""}),[f,S]=t.useState(""),[E,P]=t.useState(!1),z=t.useRef(null);t.useEffect(()=>{s&&(u({...s,genres:s.genres||[],tags:s.tags||[],seasons:s.seasons&&s.seasons.length>0?s.seasons:[{seasonNumber:1,episodes:[]}],trailerUrl:s.trailerUrl||""}),S((s.tags||[]).join(", ")))},[s]),t.useEffect(()=>{const o=i=>{z.current&&!z.current.contains(i.target)&&P(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const B=o=>{const{name:i,value:p}=o.target;u(j=>({...j,[i]:i==="year"?parseInt(p):p}))},I=o=>{S(o.target.value)},R=o=>{u(i=>({...i,genres:i.genres.includes(o)?i.genres.filter(p=>p!==o):[...i.genres,o]}))},D=(o,i,p)=>{const j=[...n.seasons];j[o][i]=p,u(m=>({...m,seasons:j}))},q=()=>{const o=n.seasons.length>0?Math.max(...n.seasons.map(i=>i.seasonNumber))+1:1;u(i=>({...i,seasons:[...i.seasons,{seasonNumber:o,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"",downloadUrl:""}]}]}))},F=o=>{u(i=>({...i,seasons:i.seasons.filter((p,j)=>j!==o)}))},v=(o,i,p,j)=>{const m=[...n.seasons],L=[...m[o].episodes];L[i]={...L[i],[p]:j},m[o]={...m[o],episodes:L},u(k=>({...k,seasons:m}))},A=o=>{const i=n.seasons[o].episodes.length>0?Math.max(...n.seasons[o].episodes.map(j=>j.episodeNumber))+1:1,p=[...n.seasons];p[o].episodes.push({episodeNumber:i,title:`الحلقة ${i}`,url:"",downloadUrl:""}),u(j=>({...j,seasons:p}))},T=(o,i)=>{const p=[...n.seasons];p[o].episodes=p[o].episodes.filter((j,m)=>m!==i),u(j=>({...j,seasons:p}))},G=o=>{o.preventDefault();const i=f.split(",").map(p=>p.trim()).filter(Boolean);h({...n,tags:i})},N="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",y="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:n.title,onChange:B,placeholder:"عنوان المسلسل",required:!0,className:N}),e.jsx("input",{type:"number",name:"year",value:n.year,onChange:B,placeholder:"سنة الإنتاج",required:!0,className:N})]}),e.jsx("textarea",{name:"description",value:n.description,onChange:B,placeholder:"وصف المسلسل",required:!0,className:`${N} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:n.posterUrl,onChange:B,placeholder:"رابط صورة البوستر",required:!0,className:N}),e.jsx("input",{type:"url",name:"backdropUrl",value:n.backdropUrl,onChange:B,placeholder:"رابط صورة الخلفية",required:!0,className:N})]}),e.jsx("input",{type:"url",name:"trailerUrl",value:n.trailerUrl??"",onChange:B,placeholder:"رابط المقطع الدعائي (اختياري)",className:N}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:z,children:[e.jsx("button",{type:"button",onClick:()=>P(o=>!o),className:`${N} text-right`,children:n.genres.length>0?n.genres.join(", "):"اختر الفئات..."}),E&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:g.map(o=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.genres.includes(o),onChange:()=>R(o)}),e.jsx("span",{children:o})]},o))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:f,onChange:I,placeholder:"أكشن, إثارة...",className:N})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),n.seasons.map((o,i)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:o.seasonNumber,onChange:p=>D(i,"seasonNumber",parseInt(p.target.value)),className:`${y} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>F(i),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"space-y-2 pl-4 border-r-2 border-slate-600",children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"الحلقات:"}),o.episodes.map((p,j)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:p.episodeNumber,onChange:m=>v(i,j,"episodeNumber",parseInt(m.target.value)),placeholder:"رقم",className:`${y} w-16`}),e.jsx("input",{type:"text",value:p.title,onChange:m=>v(i,j,"title",m.target.value),placeholder:"عنوان الحلقة",className:`${y} flex-1`}),e.jsx("button",{type:"button",onClick:()=>T(i,j),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:p.url,onChange:m=>v(i,j,"url",m.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${y} flex-1`}),e.jsx("input",{type:"url",value:p.downloadUrl||"",onChange:m=>v(i,j,"downloadUrl",m.target.value),placeholder:"رابط التحميل (اختياري)",className:`${y} flex-1`})]})]},j)),e.jsx("button",{type:"button",onClick:()=>A(i),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},i)),e.jsx("button",{type:"button",onClick:q,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:r,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:r,children:[r&&e.jsx(Se,{}),s?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},ne=10,Ae=()=>{const[h,s]=t.useState([]),[c,r]=t.useState(null),[g,n]=t.useState(!1),[u,f]=t.useState(1),[S,E]=t.useState(""),[P,z]=t.useState(!1),[B,I]=t.useState(null),[R,D]=t.useState(!0),[q,F]=t.useState(!1),[v,A]=t.useState(null),[T,G]=t.useState([]),[N,y]=t.useState(null),[o,i]=t.useState([]);t.useEffect(()=>{D(!0);const d=$.collection("series").orderBy("createdAt","desc").onSnapshot(M=>{const l=M.docs.map(w=>({id:w.id,...w.data()}));s(l),D(!1)},M=>{console.error("Error fetching series: ",M),A({message:"فشل في تحميل المسلسلات.",type:"error"}),D(!1)}),C=$.collection("categories").orderBy("name").onSnapshot(M=>{const l=M.docs.map(w=>w.data().name);i(l)},M=>{console.error("Error fetching categories from ManageSeries: ",M)});return()=>{d(),C()}},[]),t.useEffect(()=>{f(1),G([])},[S]);const p=(d,C)=>{A({message:d,type:C})},j=async d=>{F(!0);try{await $.collection("series").add({...d,createdAt:he.now()}),n(!1),f(1),p("تمت إضافة المسلسل بنجاح.","success")}catch(C){console.error("Error adding series: ",C),p("حدث خطأ أثناء إضافة المسلسل.","error")}finally{F(!1)}},m=async(d,C)=>{F(!0);try{await $.collection("series").doc(d).update(C),r(null),n(!1),p("تم تحديث المسلسل بنجاح.","success")}catch(M){console.error("Error updating series: ",M),p("حدث خطأ أثناء تحديث المسلسل.","error")}finally{F(!1)}},L=d=>{I(d),z(!0)},k=async()=>{if(B){F(!0);try{await $.collection("series").doc(B.id).delete(),p("تم حذف المسلسل بنجاح.","success")}catch(d){console.error("Error deleting series: ",d),p("حدث خطأ أثناء حذف المسلسل.","error")}finally{z(!1),I(null),F(!1)}}},_=d=>{r(d),n(!0)},ee=()=>{r(null),n(!0)},V=()=>{r(null),n(!1),y(null)},se=d=>{G(C=>C.includes(d)?C.filter(M=>M!==d):[...C,d])},H=d=>{d.target.checked?G(K.map(C=>C.id)):G([])},W=async()=>{F(!0);try{const d=$.batch();T.forEach(C=>{const M=$.collection("series").doc(C);d.delete(M)}),await d.commit(),p(`تم حذف ${T.length} مسلسل بنجاح.`,"success"),G([])}catch(d){console.error("Bulk delete failed:",d),p("فشل الحذف الجماعي.","error")}finally{F(!1),y(null)}},Y=async(d,C)=>{const M={genres:C==="add"?J.arrayUnion(d):J.arrayRemove(d)};await x(M,`تم ${C==="add"?"إضافة":"إزالة"} فئة "${d}" بنجاح.`)},a=async(d,C)=>{const M={tags:C==="add"?J.arrayUnion(d):J.arrayRemove(d)};await x(M,`تم ${C==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${d}" بنجاح.`)},x=async(d,C)=>{F(!0);try{const M=$.batch();T.forEach(l=>{const w=$.collection("series").doc(l);M.update(w,d)}),await M.commit(),p(C,"success"),G([])}catch(M){console.error("Bulk update failed:",M),p("فشل التحديث الجماعي.","error")}finally{F(!1),y(null)}},b=h.filter(d=>xe(S,d.title)),O=Math.ceil(b.length/ne),K=b.slice((u-1)*ne,u*ne),te=K.length>0&&T.length===K.length;return R?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[v&&e.jsx(ge,{...v,onClose:()=>A(null)}),e.jsx(Z,{isOpen:P,onClose:()=>z(!1),onConfirm:k,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',B==null?void 0:B.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:q}),N==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>y(null),onConfirm:W,title:`تأكيد حذف ${T.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:q}),N==="genre"&&e.jsx(be,{genres:o,onClose:V,onSubmit:Y,isLoading:q}),N==="tags"&&e.jsx(fe,{onClose:V,onSubmit:a,isLoading:q}),g&&e.jsx(re,{title:c?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:V,children:e.jsx(Ee,{onSubmit:c?d=>m(c.id,d):j,initialData:c,onCancel:V,isLoading:q,allGenres:o})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ee,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsx("div",{className:"relative w-full sm:flex-grow",children:e.jsx("input",{type:"text",value:S,onChange:d=>E(d.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-4 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})})]}),T.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("span",{className:"text-white font-bold",children:[T.length," مسلسل محدد"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>y("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>y("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:H,checked:te})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:K.map(d=>{var C,M;return e.jsxs("tr",{className:`${T.includes(d.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:T.includes(d.id),onChange:()=>se(d.id)})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:d.posterUrl,alt:d.title,className:"h-20 w-auto rounded"})}),e.jsx("td",{className:"px-4 py-2 font-medium text-white",children:d.title}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:d.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:((C=d.seasons)==null?void 0:C.length)||0}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:(M=d.createdAt)!=null&&M.toDate?d.createdAt.toDate().toLocaleDateString("ar-EG"):"N/A"}),e.jsxs("td",{className:"px-4 py-2 font-medium",children:[e.jsx("button",{onClick:()=>_(d),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>L(d),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},d.id)})})]})}),b.length>ne&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:u,totalPages:O,onPageChange:f})})]})]})},Me=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((h,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},s))})]}),$e="yO8pzykKincc5zgbdJGdN6xISr03",oe=10,Ue=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Be=({message:h,type:s,onClose:c})=>(t.useEffect(()=>{const n=setTimeout(c,5e3);return()=>clearTimeout(n)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Fe=({children:h,onClose:s,title:c})=>(t.useEffect(()=>{const r=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",r),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",r),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,children:e.jsxs("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 animate-zoom-in",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),h]})})),Pe=()=>{const{currentUser:h}=ye(),[s,c]=t.useState([]),[r,g]=t.useState(""),[n,u]=t.useState(""),[f,S]=t.useState(""),[E,P]=t.useState(!0),[z,B]=t.useState(!1),[I,R]=t.useState(1),[D,q]=t.useState(!1),[F,v]=t.useState(!1),[A,T]=t.useState(null),[G,N]=t.useState(null),y=(h==null?void 0:h.uid)===$e;t.useEffect(()=>{if(!y){P(!1);return}P(!0);const k=$.collection("admins").onSnapshot(_=>{const ee=_.docs.map(V=>({id:V.id,uid:V.data().uid,email:V.data().email}));c(ee),P(!1)},_=>{console.error(_),o("فشل في تحميل قائمة المشرفين.","error"),P(!1)});return()=>k()},[y]);const o=(k,_)=>{N({message:k,type:_})},i=async k=>{if(k.preventDefault(),S(""),!r.trim()||!n.trim()){S("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}B(!0);try{await $.collection("admins").doc(r).set({uid:r,email:n}),o(`تمت إضافة المشرف ${n} بنجاح.`,"success"),q(!1),g(""),u("")}catch(_){console.error("Error adding admin:",_),o("فشل في إضافة المشرف.","error")}finally{B(!1)}},p=k=>{T(k),v(!0)},j=async()=>{if(A){B(!0);try{await $.collection("admins").doc(A.id).delete(),o(`تم حذف المشرف ${A.email} بنجاح.`,"success")}catch(k){console.error(k),o("حدث خطأ أثناء حذف المشرف.","error")}finally{v(!1),T(null),B(!1)}}};if(!y)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const m=Math.ceil(s.length/oe),L=s.slice((I-1)*oe,I*oe);return e.jsxs(e.Fragment,{children:[G&&e.jsx(Be,{...G,onClose:()=>N(null)}),e.jsx(Z,{isOpen:F,onClose:()=>v(!1),onConfirm:j,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',A==null?void 0:A.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:z}),D&&e.jsx(Fe,{title:"إضافة مشرف جديد",onClose:()=>q(!1),children:e.jsxs("form",{onSubmit:i,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:r,onChange:k=>g(k.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:n,onChange:k=>u(k.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),f&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:f}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>q(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:z,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:z,children:[z&&e.jsx(Ue,{}),z?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>q(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),E?e.jsx(Me,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[h.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:L.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:k.email}),e.jsx("button",{onClick:()=>p(k),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},k.id))}),s.length>oe&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:I,totalPages:m,onPageChange:R})})]})]})]})},Te=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ze=({onSubmit:h,initialData:s,onCancel:c,isLoading:r=!1})=>{const[g,n]=t.useState("");t.useEffect(()=>{n(s?s.name:"")},[s]);const u=f=>{f.preventDefault(),g.trim()&&h({name:g})};return e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:g,onChange:f=>n(f.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:r,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:r,children:[r&&e.jsx(Te,{}),r?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},Ge=10,Le=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Ge)].map((h,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),ce=10,Oe=({message:h,type:s,onClose:c})=>(t.useEffect(()=>{const n=setTimeout(c,5e3);return()=>clearTimeout(n)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),De=({children:h,onClose:s,title:c})=>(t.useEffect(()=>{const r=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",r),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",r),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),h]})})),qe=()=>{const[h,s]=t.useState([]),[c,r]=t.useState(null),[g,n]=t.useState(!1),[u,f]=t.useState(1),[S,E]=t.useState(!1),[P,z]=t.useState(null),[B,I]=t.useState(!0),[R,D]=t.useState(!1),[q,F]=t.useState(null);t.useEffect(()=>{I(!0);const m=$.collection("categories").orderBy("name").onSnapshot(L=>{const k=L.docs.map(_=>({id:_.id,..._.data()}));s(k),I(!1)},L=>{console.error("Error fetching categories: ",L),v("فشل في تحميل الفئات.","error"),I(!1)});return()=>m()},[]);const v=(m,L)=>{F({message:m,type:L})},A=async m=>{D(!0);try{await $.collection("categories").add(m),v("تمت إضافة الفئة بنجاح!","success"),n(!1),f(1)}catch(L){console.error("Error adding category: ",L),v("حدث خطأ أثناء إضافة الفئة.","error")}finally{D(!1)}},T=async(m,L)=>{D(!0);try{await $.collection("categories").doc(m).update(L),v("تم تحديث الفئة بنجاح!","success"),r(null),n(!1)}catch(k){console.error("Error updating category: ",k),v("حدث خطأ أثناء تحديث الفئة.","error")}finally{D(!1)}},G=m=>{z(m),E(!0)},N=async()=>{if(P){D(!0);try{await $.collection("categories").doc(P.id).delete(),v("تم حذف الفئة بنجاح!","success")}catch(m){console.error("Error deleting category: ",m),v("حدث خطأ أثناء حذف الفئة.","error")}finally{E(!1),z(null),D(!1)}}},y=m=>{r(m),n(!0)},o=()=>{r(null),n(!0)},i=()=>{r(null),n(!1)},p=Math.ceil(h.length/ce),j=h.slice((u-1)*ce,u*ce);return B?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Le,{})]}):e.jsxs("div",{children:[q&&e.jsx(Oe,{...q,onClose:()=>F(null)}),e.jsx(Z,{isOpen:S,onClose:()=>E(!1),onConfirm:N,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',P==null?void 0:P.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:R}),g&&e.jsx(De,{title:c?"تعديل الفئة":"إضافة فئة جديدة",onClose:i,children:e.jsx(ze,{onSubmit:c?m=>T(c.id,m):A,initialData:c,onCancel:i,isLoading:R})}),e.jsx("button",{onClick:o,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:h.length>0?j.map(m=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:m.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>y(m),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>G(m),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},m.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),h.length>ce&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ie,{currentPage:u,totalPages:p,onPageChange:f})})]})]})},de=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(ke,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Ae,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(qe,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(Pe,{})}],Ie=({label:h,tabKey:s,activeTab:c,onClick:r})=>e.jsx("button",{onClick:()=>r(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${c===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":c===s,children:h}),Ke=()=>{var r;const[h,s]=t.useState(de[0].key),c=(r=de.find(g=>g.key===h))==null?void 0:r.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:de.map(g=>e.jsx(Ie,{label:g.label,tabKey:g.key,activeTab:h,onClick:s},g.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:c})]})};export{Ke as default};
