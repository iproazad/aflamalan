import{j as s,r as a,a as D,d as T,f as Q}from"./index-Dz2DXnM8.js";import{H as U,a as V}from"./HeroSliderSkeleton-Cr2yYshP.js";import{S as W,G as q,T as J,Y as X}from"./TagFilter-DYyTPdAf.js";import{M as Z}from"./MovieGrid-XnU7ad2l.js";import{M as $}from"./MovieGridSkeleton-eo5LrZbc.js";import{P as ee}from"./Pagination-C-vk0JvX.js";import"./useWatchLater-Bzggdk29.js";import"./MovieCardSkeleton-D_IMjcnN.js";const te=({searchQuery:n,onSearchChange:m})=>s.jsxs("div",{className:"relative w-full md:w-auto md:flex-grow",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{type:"text",value:n,onChange:h=>m(h.target.value),placeholder:"ابحث عن فيلم...",className:"w-full bg-gray-700 text-white p-2 pl-10 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none","aria-label":"Search for movies by title"})]}),y=30,de=()=>{const[n,m]=a.useState([]),[h,G]=a.useState([]),[E,x]=a.useState(!0),[o,_]=a.useState("all"),[i,w]=a.useState([]),[c,b]=a.useState([]),[d,k]=a.useState("createdAt_desc"),[u,R]=a.useState(""),[f,v]=D(),M=a.useRef(!0),g=parseInt(f.get("page")||"1",10),A=a.useCallback(e=>{const t=new URLSearchParams(f);e<=1?t.delete("page"):t.set("page",e.toString()),v(t,{replace:!0}),window.scrollTo(0,0)},[f,v]);a.useEffect(()=>{x(!0);const e=T.collection("movies").where("isKurdish","==",!0).orderBy("createdAt","desc").onSnapshot(t=>{const r=t.docs.map(l=>({id:l.id,...l.data()}));m(r),x(!1)},t=>{console.error("Error fetching Kurdish movies with real-time listener: ",t),x(!1)});return()=>e()},[]),a.useEffect(()=>{const e=T.collection("categories").orderBy("name").onSnapshot(t=>{const r=t.docs.map(l=>l.data().name);G(r)},t=>{console.error("Error fetching categories for Kurdish page: ",t)});return()=>e()},[]);const F=e=>{w(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},B=()=>{w([])},Y=e=>{b(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},z=()=>{b([])},K=[...new Set(n.map(e=>e.year))].sort((e,t)=>t-e),L=h,H=[...new Set(n.flatMap(e=>e.tags||[]))].sort(),p=a.useMemo(()=>n.filter(e=>o==="all"||e.year.toString()===o).filter(e=>i.length===0?!0:i.some(t=>{var r;return(r=e.genres)==null?void 0:r.includes(t)})).filter(e=>c.length===0?!0:c.some(t=>{var r;return(r=e.tags)==null?void 0:r.includes(t)})).filter(e=>Q(u,e.title)).sort((e,t)=>{var r,l,N,P;switch(d){case"rating_desc":return(t.imdbRating||0)-(e.imdbRating||0);case"rating_asc":return(e.imdbRating||0)-(t.imdbRating||0);case"year_desc":return t.year-e.year;case"year_asc":return e.year-t.year;case"createdAt_asc":{const S=(r=e.createdAt)!=null&&r.toMillis?e.createdAt.toMillis():0,j=(l=t.createdAt)!=null&&l.toMillis?t.createdAt.toMillis():0;return S-j}case"createdAt_desc":default:{const S=(N=t.createdAt)!=null&&N.toMillis?t.createdAt.toMillis():0,j=(P=e.createdAt)!=null&&P.toMillis?e.createdAt.toMillis():0;return S-j}}}),[n,o,i,c,u,d]);a.useEffect(()=>{if(M.current){M.current=!1;return}g!==1&&A(1)},[o,i,c,u,d]);const C=Math.ceil(p.length/y),I=p.slice((g-1)*y,g*y),O=u!==""||o!=="all"||i.length>0||c.length>0||d!=="createdAt_desc";return E?s.jsxs("div",{children:[s.jsx(U,{}),s.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"الأفلام المدبلجة للكردية"}),s.jsx($,{count:18})]})]}):s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(V,{movies:n.slice(0,5)}),s.jsxs("div",{className:"relative z-30 my-8 flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:[s.jsx(te,{searchQuery:u,onSearchChange:R}),s.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row md:flex-wrap justify-center items-center gap-4",children:[s.jsx(W,{sortOrder:d,onSortChange:k}),s.jsx(q,{genres:L,selectedGenres:i,onToggleGenre:F,onClearGenres:B}),s.jsx(J,{tags:H,selectedTags:c,onToggleTag:Y,onClearTags:z}),s.jsx(X,{years:K,selectedYear:o,onYearChange:_})]})]}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:O?"نتائج البحث":"الأفلام المدبلجة للكردية"}),p.length>0?s.jsxs(s.Fragment,{children:[s.jsx(Z,{movies:I}),C>1&&s.jsx(ee,{currentPage:g,totalPages:C,onPageChange:A})]}):s.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:s.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام مدبلجة للكردية تطابق معايير البحث."})})]})]})};export{de as default};
