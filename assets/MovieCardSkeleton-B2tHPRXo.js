import{r as g,j as i}from"./index-DLOQmAiS.js";const x="ImageCacheDB",I=1,d="images",j=1440*60*1e3;let u=null;function h(){return u||(u=new Promise((e,r)=>{if(!("indexedDB"in window)){r("IndexedDB not supported");return}const t=indexedDB.open(x,I);t.onerror=()=>{console.error("IndexedDB error:",t.error),r("Error opening IndexedDB."),u=null},t.onsuccess=()=>{e(t.result)},t.onupgradeneeded=s=>{const o=s.target.result;o.objectStoreNames.contains(d)||o.createObjectStore(d,{keyPath:"url"})}}),u)}async function y(e){try{const r=await h();return new Promise((t,s)=>{const l=r.transaction(d,"readonly").objectStore(d).get(e);l.onerror=()=>{s("Error getting image from cache.")},l.onsuccess=()=>{const n=l.result;if(n&&Date.now()-n.timestamp<j)t(n.blob);else{if(n)try{r.transaction(d,"readwrite").objectStore(d).delete(e)}catch{}t(null)}}})}catch(r){return console.error("Failed to access IndexedDB:",r),null}}async function v(e,r){try{const o=(await h()).transaction(d,"readwrite").objectStore(d),c={url:e,blob:r,timestamp:Date.now()};o.put(c)}catch(t){console.error("Failed to add image to IndexedDB cache:",t)}}const m=new Map;async function p(e){if(!e)return"";if(m.has(e))return m.get(e);let r=e;if(e.includes("@@")){let t=e.split("@@")[0];/\.(jpg|jpeg|png|gif|webp)$/i.test(t)||(t+=".jpg"),r=t}try{const t=await y(r);if(t){const a=URL.createObjectURL(t);return m.set(e,a),a}let s=!1;try{s=new URL(r).origin!==window.location.origin}catch{s=!1}const o=s?`https://corsproxy.io/?${encodeURIComponent(r)}`:r,c=await fetch(o);if(!c.ok)throw new Error(`Fetch failed with status ${c.status}`);const l=await c.blob();v(r,l.slice());const n=URL.createObjectURL(l);return m.set(e,n),n}catch(t){return console.error(`Failed to get or cache image ${e}:`,t),e}}const D=e=>{const[r,t]=g.useState(e);return g.useEffect(()=>{let s=!0;return e&&p(e).then(o=>{s&&t(o)}),()=>{s=!1}},[e]),r},E=e=>{const[r,t]=g.useState(void 0),[s,o]=g.useState(!1),c=g.useRef(null);return g.useEffect(()=>{let n;const a=c.current;let b=!0;return a&&!r&&(n=new IntersectionObserver(([f])=>{f.isIntersecting&&b&&(p(e).then(w=>{b&&t(w)}),n.unobserve(f.target))},{rootMargin:"0px 0px 200px 0px"}),n.observe(a)),()=>{b=!1,n&&a&&n.unobserve(a)}},[e,r]),{imageRef:c,imageSrc:r,isLoaded:s,handleImageLoad:()=>{o(!0)}}},B=()=>i.jsxs("div",{className:"block group relative rounded-lg overflow-hidden shadow-lg bg-gray-800 animate-pulse",children:[i.jsx("div",{className:"relative w-full aspect-[2/3] bg-gray-700"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4",children:[i.jsx("div",{className:"h-5 bg-gray-600 rounded w-3/4 mb-2"}),i.jsxs("div",{className:"flex justify-between items-center mt-1",children:[i.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"}),i.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})]})]})]});export{B as M,E as a,D as u};
