import{r as a,u as W,d as P,f as X,j as t}from"./index-kFYueowS.js";import{H as Z,a as ee}from"./HeroSliderSkeleton-D-1-Pnor.js";import{M}from"./MoviesCarousel-qB3kRWax.js";import{S as te,G as se,T as re,Y as ae}from"./TagFilter-BxT8GB2F.js";import{u as le}from"./useWatchLater-CgXFzuwf.js";import{M as ne}from"./MovieGrid-DMp3mr1R.js";import{M as oe}from"./MovieGridSkeleton-DwhbeYRj.js";import{M as S}from"./MoviesCarouselSkeleton-gK2w2uNY.js";import{P as ie}from"./Pagination-Cvsy5mpD.js";import"./MovieCardSkeleton-BY8tq7Fw.js";const N=28,ve=()=>{const[o,_]=a.useState([]),[Y,B]=a.useState([]),[H,z]=a.useState(!0),[n,h]=a.useState("all"),[i,p]=a.useState([]),[c,y]=a.useState([]),[u,O]=a.useState("createdAt_desc"),[m,A]=a.useState(""),{currentUser:C}=W(),{favorites:$}=le(),[v,w]=a.useState(1);a.useEffect(()=>{(async()=>{try{const d=(await P.collection("movies").get()).docs.map(l=>({id:l.id,...l.data()})).filter(l=>l.isKurdish!==!0);d.sort((l,x)=>{var E,F;const g=(E=l.createdAt)!=null&&E.toMillis?l.createdAt.toMillis():0;return((F=x.createdAt)!=null&&F.toMillis?x.createdAt.toMillis():0)-g}),_(d)}catch(s){console.error("Error fetching movies: ",s)}finally{z(!1)}})()},[]),a.useEffect(()=>{const e=P.collection("categories").orderBy("name").onSnapshot(s=>{const r=s.docs.map(d=>d.data().name);B(r)},s=>{console.error("Error fetching categories: ",s)});return()=>e()},[]);const T=e=>{p(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},K=()=>{p([])},G=e=>{y(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},Q=()=>{y([])},q=()=>{A(""),h("all"),p([]),y([])},R=o.filter(e=>$.includes(e.id)),D=o.slice(0,15),I=[...o].sort((e,s)=>(s.imdbRating||0)-(e.imdbRating||0)).slice(0,15),L=[...new Set(o.map(e=>e.year))].sort((e,s)=>s-e),U=Y,V=[...new Set(o.flatMap(e=>e.tags||[]))].sort(),b=a.useMemo(()=>o.filter(e=>n==="all"||e.year.toString()===n).filter(e=>i.length===0?!0:i.some(s=>{var r;return(r=e.genres)==null?void 0:r.includes(s)})).filter(e=>c.length===0?!0:c.some(s=>{var r;return(r=e.tags)==null?void 0:r.includes(s)})).filter(e=>X(m,e.title)).sort((e,s)=>{var r,d,l,x;switch(u){case"rating_desc":return(s.imdbRating||0)-(e.imdbRating||0);case"rating_asc":return(e.imdbRating||0)-(s.imdbRating||0);case"year_desc":return s.year-e.year;case"year_asc":return e.year-s.year;case"createdAt_asc":{const g=(r=e.createdAt)!=null&&r.toMillis?Number(e.createdAt.toMillis()):0,f=(d=s.createdAt)!=null&&d.toMillis?Number(s.createdAt.toMillis()):0;return g-f}case"createdAt_desc":default:{const g=(l=s.createdAt)!=null&&l.toMillis?Number(s.createdAt.toMillis()):0,f=(x=e.createdAt)!=null&&x.toMillis?Number(e.createdAt.toMillis()):0;return g-f}}}),[o,n,i,c,m,u]);a.useEffect(()=>{w(1)},[n,i,c,m,u]);const k=Math.ceil(b.length/N),J=b.slice((v-1)*N,v*N),j=m!==""||n!=="all"||i.length>0||c.length>0;return H?t.jsxs("div",{children:[t.jsx(Z,{}),t.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),C&&t.jsx(S,{title:"المفضلة"}),t.jsx(S,{title:"أحدث الإضافات"}),t.jsx(S,{title:"الأعلى تقييماً"}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"تصفح الكل"}),t.jsx(oe,{count:18})]})]}):t.jsxs("div",{children:[t.jsx(ee,{movies:o.slice(0,5)}),t.jsx("div",{className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:t.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[t.jsx(te,{sortOrder:u,onSortChange:O}),t.jsx(se,{genres:U,selectedGenres:i,onToggleGenre:T,onClearGenres:K}),t.jsx(re,{tags:V,selectedTags:c,onToggleTag:G,onClearTags:Q}),t.jsx(ae,{years:L,selectedYear:n,onYearChange:h})]})}),j&&t.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-gray-800/50 p-3 animate-fade-in-down",children:[t.jsx("span",{className:"font-bold text-gray-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[m&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-yellow-900/50 px-3 py-1 text-sm text-yellow-300",children:['بحث: "',m,'"',t.jsx("button",{onClick:()=>A(""),className:"text-yellow-400 hover:text-white text-lg leading-none font-bold","aria-label":"Clear search query",children:"×"})]}),n!=="all"&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",n,t.jsx("button",{onClick:()=>h("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${n}`,children:"×"})]}),i.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[e,t.jsx("button",{onClick:()=>T(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${e}`,children:"×"})]},e)),c.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",e,t.jsx("button",{onClick:()=>G(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${e}`,children:"×"})]},e))]}),t.jsx("button",{onClick:q,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),!j&&t.jsxs(t.Fragment,{children:[C&&R.length>0&&t.jsx(M,{title:"المفضلة",movies:R}),t.jsx(M,{title:"أحدث الإضافات",movies:D}),t.jsx(M,{title:"الأعلى تقييماً",movies:I})]}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:j?"نتائج البحث":"تصفح الكل"}),b.length>0?t.jsxs(t.Fragment,{children:[t.jsx(ne,{movies:J}),k>1&&t.jsx(ie,{currentPage:v,totalPages:k,onPageChange:w})]}):t.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:t.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام تطابق معايير البحث."})})]})]})};export{ve as default};
