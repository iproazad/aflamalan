import{a as G,j as t,r as l,d as M}from"./index-C75TUr8p.js";import{S as B,G as O,T as z,Y as D}from"./TagFilter-DnMzgv_6.js";import{M as I}from"./MovieGridSkeleton-hr9AzoTZ.js";import{P as q}from"./Pagination-Cc511sZ2.js";import{u as H,a as J,S as K}from"./SeriesCard-BDewjnKp.js";import"./MovieCardSkeleton-CqgWkuat.js";const Q=({series:o})=>{const{isFavoriteSeries:x,toggleFavoriteSeries:u}=H(),{isWatchLaterSeries:h,toggleWatchLaterSeries:f}=J(),{getAverageRating:p}=G();return t.jsx("div",{className:"[column-count:2] sm:[column-count:3] md:[column-count:4] lg:[column-count:5] xl:[column-count:6] gap-4 md:gap-6",children:o.map(r=>{const{average:d,count:n}=p(r.id);return t.jsx("div",{className:"break-inside-avoid mb-4 md:mb-6",children:t.jsx(K,{series:r,isFavorite:x(r.id),isWatchLater:h(r.id),averageRating:d,ratingCount:n,onToggleFavorite:u,onToggleWatchLater:f})},r.id)})})},y=28,se=()=>{const[o,x]=l.useState([]),[u,h]=l.useState([]),[f,p]=l.useState(!0),[r,d]=l.useState("all"),[n,S]=l.useState([]),[i,j]=l.useState([]),[m,k]=l.useState("createdAt_desc"),{getAverageRating:g}=G(),[b,N]=l.useState(1);l.useEffect(()=>{(async()=>{try{const a=(await M.collection("series").orderBy("createdAt","desc").get()).docs.map(c=>({id:c.id,...c.data()}));x(a)}catch(s){console.error("Error fetching series: ",s)}finally{p(!1)}})()},[]),l.useEffect(()=>{const e=M.collection("categories").orderBy("name").onSnapshot(s=>{const a=s.docs.map(c=>c.data().name);h(a)},s=>{console.error("Error fetching categories: ",s)});return()=>e()},[]);const C=e=>S(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e]),E=()=>S([]),A=e=>j(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e]),R=()=>j([]),P=()=>{d("all"),S([]),j([])},_=[...new Set(o.map(e=>e.year))].sort((e,s)=>s-e),L=u,Y=[...new Set(o.flatMap(e=>e.tags||[]))].sort(),v=l.useMemo(()=>o.filter(e=>r==="all"||e.year.toString()===r).filter(e=>n.length===0||n.some(s=>{var a;return(a=e.genres)==null?void 0:a.includes(s)})).filter(e=>i.length===0||i.some(s=>{var a;return(a=e.tags)==null?void 0:a.includes(s)})).sort((e,s)=>{var a,c,T,F;switch(m){case"rating_desc":return g(s.id).average-g(e.id).average;case"rating_asc":return g(e.id).average-g(s.id).average;case"year_desc":return s.year-e.year;case"year_asc":return e.year-s.year;case"createdAt_asc":return((a=e.createdAt)!=null&&a.toMillis?e.createdAt.toMillis():0)-((c=s.createdAt)!=null&&c.toMillis?s.createdAt.toMillis():0);case"createdAt_desc":default:return((T=s.createdAt)!=null&&T.toMillis?s.createdAt.toMillis():0)-((F=e.createdAt)!=null&&F.toMillis?e.createdAt.toMillis():0)}}),[o,r,n,i,m,g]);l.useEffect(()=>{N(1)},[r,n,i,m]);const w=Math.ceil(v.length/y),W=v.slice((b-1)*y,b*y),$=r!=="all"||n.length>0||i.length>0;return f?t.jsxs("div",{className:"animate-fade-in",children:[t.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"تصفح المسلسلات"}),t.jsx("div",{className:"my-8 h-20 bg-slate-800/50 rounded-lg animate-pulse"}),t.jsx(I,{count:18})]}):t.jsxs("div",{className:"animate-fade-in",children:[t.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"تصفح المسلسلات"}),t.jsx("div",{className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:t.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[t.jsx(B,{sortOrder:m,onSortChange:k}),t.jsx(O,{genres:L,selectedGenres:n,onToggleGenre:C,onClearGenres:E}),t.jsx(z,{tags:Y,selectedTags:i,onToggleTag:A,onClearTags:R}),t.jsx(D,{years:_,selectedYear:r,onYearChange:d})]})}),$&&t.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-slate-800/50 p-3 animate-fade-in-down",children:[t.jsx("span",{className:"font-bold text-slate-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[r!=="all"&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",r,t.jsx("button",{onClick:()=>d("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${r}`,children:"×"})]}),n.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[e,t.jsx("button",{onClick:()=>C(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${e}`,children:"×"})]},e)),i.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",e,t.jsx("button",{onClick:()=>A(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${e}`,children:"×"})]},e))]}),t.jsx("button",{onClick:P,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),t.jsx("section",{className:"mb-12",children:v.length>0?t.jsxs(t.Fragment,{children:[t.jsx(Q,{series:W}),w>1&&t.jsx(q,{currentPage:b,totalPages:w,onPageChange:N})]}):t.jsx("div",{className:"text-center p-8 bg-slate-800 rounded-lg mt-8",children:t.jsx("p",{className:"text-xl text-slate-400",children:"لا توجد مسلسلات تطابق معايير البحث."})})})]})};export{se as default};
