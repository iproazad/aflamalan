import{j as s,r as o,d as T,f as z}from"./index-Dh8Pkb-q.js";import{H as L,a as J}from"./HeroSliderSkeleton-B2kv5g69.js";import{S as Q,G as U,T as V,Y as W}from"./TagFilter-Cu3eC4bF.js";import{M as q}from"./MovieGrid-CLmviSHu.js";import{M as X}from"./MovieGridSkeleton-B5NCI3A8.js";import{P as Z}from"./Pagination-o_qdMaqX.js";import"./useWatchLater-BiQ9AbZF.js";import"./MovieCardSkeleton-mlncPtAb.js";const $=({searchQuery:l,onSearchChange:h})=>s.jsxs("div",{className:"relative w-full md:w-auto md:flex-grow",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{type:"text",value:l,onChange:p=>h(p.target.value),placeholder:"ابحث عن فيلم...",className:"w-full bg-gray-700 text-white p-2 pl-10 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none","aria-label":"Search for movies by title"})]}),y=28,j="cached_kurdish_movies",ee=900*1e3,ce=()=>{const[l,h]=o.useState([]),[p,E]=o.useState([]),[_,w]=o.useState(!0),[n,G]=o.useState("all"),[i,M]=o.useState([]),[c,A]=o.useState([]),[m,P]=o.useState("createdAt_desc"),[g,k]=o.useState(""),[S,b]=o.useState(1);o.useEffect(()=>{(async()=>{try{const e=localStorage.getItem(j);if(e){const{data:r,timestamp:a}=JSON.parse(e);if(new Date().getTime()-a<ee){h(r),w(!1);return}}}catch(e){console.error("Error reading from Kurdish movie cache",e),localStorage.removeItem(j)}try{let r=(await T.collection("movies").where("isKurdish","==",!0).get()).docs.map(a=>({id:a.id,...a.data()}));r.sort((a,u)=>{var d,N;const f=(d=a.createdAt)!=null&&d.toMillis?a.createdAt.toMillis():0;return((N=u.createdAt)!=null&&N.toMillis?u.createdAt.toMillis():0)-f}),h(r);try{const a={data:r,timestamp:new Date().getTime()};localStorage.setItem(j,JSON.stringify(a))}catch(a){console.error("Error writing to Kurdish movie cache",a)}}catch(e){console.error("Error fetching movies: ",e)}finally{w(!1)}})()},[]),o.useEffect(()=>{const t=T.collection("categories").orderBy("name").onSnapshot(e=>{const r=e.docs.map(a=>a.data().name);E(r)},e=>{console.error("Error fetching categories for Kurdish page: ",e)});return()=>t()},[]);const B=t=>{M(e=>e.includes(t)?e.filter(r=>r!==t):[...e,t])},F=()=>{M([])},I=t=>{A(e=>e.includes(t)?e.filter(r=>r!==t):[...e,t])},R=()=>{A([])},Y=[...new Set(l.map(t=>t.year))].sort((t,e)=>e-t),K=p,O=[...new Set(l.flatMap(t=>t.tags||[]))].sort(),v=o.useMemo(()=>l.filter(t=>n==="all"||t.year.toString()===n).filter(t=>i.length===0?!0:i.some(e=>{var r;return(r=t.genres)==null?void 0:r.includes(e)})).filter(t=>c.length===0?!0:c.some(e=>{var r;return(r=t.tags)==null?void 0:r.includes(e)})).filter(t=>z(g,t.title)).sort((t,e)=>{var r,a,u,f;switch(m){case"rating_desc":return(e.imdbRating||0)-(t.imdbRating||0);case"rating_asc":return(t.imdbRating||0)-(e.imdbRating||0);case"year_desc":return e.year-t.year;case"year_asc":return t.year-e.year;case"createdAt_asc":{const x=(r=t.createdAt)!=null&&r.toMillis?t.createdAt.toMillis():0,d=(a=e.createdAt)!=null&&a.toMillis?e.createdAt.toMillis():0;return x-d}case"createdAt_desc":default:{const x=(u=e.createdAt)!=null&&u.toMillis?e.createdAt.toMillis():0,d=(f=t.createdAt)!=null&&f.toMillis?t.createdAt.toMillis():0;return x-d}}}),[l,n,i,c,g,m]);o.useEffect(()=>{b(1)},[n,i,c,g,m]);const C=Math.ceil(v.length/y),D=v.slice((S-1)*y,S*y),H=g!==""||n!=="all"||i.length>0||c.length>0||m!=="createdAt_desc";return _?s.jsxs("div",{children:[s.jsx(L,{}),s.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"الأفلام المدبلجة للكردية"}),s.jsx(X,{count:18})]})]}):s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(J,{movies:l.slice(0,5)}),s.jsxs("div",{className:"relative z-30 my-8 flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:[s.jsx($,{searchQuery:g,onSearchChange:k}),s.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row md:flex-wrap justify-center items-center gap-4",children:[s.jsx(Q,{sortOrder:m,onSortChange:P}),s.jsx(U,{genres:K,selectedGenres:i,onToggleGenre:B,onClearGenres:F}),s.jsx(V,{tags:O,selectedTags:c,onToggleTag:I,onClearTags:R}),s.jsx(W,{years:Y,selectedYear:n,onYearChange:G})]})]}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:H?"نتائج البحث":"الأفلام المدبلجة للكردية"}),v.length>0?s.jsxs(s.Fragment,{children:[s.jsx(q,{movies:D}),C>1&&s.jsx(Z,{currentPage:S,totalPages:C,onPageChange:b})]}):s.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:s.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام مدبلجة للكردية تطابق معايير البحث."})})]})]})};export{ce as default};
