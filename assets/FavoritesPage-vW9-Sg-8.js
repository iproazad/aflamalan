import{r as n,j as s,e as L,L as J}from"./index-DHK5cvRJ.js";import{u as Q}from"./useWatchLater-BcOOIyUy.js";import{u as V,a as X,R as Y}from"./ResumeFromModal-q3WC36pm.js";import{M as ee}from"./MovieGridSkeleton-DB659YRz.js";import{M as te}from"./MovieGrid-DNh_sAbN.js";import{S as se}from"./SeriesGrid-jwrBYdZO.js";import{P as ae}from"./Pagination-Cb39dPnj.js";import"./MovieCardSkeleton-DdmktY3e.js";import"./SpinnerIcon-rVrOQveZ.js";const E=28,he=()=>{const[p,F]=n.useState([]),[S,K]=n.useState([]),[_,T]=n.useState(!0),{favorites:A}=Q(),{favoriteSeries:D}=V(),{addWatchLaterSeries:R,removeWatchLaterSeries:W,isWatchLaterSeries:H,getWatchLaterInfo:P,loading:U}=X(),[c,Z]=n.useState("movies"),[x,k]=n.useState(1),[v,j]=n.useState(null);n.useEffect(()=>{(async()=>{T(!0);const a=async()=>{const r=A.filter(o=>typeof o=="string"&&o.trim()!=="");if(r.length===0)return[];try{const d=[];for(let t=0;t<r.length;t+=30)d.push(r.slice(t,t+30));const y=d.map(t=>L.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",t).get()),m=(await Promise.all(y)).flatMap(t=>t.docs.map(i=>({id:i.id,...i.data()})));return m.sort((t,i)=>{var g,f;const u=(g=t.createdAt)!=null&&g.toDate?t.createdAt.toDate().getTime():new Date(t.createdAt).getTime(),h=(f=i.createdAt)!=null&&f.toDate?i.createdAt.toDate().getTime():new Date(i.createdAt).getTime();return(isNaN(h)?0:h)-(isNaN(u)?0:u)}),m}catch(o){return console.error("Error fetching favorite movies: ",o),[]}},l=async()=>{const r=D.filter(o=>typeof o=="string"&&o.trim()!=="");if(r.length===0)return[];try{const d=[];for(let t=0;t<r.length;t+=30)d.push(r.slice(t,t+30));const y=d.map(t=>L.collection("series").where(window.firebase.firestore.FieldPath.documentId(),"in",t).get()),m=(await Promise.all(y)).flatMap(t=>t.docs.map(i=>({id:i.id,...i.data()})));return m.sort((t,i)=>{var g,f;const u=(g=t.createdAt)!=null&&g.toDate?t.createdAt.toDate().getTime():new Date(t.createdAt).getTime(),h=(f=i.createdAt)!=null&&f.toDate?i.createdAt.toDate().getTime():new Date(i.createdAt).getTime();return(isNaN(h)?0:h)-(isNaN(u)?0:u)}),m}catch(o){return console.error("Error fetching favorite series: ",o),[]}};try{const[r,o]=await Promise.all([a(),l()]);F(r),K(o)}catch(r){console.error("Error fetching all favorite content:",r)}finally{T(!1)}})()},[A,D]),n.useEffect(()=>{k(1)},[c]);const G=e=>{H(e.id)?W(e.id):j(e)},B=(e,a)=>{v&&R(v.id,e,a),j(null)},N=n.useMemo(()=>p.filter(e=>!e.isKurdish),[p]),M=n.useMemo(()=>p.filter(e=>e.isKurdish),[p]),{paginatedItems:b,totalPages:C,totalItems:$}=n.useMemo(()=>{let e=[];c==="movies"&&(e=N),c==="kurdish"&&(e=M),c==="series"&&(e=S);const a=Math.ceil(e.length/E);return{paginatedItems:e.slice((x-1)*E,x*E),totalPages:a,totalItems:e.length}},[c,x,N,M,S]),O=n.useMemo(()=>new Map(b.map(e=>{const a=P(e.id);return[e.id,a?{season:a.season,episode:a.episode}:null]})),[b,P]),I=({tab:e,label:a,count:l})=>s.jsxs("button",{onClick:()=>Z(e),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${c===e?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":c===e,children:[a,s.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${c===e?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:l})]}),w=({message:e,subMessage:a,buttonText:l,link:r})=>s.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[s.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:e}),s.jsx("p",{className:"text-slate-400 mb-6",children:a}),s.jsx(J,{to:r,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:l})]}),q=()=>{if($>0)return s.jsxs(s.Fragment,{children:[c==="series"?s.jsx(se,{series:b,onToggleWatchLater:G,watchLaterInfoMap:O}):s.jsx(te,{movies:b}),C>1&&s.jsx(ae,{currentPage:x,totalPages:C,onPageChange:k})]});switch(c){case"movies":return s.jsx(w,{message:"قائمة أفلامك المفضلة فارغة.",subMessage:"أضف أفلامًا إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return s.jsx(w,{message:"قائمة الأفلام الكردية المفضلة فارغة.",subMessage:"أضف أفلامًا كردية إلى مفضلتك.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return s.jsx(w,{message:"قائمة مسلسلاتك المفضلة فارغة.",subMessage:"أضف مسلسلات إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(Y,{isOpen:!!v,onClose:()=>j(null),series:v,onSave:B,isSaving:U}),s.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمتي المفضلة"}),s.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[s.jsx(I,{tab:"movies",label:"أفلام",count:N.length}),s.jsx(I,{tab:"kurdish",label:"كردي",count:M.length}),s.jsx(I,{tab:"series",label:"مسلسلات",count:S.length})]}),_?s.jsx(ee,{count:12}):s.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:q()})]})};export{he as default};
