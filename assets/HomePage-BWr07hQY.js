import{u as q,r,a as J,b as K,f as L,j as t}from"./index-DHK5cvRJ.js";import{H as W,a as X}from"./HeroSliderSkeleton-DLHk6CdY.js";import{M as v}from"./MoviesCarousel-D9kZu337.js";import{S as Z,G as ee,T as te,Y as se}from"./TagFilter-CcIO8nam.js";import{u as re}from"./useWatchLater-BcOOIyUy.js";import{M as ae}from"./MovieGrid-DNh_sAbN.js";import{M as le}from"./MovieGridSkeleton-DB659YRz.js";import{M as N}from"./MoviesCarouselSkeleton-CcFnSW-L.js";import{P as ne}from"./Pagination-Cb39dPnj.js";import"./MovieCardSkeleton-DdmktY3e.js";const S=28,pe=()=>{const{movies:a,categories:_,loading:E}=q(),[n,x]=r.useState("all"),[o,g]=r.useState([]),[i,u]=r.useState([]),[f,Y]=r.useState("createdAt_desc"),[c,h]=r.useState(""),{currentUser:w}=J(),{favorites:M}=re(),[A]=K(),p=r.useRef(null),[b,T]=r.useState(1),C=e=>{g(s=>s.includes(e)?s.filter(l=>l!==e):[...s,e])},H=()=>{g([])},D=e=>{u(s=>s.includes(e)?s.filter(l=>l!==e):[...s,e])},z=()=>{u([])},B=()=>{h(""),x("all"),g([]),u([]),p.current=null},G=r.useMemo(()=>a.filter(e=>M.includes(e.id)),[a,M]),I=r.useMemo(()=>a.slice(0,15),[a]),O=r.useMemo(()=>[...a].sort((e,s)=>Number(s.imdbRating||0)-Number(e.imdbRating||0)).slice(0,15),[a]),U=r.useMemo(()=>[...new Set(a.map(e=>e.year))].sort((e,s)=>s-e),[a]),$=_,Q=r.useMemo(()=>[...new Set(a.flatMap(e=>e.tags||[]))].sort(),[a]),j=r.useMemo(()=>a.filter(e=>n==="all"||e.year.toString()===n).filter(e=>o.length===0?!0:o.some(s=>{var l;return(l=e.genres)==null?void 0:l.includes(s)})).filter(e=>i.length===0?!0:i.some(s=>{var l;return(l=e.tags)==null?void 0:l.includes(s)})).filter(e=>L(c,e.title)).sort((e,s)=>{var l,k,F,P;switch(f){case"rating_desc":return Number(s.imdbRating||0)-Number(e.imdbRating||0);case"rating_asc":return Number(e.imdbRating||0)-Number(s.imdbRating||0);case"year_desc":return s.year-e.year;case"year_asc":return e.year-s.year;case"createdAt_asc":{const d=(l=e.createdAt)!=null&&l.toDate?e.createdAt.toDate().getTime():new Date(e.createdAt).getTime(),m=(k=s.createdAt)!=null&&k.toDate?s.createdAt.toDate().getTime():new Date(s.createdAt).getTime();return(isNaN(d)?0:d)-(isNaN(m)?0:m)}case"createdAt_desc":default:{const d=(F=e.createdAt)!=null&&F.toDate?e.createdAt.toDate().getTime():new Date(e.createdAt).getTime(),m=(P=s.createdAt)!=null&&P.toDate?s.createdAt.toDate().getTime():new Date(s.createdAt).getTime();return(isNaN(m)?0:m)-(isNaN(d)?0:d)}}}),[a,n,o,i,c,f]);r.useEffect(()=>{T(1)},[n,o,i,c,f]),r.useEffect(()=>{var s;const e=A.get("genre");e&&e!==p.current&&(h(""),x("all"),u([]),g([e]),p.current=e,(s=document.getElementById("filters-section"))==null||s.scrollIntoView({behavior:"smooth",block:"start"}))},[A]);const R=Math.ceil(j.length/S),V=j.slice((b-1)*S,b*S),y=c!==""||n!=="all"||o.length>0||i.length>0;return E?t.jsxs("div",{children:[t.jsx(W,{}),t.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),w&&t.jsx(N,{title:"المفضلة"}),t.jsx(N,{title:"أحدث الإضافات"}),t.jsx(N,{title:"الأعلى تقييماً"}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"تصفح الكل"}),t.jsx(le,{count:18})]})]}):t.jsxs("div",{className:"animate-fade-in",children:[t.jsx(X,{movies:a.slice(0,5)}),t.jsx("div",{id:"filters-section",className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl scroll-mt-20",children:t.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[t.jsx(Z,{sortOrder:f,onSortChange:Y}),t.jsx(ee,{genres:$,selectedGenres:o,onToggleGenre:C,onClearGenres:H}),t.jsx(te,{tags:Q,selectedTags:i,onToggleTag:D,onClearTags:z}),t.jsx(se,{years:U,selectedYear:n,onYearChange:x})]})}),y&&t.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-gray-800/50 p-3 animate-fade-in-down",children:[t.jsx("span",{className:"font-bold text-gray-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[c&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-yellow-900/50 px-3 py-1 text-sm text-yellow-300",children:['بحث: "',c,'"',t.jsx("button",{onClick:()=>h(""),className:"text-yellow-400 hover:text-white text-lg leading-none font-bold","aria-label":"Clear search query",children:"×"})]}),n!=="all"&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",n,t.jsx("button",{onClick:()=>x("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${n}`,children:"×"})]}),o.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[e,t.jsx("button",{onClick:()=>C(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${e}`,children:"×"})]},e)),i.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",e,t.jsx("button",{onClick:()=>D(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${e}`,children:"×"})]},e))]}),t.jsx("button",{onClick:B,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),!y&&t.jsxs(t.Fragment,{children:[w&&G.length>0&&t.jsx(v,{title:"المفضلة",movies:G}),t.jsx(v,{title:"أحدث الإضافات",movies:I}),t.jsx(v,{title:"الأعلى تقييماً",movies:O})]}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:y?"نتائج البحث":"تصفح الكل"}),j.length>0?t.jsxs(t.Fragment,{children:[t.jsx(ae,{movies:V}),R>1&&t.jsx(ne,{currentPage:b,totalPages:R,onPageChange:T})]}):t.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:t.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام تطابق معايير البحث."})})]})]})};export{pe as default};
