import{u as H,r,j as a}from"./index-DHK5cvRJ.js";import{S as J,G as K,T as Q,Y as U}from"./TagFilter-CcIO8nam.js";import{M as V}from"./MovieGridSkeleton-DB659YRz.js";import{P as X}from"./Pagination-Cb39dPnj.js";import{S as Z}from"./SeriesGrid-jwrBYdZO.js";import{a as ee,R as te}from"./ResumeFromModal-q3WC36pm.js";import"./MovieCardSkeleton-DdmktY3e.js";import"./SpinnerIcon-rVrOQveZ.js";const N=28,de=()=>{const{series:o,categories:D,loading:G}=H(),[n,x]=r.useState("all"),[l,u]=r.useState([]),[i,h]=r.useState([]),[m,F]=r.useState("createdAt_desc"),[f,S]=r.useState(1),{addWatchLaterSeries:M,removeWatchLaterSeries:k,isWatchLaterSeries:L,getWatchLaterInfo:y,loading:P}=ee(),[g,p]=r.useState(null),T=e=>u(t=>t.includes(e)?t.filter(s=>s!==e):[...t,e]),_=()=>u([]),w=e=>h(t=>t.includes(e)?t.filter(s=>s!==e):[...t,e]),E=()=>h([]),W=()=>{x("all"),u([]),h([])},Y=e=>{L(e.id)?k(e.id):p(e)},O=(e,t)=>{g&&M(g.id,e,t),p(null)},$=r.useMemo(()=>[...new Set(o.map(e=>e.year))].sort((e,t)=>t-e),[o]),B=D,z=r.useMemo(()=>[...new Set(o.flatMap(e=>e.tags||[]))].sort(),[o]),b=r.useMemo(()=>o.filter(e=>n==="all"||e.year.toString()===n).filter(e=>l.length===0||l.some(t=>{var s;return(s=e.genres)==null?void 0:s.includes(t)})).filter(e=>i.length===0||i.some(t=>{var s;return(s=e.tags)==null?void 0:s.includes(t)})).sort((e,t)=>{var s,A,R,C;switch(m){case"rating_desc":return Number(t.imdbRating||0)-Number(e.imdbRating||0);case"rating_asc":return Number(e.imdbRating||0)-Number(t.imdbRating||0);case"year_desc":return t.year-e.year;case"year_asc":return e.year-t.year;case"createdAt_asc":{const c=(s=e.createdAt)!=null&&s.toDate?e.createdAt.toDate().getTime():new Date(e.createdAt).getTime(),d=(A=t.createdAt)!=null&&A.toDate?t.createdAt.toDate().getTime():new Date(t.createdAt).getTime();return(isNaN(c)?0:c)-(isNaN(d)?0:d)}case"createdAt_desc":default:{const c=(R=e.createdAt)!=null&&R.toDate?e.createdAt.toDate().getTime():new Date(e.createdAt).getTime(),d=(C=t.createdAt)!=null&&C.toDate?t.createdAt.toDate().getTime():new Date(t.createdAt).getTime();return(isNaN(d)?0:d)-(isNaN(c)?0:c)}}}),[o,n,l,i,m]);r.useEffect(()=>{S(1)},[n,l,i,m]);const v=Math.ceil(b.length/N),j=b.slice((f-1)*N,f*N),I=n!=="all"||l.length>0||i.length>0,q=r.useMemo(()=>new Map(j.map(e=>{const t=y(e.id);return[e.id,t?{season:t.season,episode:t.episode}:null]})),[j,y]);return G?a.jsxs("div",{className:"animate-fade-in",children:[a.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"تصفح المسلسلات"}),a.jsx("div",{className:"my-8 h-20 bg-slate-800/50 rounded-lg animate-pulse"}),a.jsx(V,{count:18})]}):a.jsxs("div",{className:"animate-fade-in",children:[a.jsx(te,{isOpen:!!g,onClose:()=>p(null),series:g,onSave:O,isSaving:P}),a.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"تصفح المسلسلات"}),a.jsx("div",{className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:a.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[a.jsx(J,{sortOrder:m,onSortChange:F}),a.jsx(K,{genres:B,selectedGenres:l,onToggleGenre:T,onClearGenres:_}),a.jsx(Q,{tags:z,selectedTags:i,onToggleTag:w,onClearTags:E}),a.jsx(U,{years:$,selectedYear:n,onYearChange:x})]})}),I&&a.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-slate-800/50 p-3 animate-fade-in-down",children:[a.jsx("span",{className:"font-bold text-slate-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[n!=="all"&&a.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",n,a.jsx("button",{onClick:()=>x("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${n}`,children:"×"})]}),l.map(e=>a.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[e,a.jsx("button",{onClick:()=>T(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${e}`,children:"×"})]},e)),i.map(e=>a.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",e,a.jsx("button",{onClick:()=>w(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${e}`,children:"×"})]},e))]}),a.jsx("button",{onClick:W,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),a.jsx("section",{className:"mb-12",children:b.length>0?a.jsxs(a.Fragment,{children:[a.jsx(Z,{series:j,onToggleWatchLater:Y,watchLaterInfoMap:q}),v>1&&a.jsx(X,{currentPage:f,totalPages:v,onPageChange:S})]}):a.jsx("div",{className:"text-center p-8 bg-slate-800 rounded-lg mt-8",children:a.jsx("p",{className:"text-xl text-slate-400",children:"لا توجد مسلسلات تطابق معايير البحث."})})})]})};export{de as default};
