import{r as u,j as c}from"./index-BwkEdhce.js";const x="ImageCacheDB",I=1,i="images",y=1440*60*1e3;let g=null;function h(){return g||(g=new Promise((e,t)=>{if(!("indexedDB"in window)){t("IndexedDB not supported");return}const r=indexedDB.open(x,I);r.onerror=()=>{console.error("IndexedDB error:",r.error),t("Error opening IndexedDB."),g=null},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=s=>{const n=s.target.result;n.objectStoreNames.contains(i)||n.createObjectStore(i,{keyPath:"url"})}}),g)}async function v(e){try{const t=await h();return new Promise((r,s)=>{const d=t.transaction(i,"readonly").objectStore(i).get(e);d.onerror=()=>{s("Error getting image from cache.")},d.onsuccess=()=>{const o=d.result;if(o&&Date.now()-o.timestamp<y)r(o.blob);else{if(o)try{t.transaction(i,"readwrite").objectStore(i).delete(e)}catch{}r(null)}}})}catch(t){return console.error("Failed to access IndexedDB:",t),null}}async function j(e,t){try{const n=(await h()).transaction(i,"readwrite").objectStore(i),a={url:e,blob:t,timestamp:Date.now()};n.put(a)}catch(r){console.error("Failed to add image to IndexedDB cache:",r)}}const m=new Map;async function w(e){if(!e)return"";if(m.has(e))return m.get(e);try{const t=await v(e);if(t){const o=URL.createObjectURL(t);return m.set(e,o),o}let r=!1;try{r=new URL(e).origin!==window.location.origin}catch{r=!1}const s=r?`https://corsproxy.io/?${encodeURIComponent(e)}`:e,n=await fetch(s);if(!n.ok)throw new Error(`Fetch failed with status ${n.status}`);const a=await n.blob();j(e,a.slice());const d=URL.createObjectURL(a);return m.set(e,d),d}catch(t){return console.error(`Failed to get or cache image ${e}:`,t),e}}const D=e=>{const[t,r]=u.useState(e);return u.useEffect(()=>{let s=!0;return e&&w(e).then(n=>{s&&r(n)}),()=>{s=!1}},[e]),t},B=e=>{const[t,r]=u.useState(void 0),[s,n]=u.useState(!1),a=u.useRef(null);return u.useEffect(()=>{let o;const l=a.current;let b=!0;return l&&!t&&(o=new IntersectionObserver(([f])=>{f.isIntersecting&&b&&(w(e).then(p=>{b&&r(p)}),o.unobserve(f.target))},{rootMargin:"0px 0px 200px 0px"}),o.observe(l)),()=>{b=!1,o&&l&&o.unobserve(l)}},[e,t]),{imageRef:a,imageSrc:t,isLoaded:s,handleImageLoad:()=>{n(!0)}}},N=()=>c.jsxs("div",{className:"block group relative rounded-lg overflow-hidden shadow-lg bg-gray-800 animate-pulse",children:[c.jsx("div",{className:"relative w-full aspect-[2/3] bg-gray-700"}),c.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4",children:[c.jsx("div",{className:"h-5 bg-gray-600 rounded w-3/4 mb-2"}),c.jsxs("div",{className:"flex justify-between items-center mt-1",children:[c.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"}),c.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})]})]})]});export{N as M,B as a,D as u};
