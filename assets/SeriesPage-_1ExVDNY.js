import{j as t,r,d as G}from"./index-1cm0rnTd.js";import{S as $,G as O,T as z,Y as D}from"./TagFilter-D3AALjQj.js";import{M as I}from"./MovieGridSkeleton-DIX5d9PK.js";import{P as q}from"./Pagination-CaFgjG0t.js";import{u as H,a as J,S as K}from"./SeriesCard-2yRA4kLI.js";import"./MovieCardSkeleton-BdPh6Yzn.js";const Q=({series:o})=>{const{isFavoriteSeries:g,toggleFavoriteSeries:x}=H(),{isWatchLaterSeries:u,toggleWatchLaterSeries:h}=J();return t.jsx("div",{className:"[column-count:2] sm:[column-count:3] md:[column-count:4] lg:[column-count:5] xl:[column-count:6] gap-4 md:gap-6",children:o.map(d=>t.jsx("div",{className:"break-inside-avoid mb-4 md:mb-6",children:t.jsx(K,{series:d,isFavorite:g(d.id),isWatchLater:u(d.id),onToggleFavorite:x,onToggleWatchLater:h})},d.id))})},v=28,se=()=>{const[o,g]=r.useState([]),[x,u]=r.useState([]),[h,d]=r.useState(!0),[l,f]=r.useState("all"),[n,p]=r.useState([]),[i,b]=r.useState([]),[m,k]=r.useState("createdAt_desc"),[S,A]=r.useState(1);r.useEffect(()=>{(async()=>{try{const a=(await G.collection("series").orderBy("createdAt","desc").get()).docs.map(c=>({id:c.id,...c.data()}));g(a)}catch(s){console.error("Error fetching series: ",s)}finally{d(!1)}})()},[]),r.useEffect(()=>{const e=G.collection("categories").orderBy("name").onSnapshot(s=>{const a=s.docs.map(c=>c.data().name);u(a)},s=>{console.error("Error fetching categories: ",s)});return()=>e()},[]);const C=e=>p(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e]),E=()=>p([]),w=e=>b(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e]),R=()=>b([]),P=()=>{f("all"),p([]),b([])},_=[...new Set(o.map(e=>e.year))].sort((e,s)=>s-e),L=x,Y=[...new Set(o.flatMap(e=>e.tags||[]))].sort(),j=r.useMemo(()=>o.filter(e=>l==="all"||e.year.toString()===l).filter(e=>n.length===0||n.some(s=>{var a;return(a=e.genres)==null?void 0:a.includes(s)})).filter(e=>i.length===0||i.some(s=>{var a;return(a=e.tags)==null?void 0:a.includes(s)})).sort((e,s)=>{var a,c,F,M;switch(m){case"rating_desc":return(s.imdbRating||0)-(e.imdbRating||0);case"rating_asc":return(e.imdbRating||0)-(s.imdbRating||0);case"year_desc":return s.year-e.year;case"year_asc":return e.year-s.year;case"createdAt_asc":{const y=(a=e.createdAt)!=null&&a.toMillis?Number(e.createdAt.toMillis()):0,N=(c=s.createdAt)!=null&&c.toMillis?Number(s.createdAt.toMillis()):0;return y-N}case"createdAt_desc":default:{const y=(F=s.createdAt)!=null&&F.toMillis?Number(s.createdAt.toMillis()):0,N=(M=e.createdAt)!=null&&M.toMillis?Number(e.createdAt.toMillis()):0;return y-N}}}),[o,l,n,i,m]);r.useEffect(()=>{A(1)},[l,n,i,m]);const T=Math.ceil(j.length/v),W=j.slice((S-1)*v,S*v),B=l!=="all"||n.length>0||i.length>0;return h?t.jsxs("div",{className:"animate-fade-in",children:[t.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"تصفح المسلسلات"}),t.jsx("div",{className:"my-8 h-20 bg-slate-800/50 rounded-lg animate-pulse"}),t.jsx(I,{count:18})]}):t.jsxs("div",{className:"animate-fade-in",children:[t.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"تصفح المسلسلات"}),t.jsx("div",{className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:t.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[t.jsx($,{sortOrder:m,onSortChange:k}),t.jsx(O,{genres:L,selectedGenres:n,onToggleGenre:C,onClearGenres:E}),t.jsx(z,{tags:Y,selectedTags:i,onToggleTag:w,onClearTags:R}),t.jsx(D,{years:_,selectedYear:l,onYearChange:f})]})}),B&&t.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-slate-800/50 p-3 animate-fade-in-down",children:[t.jsx("span",{className:"font-bold text-slate-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[l!=="all"&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",l,t.jsx("button",{onClick:()=>f("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${l}`,children:"×"})]}),n.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[e,t.jsx("button",{onClick:()=>C(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${e}`,children:"×"})]},e)),i.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",e,t.jsx("button",{onClick:()=>w(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${e}`,children:"×"})]},e))]}),t.jsx("button",{onClick:P,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),t.jsx("section",{className:"mb-12",children:j.length>0?t.jsxs(t.Fragment,{children:[t.jsx(Q,{series:W}),T>1&&t.jsx(q,{currentPage:S,totalPages:T,onPageChange:A})]}):t.jsx("div",{className:"text-center p-8 bg-slate-800 rounded-lg mt-8",children:t.jsx("p",{className:"text-xl text-slate-400",children:"لا توجد مسلسلات تطابق معايير البحث."})})})]})};export{se as default};
