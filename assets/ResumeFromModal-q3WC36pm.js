import{a as N,r as i,e as j,F as S,T as L,R as k,j as e,L as C}from"./index-DHK5cvRJ.js";import{u as R}from"./MovieCardSkeleton-DdmktY3e.js";import{F,S as E}from"./SpinnerIcon-rVrOQveZ.js";const W=()=>{const{currentUser:t}=N(),[o,a]=i.useState([]);i.useEffect(()=>{if(!t){a([]);return}const g=j.collection("user_lists").doc(t.uid).onSnapshot(m=>{if(m.exists){const l=m.data();a((l==null?void 0:l.favoriteSeries)||[])}else a([])},m=>{console.error("Error listening to favorite series:",m)});return()=>g()},[t]);const v=i.useCallback(async r=>{if(!t){console.warn("User must be logged in to manage favorite series.");return}const g=j.collection("user_lists").doc(t.uid),m=o.includes(r);try{m?await g.update({favoriteSeries:S.arrayRemove(r)}):await g.set({favoriteSeries:S.arrayUnion(r)},{merge:!0})}catch(l){console.error("Error toggling favorite series in Firestore:",l)}},[t,o]),u=i.useCallback(r=>o.includes(r),[o]);return{favoriteSeries:o,toggleFavoriteSeries:v,isFavoriteSeries:u}},z=()=>{const{currentUser:t}=N(),[o,a]=i.useState([]),[v,u]=i.useState(!1);i.useEffect(()=>{if(!t){a([]);return}const c=j.collection("user_lists").doc(t.uid).onSnapshot(d=>{if(d.exists){const n=d.data(),p=(n==null?void 0:n.watchLaterSeries)||[];p.sort((x,s)=>{var w,y;const b=(w=x.addedAt)!=null&&w.toDate?x.addedAt.toDate().getTime():new Date(x.addedAt).getTime(),f=(y=s.addedAt)!=null&&y.toDate?s.addedAt.toDate().getTime():new Date(s.addedAt).getTime();return(isNaN(f)?0:f)-(isNaN(b)?0:b)}),a(p)}else a([])},d=>{console.error("Error listening to watch later series list:",d)});return()=>c()},[t]);const r=i.useCallback(async(h,c,d)=>{var x;if(!t){console.warn("User must be logged in to manage watch later list.");return}u(!0);const n=j.collection("user_lists").doc(t.uid),p={seriesId:h,season:c,episode:d,addedAt:L.now()};try{const s=await n.get();if(s.exists){const f=[...(((x=s.data())==null?void 0:x.watchLaterSeries)||[]).filter(w=>w.seriesId!==h),p];await n.update({watchLaterSeries:f})}else await n.set({watchLaterSeries:[p]})}catch(s){console.error("Error adding to watch later series in Firestore:",s)}finally{u(!1)}},[t]),g=i.useCallback(async h=>{var d;if(!t)return;u(!0);const c=j.collection("user_lists").doc(t.uid);try{const n=await c.get();if(n.exists){const x=(((d=n.data())==null?void 0:d.watchLaterSeries)||[]).filter(s=>s.seriesId!==h);await c.update({watchLaterSeries:x})}}catch(n){console.error("Error removing from watch later series in Firestore:",n)}finally{u(!1)}},[t]),m=i.useCallback(h=>o.some(c=>c.seriesId===h),[o]),l=i.useCallback(h=>o.find(c=>c.seriesId===h),[o]);return{watchLaterSeries:o,addWatchLaterSeries:r,removeWatchLaterSeries:g,isWatchLaterSeries:m,getWatchLaterInfo:l,loading:v}},D=({isFavorite:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${t?"text-red-500":"text-white"}`,fill:t?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 016.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"})}),$=({isWatchLater:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${t?"text-cyan-400":"text-white"}`,fill:t?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),A=({series:t,isFavorite:o,isWatchLater:a,onToggleFavorite:v,onToggleWatchLater:u,watchLaterInfo:r=null})=>{const{currentUser:g}=N(),{imageRef:m,imageSrc:l,isLoaded:h,handleImageLoad:c}=R(t.posterUrl),[d,n]=i.useState(!1),p=b=>{b.preventDefault(),b.stopPropagation(),v(t.id)},x=b=>{b.preventDefault(),b.stopPropagation(),u(t)},s=r?`/series/${t.id}?season=${r.season}&episode=${r.episode}`:`/series/${t.id}`;return e.jsx("div",{className:"relative group",children:e.jsxs(C,{to:s,className:"relative block z-10 rounded-lg overflow-hidden shadow-lg hover:shadow-xl hover:shadow-cyan-500/20 transform transition-all duration-300 ease-in-out group-hover:scale-105 bg-slate-800",children:[g&&e.jsxs("div",{className:"absolute top-1.5 right-1.5 z-20 flex flex-col gap-1.5 opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0 transition-all duration-300",children:[e.jsx("button",{onClick:p,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":o?"إزالة من المفضلة":"إضافة إلى المفضلة",children:e.jsx(D,{isFavorite:o})}),e.jsx("button",{onClick:x,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":a?"إزالة من قائمة المشاهدة لاحقاً":"إضافة إلى قائمة المشاهدة لاحقاً",children:e.jsx($,{isWatchLater:a})})]}),e.jsx("div",{className:"relative w-full aspect-[2/3] bg-slate-800 overflow-hidden",children:e.jsx("img",{ref:m,src:l,onLoad:c,alt:t.title,className:`
              w-full h-full object-cover
              transition-all duration-500 ease-in-out group-hover:opacity-75
              ${h?"scale-100 blur-0 grayscale-0":"scale-110 blur-md grayscale"}
            `})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/70 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4 transition-all duration-300 group-hover:-translate-y-1",children:[e.jsx("h3",{className:"text-white text-sm sm:text-base font-bold truncate",children:t.title}),t.genres&&t.genres.length>0&&e.jsxs("div",{className:"relative mt-1",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[e.jsx("p",{className:"text-slate-400 text-xs truncate",children:t.genres.join(" / ")}),d&&e.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-max max-w-xs bg-slate-900 text-white text-xs rounded py-1.5 px-3 z-10 shadow-lg border border-slate-700 pointer-events-none animate-fade-in-up-fast",children:t.genres.join(", ")})]}),e.jsxs("div",{className:"mt-1 flex justify-between items-center",children:[e.jsx("p",{className:"text-slate-300 text-xs sm:text-sm",children:t.year}),t.imdbRating&&t.imdbRating>0?e.jsxs("div",{className:"flex items-center gap-1.5",title:`IMDb Rating: ${t.imdbRating}/10`,children:[e.jsx("span",{className:"bg-yellow-500 text-black text-xs sm:text-sm font-bold px-2 py-0.5 rounded-sm",children:"IMDb"}),e.jsx("span",{className:"font-bold text-white text-sm",children:t.imdbRating.toFixed(1)})]}):e.jsx("div",{className:"h-5"})]}),r&&e.jsxs("div",{className:"mt-1.5 text-center text-xs font-bold text-cyan-200 bg-cyan-500/20 px-2 py-1 rounded-sm",children:["استئناف م",r.season," ح",r.episode]})]})]})})},I=k.memo(A),_=({isOpen:t,onClose:o,series:a,onSave:v,isSaving:u})=>{var x;const[r,g]=i.useState(1),[m,l]=i.useState(1);if(i.useEffect(()=>{if(a&&a.seasons.length>0){const s=a.seasons[0];g(s.seasonNumber),s.episodes.length>0&&l(s.episodes[0].episodeNumber)}},[a]),!a)return null;const h=()=>{v(r,m)},c=s=>{const b=Number(s.target.value);g(b);const f=a.seasons.find(w=>w.seasonNumber===b);f&&f.episodes.length>0?l(f.episodes[0].episodeNumber):l(1)},d=a.seasons||[],n=((x=d.find(s=>s.seasonNumber===r))==null?void 0:x.episodes)||[],p="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition cursor-pointer";return e.jsx(F,{isOpen:t,onClose:o,title:`أضف "${a.title}" للمشاهدة لاحقاً`,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"اختر الحلقة التي توقفت عندها للعودة إليها بسهولة لاحقًا."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"season",className:"block text-sm font-medium text-slate-300 mb-2",children:"الموسم"}),e.jsx("select",{id:"season",value:r,onChange:c,className:p,children:d.map(s=>e.jsxs("option",{value:s.seasonNumber,children:["الموسم ",s.seasonNumber]},s.seasonNumber))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"episode",className:"block text-sm font-medium text-slate-300 mb-2",children:"الحلقة"}),e.jsx("select",{id:"episode",value:m,onChange:s=>l(Number(s.target.value)),className:p,children:n.map(s=>e.jsxs("option",{value:s.episodeNumber,children:["الحلقة ",s.episodeNumber,": ",s.title]},s.episodeNumber))})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-700",children:[e.jsx("button",{onClick:o,disabled:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{onClick:h,disabled:u,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[u&&e.jsx(E,{}),u?"جاري الحفظ...":"حفظ واستئناف"]})]})]})})};export{_ as R,I as S,z as a,W as u};
