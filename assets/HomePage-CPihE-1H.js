import{r,u as X,a as Z,d as R,f as ee,j as t}from"./index-C75TUr8p.js";import{H as te,a as se}from"./HeroSliderSkeleton-CdJHSqaM.js";import{M as S}from"./MoviesCarousel-D2d6RuZE.js";import{S as ae,G as re,T as le,Y as oe}from"./TagFilter-DnMzgv_6.js";import{u as ne}from"./useWatchLater--95OPc2m.js";import{M as ie}from"./MovieGrid-Bm8mBs6v.js";import{M as ce}from"./MovieGridSkeleton-hr9AzoTZ.js";import{M as A}from"./MoviesCarouselSkeleton-ByniFqv0.js";import{P as de}from"./Pagination-Cc511sZ2.js";import"./MovieCardSkeleton-CqgWkuat.js";const C=28,Me=()=>{const[n,Y]=r.useState([]),[B,H]=r.useState([]),[z,O]=r.useState(!0),[o,v]=r.useState("all"),[i,p]=r.useState([]),[c,y]=r.useState([]),[f,$]=r.useState("createdAt_desc"),[m,N]=r.useState(""),{currentUser:w}=X(),{favorites:K}=ne(),{getAverageRating:d}=Z(),[j,T]=r.useState(1);r.useEffect(()=>{(async()=>{try{const x=(await R.collection("movies").get()).docs.map(l=>({id:l.id,...l.data()})).filter(l=>l.isKurdish!==!0);x.sort((l,g)=>{var P,_;const u=(P=l.createdAt)!=null&&P.toMillis?l.createdAt.toMillis():0;return((_=g.createdAt)!=null&&_.toMillis?g.createdAt.toMillis():0)-u}),Y(x)}catch(s){console.error("Error fetching movies: ",s)}finally{O(!1)}})()},[]),r.useEffect(()=>{const e=R.collection("categories").orderBy("name").onSnapshot(s=>{const a=s.docs.map(x=>x.data().name);H(a)},s=>{console.error("Error fetching categories: ",s)});return()=>e()},[]);const G=e=>{p(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e])},Q=()=>{p([])},k=e=>{y(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e])},q=()=>{y([])},D=()=>{N(""),v("all"),p([]),y([])},E=n.filter(e=>K.includes(e.id)),I=n.slice(0,15),L=[...n].sort((e,s)=>d(s.id).average-d(e.id).average).slice(0,15),U=[...new Set(n.map(e=>e.year))].sort((e,s)=>s-e),V=B,J=[...new Set(n.flatMap(e=>e.tags||[]))].sort(),M=r.useMemo(()=>n.filter(e=>o==="all"||e.year.toString()===o).filter(e=>i.length===0?!0:i.some(s=>{var a;return(a=e.genres)==null?void 0:a.includes(s)})).filter(e=>c.length===0?!0:c.some(s=>{var a;return(a=e.tags)==null?void 0:a.includes(s)})).filter(e=>ee(m,e.title)).sort((e,s)=>{var a,x,l,g;switch(f){case"rating_desc":return d(s.id).average-d(e.id).average;case"rating_asc":return d(e.id).average-d(s.id).average;case"year_desc":return s.year-e.year;case"year_asc":return e.year-s.year;case"createdAt_asc":{const u=(a=e.createdAt)!=null&&a.toMillis?e.createdAt.toMillis():0,h=(x=s.createdAt)!=null&&x.toMillis?s.createdAt.toMillis():0;return u-h}case"createdAt_desc":default:{const u=(l=s.createdAt)!=null&&l.toMillis?s.createdAt.toMillis():0,h=(g=e.createdAt)!=null&&g.toMillis?e.createdAt.toMillis():0;return u-h}}}),[n,o,i,c,m,f,d]);r.useEffect(()=>{T(1)},[o,i,c,m,f]);const F=Math.ceil(M.length/C),W=M.slice((j-1)*C,j*C),b=m!==""||o!=="all"||i.length>0||c.length>0;return z?t.jsxs("div",{children:[t.jsx(te,{}),t.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),w&&t.jsx(A,{title:"المفضلة"}),t.jsx(A,{title:"أحدث الإضافات"}),t.jsx(A,{title:"الأعلى تقييماً"}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"تصفح الكل"}),t.jsx(ce,{count:18})]})]}):t.jsxs("div",{children:[t.jsx(se,{movies:n.slice(0,5)}),t.jsx("div",{className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:t.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[t.jsx(ae,{sortOrder:f,onSortChange:$}),t.jsx(re,{genres:V,selectedGenres:i,onToggleGenre:G,onClearGenres:Q}),t.jsx(le,{tags:J,selectedTags:c,onToggleTag:k,onClearTags:q}),t.jsx(oe,{years:U,selectedYear:o,onYearChange:v})]})}),b&&t.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-gray-800/50 p-3 animate-fade-in-down",children:[t.jsx("span",{className:"font-bold text-gray-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[m&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-yellow-900/50 px-3 py-1 text-sm text-yellow-300",children:['بحث: "',m,'"',t.jsx("button",{onClick:()=>N(""),className:"text-yellow-400 hover:text-white text-lg leading-none font-bold","aria-label":"Clear search query",children:"×"})]}),o!=="all"&&t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",o,t.jsx("button",{onClick:()=>v("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${o}`,children:"×"})]}),i.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[e,t.jsx("button",{onClick:()=>G(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${e}`,children:"×"})]},e)),c.map(e=>t.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",e,t.jsx("button",{onClick:()=>k(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${e}`,children:"×"})]},e))]}),t.jsx("button",{onClick:D,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),!b&&t.jsxs(t.Fragment,{children:[w&&E.length>0&&t.jsx(S,{title:"المفضلة",movies:E}),t.jsx(S,{title:"أحدث الإضافات",movies:I}),t.jsx(S,{title:"الأعلى تقييماً",movies:L})]}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:b?"نتائج البحث":"تصفح الكل"}),M.length>0?t.jsxs(t.Fragment,{children:[t.jsx(ie,{movies:W}),F>1&&t.jsx(de,{currentPage:j,totalPages:F,onPageChange:T})]}):t.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:t.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام تطابق معايير البحث."})})]})]})};export{Me as default};
